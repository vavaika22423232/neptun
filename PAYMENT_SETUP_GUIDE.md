# üí≥ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –æ–ø–ª–∞—Ç–∏ NEPTUN

## ‚úÖ –©–æ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ:

### 1. Backend (app.py):
- ‚úÖ –î–æ–¥–∞–Ω–æ LiqPay —Ç–∞ Flask-Mail –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `/api/commercial_subscription` endpoint
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `/api/liqpay_callback` –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `/admin` –ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∞–º–∏
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ `/admin/subscription/<id>/approve` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å—Ö–≤–∞–ª–µ–Ω–Ω—è
- ‚úÖ –î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `send_subscription_email()` –¥–ª—è email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—å

### 2. Frontend (templates/index_index.html):
- ‚úÖ –§–æ—Ä–º–∞ –ø—ñ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –Ω–∞ LiqPay
- ‚úÖ –î–æ–¥–∞–Ω–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ —Ä–µ–¥—ñ—Ä–µ–∫—Ç—É

### 3. Dependencies (requirements.txt):
- ‚úÖ `liqpay==1.0.0` - LiqPay Python SDK
- ‚úÖ `flask-mail==0.9.1` - Email notifications

### 4. Admin Panel (templates/admin.html):
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–≤—Å—å–æ–≥–æ, –æ–ø–ª–∞—á–µ–Ω–æ, –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è, –¥–æ—Ö—ñ–¥)
- ‚úÖ –§—ñ–ª—å—Ç—Ä–∏ (–≤—Å—ñ, –æ–ø–ª–∞—á–µ–Ω–æ, –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è)
- ‚úÖ –ü–æ—à—É–∫ –∑–∞ –Ω—ñ–∫–Ω–µ–π–º–æ–º/email
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–°—Ö–≤–∞–ª–∏—Ç–∏" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ–ø–ª–∞—Ç

---

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ Render.com

### –ö—Ä–æ–∫ 1: –î–æ–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (Environment Variables)

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ Render Dashboard ‚Üí –í–∞—à Web Service ‚Üí Environment

**LiqPay –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
```
LIQPAY_PUBLIC_KEY=i12345678    # –í–∞—à Public Key –∑ LiqPay –∫–∞–±—ñ–Ω–µ—Ç—É
LIQPAY_PRIVATE_KEY=xxxxx...    # –í–∞—à Private Key –∑ LiqPay –∫–∞–±—ñ–Ω–µ—Ç—É
```

**Email (SMTP) –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (Gmail –ø—Ä–∏–∫–ª–∞–¥):**
```
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password      # –ù–µ –∑–≤–∏—á–∞–π–Ω–∏–π –ø–∞—Ä–æ–ª—å! –°—Ç–≤–æ—Ä—ñ—Ç—å App Password
MAIL_DEFAULT_SENDER=noreply@neptun.in.ua
```

**–ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å:**
```
ADMIN_USERNAME=admin
ADMIN_PASSWORD=super_secret_password_123   # –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Å–∏–ª—å–Ω–∏–π –ø–∞—Ä–æ–ª—å!
```

### –ö—Ä–æ–∫ 2: –û—Ç—Ä–∏–º–∞–π—Ç–µ LiqPay –∫–ª—é—á—ñ

1. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://www.liqpay.ua/
2. –£–≤—ñ–π–¥—ñ—Ç—å –≤ –∫–∞–±—ñ–Ω–µ—Ç ‚Üí API
3. –°–∫–æ–ø—ñ—é–π—Ç–µ **Public Key** —Ç–∞ **Private Key**
4. –î–æ–¥–∞–π—Ç–µ —ó—Ö –≤ Render Environment Variables

### –ö—Ä–æ–∫ 3: –ù–∞–ª–∞—à—Ç—É–π—Ç–µ Gmail App Password (–¥–ª—è email)

1. –£–≤—ñ–π–¥—ñ—Ç—å –≤ Google Account ‚Üí Security
2. –£–≤—ñ–º–∫–Ω—ñ—Ç—å **2-Step Verification** (—è–∫—â–æ —â–µ –Ω–µ –≤–≤—ñ–º–∫–Ω–µ–Ω–æ)
3. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ **App Passwords**: https://myaccount.google.com/apppasswords
4. –°—Ç–≤–æ—Ä—ñ—Ç—å App Password –¥–ª—è "Mail"
5. –°–∫–æ–ø—ñ—é–π—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å (16 —Å–∏–º–≤–æ–ª—ñ–≤ –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤)
6. –î–æ–¥–∞–π—Ç–µ –≤ `MAIL_PASSWORD` –Ω–∞ Render

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Gmail:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ SendGrid (–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ 100 emails/–¥–µ–Ω—å):
```
MAIL_SERVER=smtp.sendgrid.net
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=apikey
MAIL_PASSWORD=YOUR_SENDGRID_API_KEY
```

### –ö—Ä–æ–∫ 4: –î–µ–ø–ª–æ–π

1. –ó–±–µ—Ä–µ–∂—ñ—Ç—å –≤—Å—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –Ω–∞ Render
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Manual Deploy** –∞–±–æ –∑–∞—á–µ–∫–∞–π—Ç–µ auto-deploy –∑ GitHub
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏: –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–±–∞—á–∏—Ç–∏:
   ```
   INFO: LiqPay payment gateway initialized
   INFO: Flask-Mail initialized
   ```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –¢–µ—Å—Ç —Ñ–æ—Ä–º–∏ –ø—ñ–¥–ø–∏—Å–∫–∏:
- –í—ñ–¥–∫—Ä–∏–π—Ç–µ https://neptun.in.ua
- –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–ø–ª–∞—Ç–∏—Ç–∏"
- –í–∏ –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ñ –Ω–∞ LiqPay checkout

### 2. –¢–µ—Å—Ç –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—ñ:
- –í—ñ–¥–∫—Ä–∏–π—Ç–µ https://neptun.in.ua/admin
- –í–≤–µ–¥—ñ—Ç—å –ª–æ–≥—ñ–Ω/–ø–∞—Ä–æ–ª—å –∑ `ADMIN_USERNAME` —Ç–∞ `ADMIN_PASSWORD`
- –ü–æ–±–∞—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –ø—ñ–¥–ø–∏—Å–æ–∫
- –ú–æ–∂–µ—Ç–µ —Å—Ö–≤–∞–ª–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É –≤—Ä—É—á–Ω—É (—è–∫—â–æ –æ–ø–ª–∞—Ç–∞ –±–∞–Ω–∫—ñ–≤—Å—å–∫–∏–º –ø–µ—Ä–µ–∫–∞–∑–æ–º)

### 3. –¢–µ—Å—Ç email:
- –°—Ö–≤–∞–ª—ñ—Ç—å –±—É–¥—å-—è–∫—É –ø—ñ–¥–ø–∏—Å–∫—É –≤ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—ñ
- Email –ø–æ–≤–∏–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏—Å—å –∫–ª—ñ—î–Ω—Ç—É
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Render –Ω–∞ –ø–æ–º–∏–ª–∫–∏ SMTP

---

## üìä –Ø–∫ –ø—Ä–∞—Ü—é—î —Å–∏—Å—Ç–µ–º–∞:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–ø–ª–∞—Ç–∞ (LiqPay):
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É ‚Üí POST `/api/commercial_subscription`
2. Backend —Å—Ç–≤–æ—Ä—é—î –∑–∞–ø–∏—Å —É `commercial_subscriptions.json` –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
3. Backend –≥–µ–Ω–µ—Ä—É—î LiqPay payment form data + signature
4. Frontend –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ LiqPay
5. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ–ø–ª–∞—á—É—î –∫–∞—Ä—Ç–æ—é
6. LiqPay –Ω–∞–¥—Å–∏–ª–∞—î callback –Ω–∞ `/api/liqpay_callback`
7. Backend –ø–µ—Ä–µ–≤—ñ—Ä—è—î signature, –æ–Ω–æ–≤–ª—é—î —Å—Ç–∞—Ç—É—Å –Ω–∞ `paid`
8. Backend –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î confirmation email –∫–ª—ñ—î–Ω—Ç—É

### –†—É—á–Ω–µ —Å—Ö–≤–∞–ª–µ–Ω–Ω—è (–±–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π –ø–µ—Ä–µ–∫–∞–∑):
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É, –∞–ª–µ –ù–ï –æ–ø–ª–∞—á—É—î —á–µ—Ä–µ–∑ LiqPay
2. –°—Ç–∞—Ç—É—Å –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è `pending`
3. –ê–¥–º—ñ–Ω –±–∞—á–∏—Ç—å –ø—ñ–¥–ø–∏—Å–∫—É –≤ –ø–∞–Ω–µ–ª—ñ `/admin`
4. –ü—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –±–∞–Ω–∫—ñ–≤—Å—å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–∞–∑—É –Ω–∞—Ç–∏—Å–∫–∞—î "–°—Ö–≤–∞–ª–∏—Ç–∏"
5. –°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ `paid`, email –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è

---

## üîí –ë–µ–∑–ø–µ–∫–∞

### LiqPay Signature Verification:
Backend **–æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î** signature –∑ callback, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø—ñ–¥—Ä–æ–±–∫–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤:
```python
sign_string = LIQPAY_PRIVATE_KEY + callback_data + LIQPAY_PRIVATE_KEY
expected_signature = base64.b64encode(hashlib.sha1(sign_string.encode('utf-8')).digest())
```

### Admin Panel Authentication:
HTTP Basic Auth –∑–∞—Ö–∏—â–∞—î –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å. –ù—ñ—Ö—Ç–æ –Ω–µ –∑–º–æ–∂–µ –ø–æ–±–∞—á–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–∏ –±–µ–∑ –ª–æ–≥—ñ–Ω–∞/–ø–∞—Ä–æ–ª—è.

---

## üìÅ –§–∞–π–ª–∏ –¥–∞–Ω–∏—Ö

### `commercial_subscriptions.json`:
–ó–±–µ—Ä—ñ–≥–∞—î –≤—Å—ñ –ø—ñ–¥–ø–∏—Å–∫–∏:
```json
[
  {
    "id": "uuid-here",
    "nickname": "streamer_name",
    "email": "user@example.com",
    "telegram": "@username",
    "comment": "TikTok channel...",
    "amount": 1500,
    "currency": "UAH",
    "status": "paid",
    "timestamp": "2026-01-07T12:00:00+02:00",
    "payment_status": "success",
    "payment_time": "2026-01-07T12:05:00+02:00"
  }
]
```

**–í–∞–∂–ª–∏–≤–æ:** Render –º–æ–∂–µ –≤–∏–¥–∞–ª—è—Ç–∏ —Ñ–∞–π–ª–∏ –ø—Ä–∏ redeploy! –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è:
1. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ PostgreSQL (Render –Ω–∞–¥–∞—î –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ)
2. –ê–±–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ JSON –≤ AWS S3 / Google Cloud Storage
3. –ê–±–æ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ —Ä–æ–±–∏—Ç–∏ –±–µ–∫–∞–ø–∏ `commercial_subscriptions.json`

---

## üöÄ –©–æ –¥–∞–ª—ñ?

### –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):
1. **Database**: –ú—ñ–≥—Ä–∞—Ü—ñ—è –∑ JSON –Ω–∞ PostgreSQL –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ
2. **Webhooks**: –î–æ–¥–∞—Ç–∏ Telegram bot notifications –¥–ª—è –∞–¥–º—ñ–Ω–∞ –ø—Ä–∏ –Ω–æ–≤–∏—Ö –ø—ñ–¥–ø–∏—Å–∫–∞—Ö
3. **Recurring payments**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ –º—ñ—Å—è—Ü—å
4. **Invoice generation**: PDF —Ä–∞—Ö—É–Ω–∫–∏ –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤
5. **Analytics**: –ì—Ä–∞—Ñ—ñ–∫–∏ –¥–æ—Ö–æ–¥—É –≤ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—ñ

---

## üìû –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

–Ø–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î:

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ Render:**
   - Dashboard ‚Üí Service ‚Üí Logs
   - –®—É–∫–∞–π—Ç–µ —Ä—è–¥–∫–∏ –∑ `ERROR`, `WARNING`, `Failed`

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Environment Variables:**
   - –í—Å—ñ –∫–ª—é—á—ñ –¥–æ–¥–∞–Ω—ñ?
   - –ù–µ–º–∞—î –∑–∞–π–≤–∏—Ö –ø—Ä–æ–±—ñ–ª—ñ–≤?
   - Private Key LiqPay –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π?

3. **–¢–µ—Å—Ç LiqPay –≤ sandbox:**
   - LiqPay –Ω–∞–¥–∞—î —Ç–µ—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º (sandbox) –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: https://www.liqpay.ua/documentation/api/aquiring/checkout/doc

4. **Email –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Gmail App Password (16 —Å–∏–º–≤–æ–ª—ñ–≤ –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤)
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ 2FA –≤ Google Account
   - –°–ø—Ä–æ–±—É–π—Ç–µ SendGrid —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üéâ**

–¢–µ–ø–µ—Ä –∫–ª—ñ—î–Ω—Ç–∏ –º–æ–∂—É—Ç—å –æ–ø–ª–∞—á—É–≤–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–∏ –æ–Ω–ª–∞–π–Ω, –∞ –≤–∏ –∫–µ—Ä—É–≤–∞—Ç–∏ –Ω–∏–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å.
