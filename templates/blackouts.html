<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <title>–ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å ‚Äî NEPTUN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --main-bg: #0a0f1c;
      --panel-bg: #111827;
      --accent: #3b82f6;
      --accent2: #10b981;
      --text: #f3f4f6;
      --text2: #d1d5db;
      --text-muted: #9ca3af;
      --border: #1f2937;
      --shadow: rgba(0, 0, 0, 0.25);
      --card-bg: rgba(17, 24, 39, 0.95);
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --info: #3b82f6;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--main-bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    /* Header */
    .header {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.9));
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 2rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }
    
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .logo-text {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #3b82f6, #06b6d4);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.5px;
    }
    
    .page-title {
      font-size: 1.1rem;
      color: var(--text2);
      font-weight: 500;
    }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 0.75rem;
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: rgba(59, 130, 246, 0.2);
      border-color: var(--accent);
      transform: translateY(-2px);
    }
    
    /* Main Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    /* Address Search */
    .search-section {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
    }
    
    .search-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    .search-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      background: rgba(59, 130, 246, 0.15);
      color: var(--accent);
      font-size: 1.5rem;
    }
    
    .search-header-text h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.25rem;
    }
    
    .search-header-text p {
      font-size: 0.875rem;
      color: var(--text-muted);
    }
    
    .search-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      position: relative;
    }
    
    .search-fields {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 1rem;
    }
    
    .search-input-wrapper {
      position: relative;
    }
    
    .input-label {
      display: block;
      font-size: 0.875rem;
      color: var(--text2);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .search-input {
      width: 100%;
      padding: 1rem;
      background: rgba(31, 41, 55, 0.5);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      color: var(--text);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.2s;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      background: rgba(31, 41, 55, 0.8);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .search-input-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
      display: none;
    }
    
    .search-btn {
      padding: 1rem 2rem;
      background: linear-gradient(135deg, var(--accent), #2563eb);
      border: none;
      border-radius: 0.75rem;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.2s;
      white-space: nowrap;
      align-self: flex-end;
    }
    
    .search-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px -4px rgba(59, 130, 246, 0.4);
    }
    
    .search-btn:active {
      transform: translateY(0);
    }
    
    .autocomplete-dropdown {
      position: absolute;
      top: calc(100% + 0.5rem);
      left: 0;
      right: 0;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      max-height: 300px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
      display: none;
    }
    
    .autocomplete-dropdown.show {
      display: block;
    }
    
    .autocomplete-item {
      padding: 0.875rem 1rem;
      cursor: pointer;
      border-bottom: 1px solid var(--border);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .autocomplete-item:last-child {
      border-bottom: none;
    }
    
    .autocomplete-item:hover {
      background: rgba(59, 130, 246, 0.1);
    }
    
    .autocomplete-item .material-icons {
      color: var(--text-muted);
      font-size: 1.25rem;
    }
    
    .autocomplete-text {
      flex: 1;
    }
    
    .autocomplete-address {
      color: var(--text);
      font-size: 0.95rem;
      margin-bottom: 0.125rem;
    }
    
    .autocomplete-group {
      color: var(--text-muted);
      font-size: 0.8rem;
    }
    
    /* My Schedule */
    .my-schedule {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(16, 185, 129, 0.15));
      border: 2px solid var(--accent);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      display: none;
    }
    
    .my-schedule.show {
      display: block;
    }
    
    .my-schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    
    .my-schedule-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .my-schedule-title h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
    }
    
    .my-schedule-badge {
      padding: 0.375rem 0.875rem;
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid var(--accent);
      border-radius: 0.5rem;
      color: var(--accent);
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .close-my-schedule {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 0.5rem;
      color: var(--danger);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .close-my-schedule:hover {
      background: rgba(239, 68, 68, 0.2);
    }
    
    .my-address {
      font-size: 1.1rem;
      color: var(--text2);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .schedule-timeline {
      display: grid;
      gap: 0.75rem;
    }
    
    .timeline-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      background: rgba(17, 24, 39, 0.5);
      border-radius: 0.75rem;
      border-left: 3px solid transparent;
    }
    
    .timeline-item.active {
      border-left-color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }
    
    .timeline-item.upcoming {
      border-left-color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }
    
    .timeline-item.normal {
      border-left-color: var(--success);
    }
    
    .timeline-time {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
      min-width: 120px;
    }
    
    .timeline-status {
      flex: 1;
      font-size: 1rem;
      color: var(--text2);
    }
    
    .timeline-icon {
      font-size: 1.5rem;
    }
    
    .timeline-item.active .timeline-icon {
      color: var(--danger);
    }
    
    .timeline-item.upcoming .timeline-icon {
      color: var(--warning);
    }
    
    .timeline-item.normal .timeline-icon {
      color: var(--success);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      transition: all 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.4);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .stat-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .stat-icon {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      font-size: 1.5rem;
    }
    
    .stat-icon.danger {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }
    
    .stat-icon.warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }
    
    .stat-icon.success {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }
    
    .stat-icon.info {
      background: rgba(59, 130, 246, 0.15);
      color: var(--info);
    }
    
    .stat-content {
      flex: 1;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }
    
    .stat-value {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text);
    }
    
    .stat-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
    }
    
    /* Schedule Grid */
    .schedule-section {
      margin-bottom: 2rem;
    }
    
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    
    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
    }
    
    .refresh-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 0.75rem;
      color: var(--success);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .refresh-btn:hover {
      background: rgba(16, 185, 129, 0.2);
      border-color: var(--success);
    }
    
    .schedule-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
    }
    
    .schedule-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s;
    }
    
    .schedule-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px -4px rgba(0, 0, 0, 0.4);
    }
    
    .schedule-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .schedule-city {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text);
    }
    
    .schedule-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .schedule-status.active {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }
    
    .schedule-status.stable {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }
    
    .schedule-status.warning {
      background: rgba(245, 158, 11, 0.15);
      color: var(--warning);
    }
    
    .schedule-body {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .schedule-row {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .schedule-label {
      font-size: 0.875rem;
      color: var(--text-muted);
      min-width: 100px;
    }
    
    .schedule-value {
      font-size: 0.95rem;
      color: var(--text);
      font-weight: 500;
    }
    
    .queue-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 0.5rem;
      color: var(--accent);
      font-weight: 700;
    }
    
    .time-slot {
      display: inline-block;
      padding: 0.4rem 0.8rem;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 0.5rem;
      color: var(--danger);
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    /* Timeline */
    .timeline-section {
      margin-top: 2rem;
    }
    
    .timeline {
      position: relative;
      padding: 2rem 0;
    }
    
    /* Queues Grid */
    .queues-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 1.5rem;
      margin-top: 1rem;
    }
    
    .queue-card {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.8), rgba(31, 41, 55, 0.6));
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .queue-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--accent), #2563eb);
    }
    
    .queue-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px -4px rgba(59, 130, 246, 0.3);
      border-color: rgba(59, 130, 246, 0.5);
    }
    
    .queue-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    
    .queue-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .queue-number {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));
      border: 2px solid rgba(59, 130, 246, 0.4);
      border-radius: 0.75rem;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent);
    }
    
    .queue-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .queue-current-status {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.4rem 0.75rem;
      border-radius: 0.5rem;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .queue-current-status.active-now {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: var(--danger);
    }
    
    .queue-current-status.normal-now {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.4);
      color: var(--success);
    }
    
    .queue-schedule-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .queue-schedule-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.875rem;
      background: rgba(31, 41, 55, 0.4);
      border-radius: 0.5rem;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }
    
    .queue-schedule-item:hover {
      background: rgba(31, 41, 55, 0.6);
    }
    
    .queue-schedule-item.active {
      border-left-color: var(--danger);
      background: rgba(239, 68, 68, 0.08);
    }
    
    .queue-schedule-item.normal {
      border-left-color: var(--success);
    }
    
    .queue-schedule-item.possible {
      border-left-color: var(--warning);
      background: rgba(245, 158, 11, 0.08);
    }
    
    .queue-time {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text);
      min-width: 110px;
      font-family: 'Courier New', monospace;
    }
    
    .queue-label {
      flex: 1;
      font-size: 0.9rem;
      color: var(--text2);
    }
    
    .queue-schedule-item.active .queue-label {
      color: var(--danger);
      font-weight: 600;
    }
    
    .queue-schedule-item.possible .queue-label {
      color: var(--warning);
    }
    
    .queue-icon {
      font-size: 1.25rem;
      opacity: 0.7;
    }
    
    .queue-schedule-item.active .queue-icon {
      color: var(--danger);
      opacity: 1;
    }
    
    .queue-schedule-item.normal .queue-icon {
      color: var(--success);
      opacity: 1;
    }
    
    .queue-schedule-item.possible .queue-icon {
      color: var(--warning);
      opacity: 1;
    }

    
    .timeline::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--accent), var(--success));
    }
    
    .timeline-item {
      display: flex;
      align-items: center;
      margin-bottom: 2rem;
      position: relative;
    }
    
    .timeline-item:nth-child(odd) {
      flex-direction: row-reverse;
    }
    
    .timeline-content {
      width: 45%;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.5rem;
    }
    
    .timeline-dot {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      width: 16px;
      height: 16px;
      background: var(--accent);
      border: 4px solid var(--main-bg);
      border-radius: 50%;
      z-index: 10;
    }
    
    .timeline-time {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }
    
    .timeline-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 0.5rem;
    }
    
    .timeline-desc {
      font-size: 0.9rem;
      color: var(--text2);
    }
    
    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4rem;
      flex-direction: column;
      gap: 1rem;
    }
    
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(59, 130, 246, 0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .header-content {
        flex-direction: column;
        gap: 1rem;
        align-items: flex-start;
      }
      
      .search-fields {
        grid-template-columns: 1fr;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .schedule-grid {
        grid-template-columns: 1fr;
      }
      
      .timeline::before {
        left: 20px;
      }
      
      .timeline-item,
      .timeline-item:nth-child(odd) {
        flex-direction: row;
      }
      
      .timeline-content {
        width: calc(100% - 60px);
        margin-left: 60px;
      }
      
      .timeline-dot {
        left: 20px;
      }
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-muted);
    }
    
    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <span class="logo-text">NEPTUN</span>
        <span class="page-title">‚Ä¢ –ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</span>
      </div>
      <a href="/" class="back-btn">
        <span class="material-icons">arrow_back</span>
        –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –∫–∞—Ä—Ç—É
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <!-- Address Search -->
    <div class="search-section">
      <div class="search-header">
        <div class="search-icon">
          <span class="material-icons">home</span>
        </div>
        <div class="search-header-text">
          <h2>–ó–Ω–∞–π—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –∑–∞ –∞–¥—Ä–µ—Å–æ—é</h2>
          <p>–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—É –∞–¥—Ä–µ—Å—É –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫—É –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</p>
          <div id="updateStatus" style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--accent2); display: flex; align-items: center; gap: 0.5rem;">
            <span class="material-icons" style="font-size: 1rem; animation: pulse 2s infinite;">sync</span>
            <span>–ì—Ä–∞—Ñ—ñ–∫–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–∂–Ω—É –≥–æ–¥–∏–Ω—É –∑ –î–¢–ï–ö —Ç–∞ –£–∫—Ä–µ–Ω–µ—Ä–≥–æ</span>
          </div>
        </div>
      </div>
      
      <form class="search-form" id="searchForm" onsubmit="return false;">
        <div class="search-fields">
          <div class="search-input-wrapper">
            <label class="input-label">
              <span class="material-icons" style="font-size: 1rem; vertical-align: middle;">location_city</span>
              –ú—ñ—Å—Ç–æ / –°–µ–ª–æ
            </label>
            <input 
              type="text" 
              class="search-input" 
              id="cityInput"
              placeholder="–ö–∏—ó–≤"
              autocomplete="off"
            >
          </div>
          
          <div class="search-input-wrapper">
            <label class="input-label">
              <span class="material-icons" style="font-size: 1rem; vertical-align: middle;">add_road</span>
              –í—É–ª–∏—Ü—è
            </label>
            <input 
              type="text" 
              class="search-input" 
              id="streetInput"
              placeholder="–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫"
              autocomplete="off"
            >
          </div>
          
          <div class="search-input-wrapper">
            <label class="input-label">
              <span class="material-icons" style="font-size: 1rem; vertical-align: middle;">home</span>
              –ë—É–¥–∏–Ω–æ–∫ / –ö–≤–∞—Ä—Ç–∏—Ä–∞
            </label>
            <input 
              type="text" 
              class="search-input" 
              id="buildingInput"
              placeholder="–±—É–¥. 1"
              autocomplete="off"
            >
          </div>
        </div>
        
        <button type="submit" class="search-btn" id="searchBtn">
          <span class="material-icons">search</span>
          –ó–Ω–∞–π—Ç–∏ –º—ñ–π –≥—Ä–∞—Ñ—ñ–∫
        </button>
      </form>
    </div>

    <!-- My Schedule (appears after search) -->
    <div class="my-schedule" id="mySchedule">
      <div class="my-schedule-header">
        <div class="my-schedule-title">
          <h3>–í–∞—à –≥—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</h3>
          <span class="my-schedule-badge" id="myScheduleGroup">‚Äî</span>
        </div>
        <div class="close-my-schedule" onclick="closeMySchedule()">
          <span class="material-icons">close</span>
        </div>
      </div>
      
      <div class="my-address">
        <span class="material-icons">location_on</span>
        <span id="myAddressText">‚Äî</span>
      </div>
      
      <div class="schedule-timeline" id="myScheduleTimeline">
        <!-- Timeline items will be inserted here -->
      </div>
    </div>

    <!-- All Queues Section -->
    <div class="search-section">
      <div class="search-header">
        <div class="search-icon">
          <span class="material-icons">schedule</span>
        </div>
        <div class="search-header-text">
          <h2>–ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –ø–æ —á–µ—Ä–≥–∞—Ö</h2>
          <p>–ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤—Å—ñ—Ö —á–µ—Ä–≥ (–ø—ñ–¥–≥—Ä—É–ø)</p>
        </div>
      </div>

      <div id="allQueuesGrid" class="queues-grid">
        <!-- Queue cards will be inserted here by JavaScript -->
      </div>
    </div>
    
    <!-- Stats Overview -->
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon danger">‚ö°</div>
          <div class="stat-content">
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</div>
            <div class="stat-value" id="activeBlackouts">‚Äî</div>
            <div class="stat-subtitle">—Ä–µ–≥—ñ–æ–Ω—ñ–≤ –ø—ñ–¥ –æ–±–º–µ–∂–µ–Ω–Ω—è–º</div>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon warning">‚è∞</div>
          <div class="stat-content">
            <div class="stat-label">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</div>
            <div class="stat-value" id="scheduledBlackouts">‚Äî</div>
            <div class="stat-subtitle">–Ω–∞ –Ω–∞–π–±–ª–∏–∂—á—ñ 24 –≥–æ–¥–∏–Ω–∏</div>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon success">‚úì</div>
          <div class="stat-content">
            <div class="stat-label">–°—Ç–∞–±—ñ–ª—å–Ω–∏—Ö —Ä–µ–≥—ñ–æ–Ω—ñ–≤</div>
            <div class="stat-value" id="stableRegions">‚Äî</div>
            <div class="stat-subtitle">–±–µ–∑ –ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</div>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-icon info">üìä</div>
          <div class="stat-content">
            <div class="stat-label">–†—ñ–≤–µ–Ω—å –¥–µ—Ñ—ñ—Ü–∏—Ç—É</div>
            <div class="stat-value" id="deficitLevel">‚Äî</div>
            <div class="stat-subtitle">–∑–∞ –¥–∞–Ω–∏–º–∏ –£–∫—Ä–µ–Ω–µ—Ä–≥–æ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule Section -->
    <div class="schedule-section">
      <div class="section-header">
        <h2 class="section-title">–ì—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö</h2>
        <button class="refresh-btn" onclick="refreshData()">
          <span class="material-icons">refresh</span>
          –û–Ω–æ–≤–∏—Ç–∏
        </button>
      </div>
      
      <div class="schedule-grid" id="scheduleGrid">
        <!-- Loading state -->
        <div class="loading" id="loadingState">
          <div class="spinner"></div>
          <div>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
        </div>
      </div>
    </div>

    <!-- Timeline Section -->
    <div class="timeline-section">
      <div class="section-header">
        <h2 class="section-title">–û—Å—Ç–∞–Ω–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>
      </div>
      <div class="timeline" id="timeline">
        <!-- Timeline items will be added here -->
      </div>
    </div>
  </div>

  <script>
    // API endpoints for different providers
    const API_SOURCES = {
      dtek: 'https://www.dtek-krem.com.ua/ua/shutdowns',
      ukrenergo: 'https://www.oe.if.ua/',
      // Add more sources as needed
    };

    // Sample data structure (will be replaced with real API calls)
    let blackoutData = {
      regions: [],
      stats: {
        active: 0,
        scheduled: 0,
        stable: 0,
        deficit: '‚Äî'
      },
      updates: []
    };

    // Check schedule update status
    async function checkUpdateStatus() {
      try {
        const response = await fetch('/api/schedule_status');
        const status = await response.json();
        
        const updateStatusEl = document.getElementById('updateStatus');
        if (updateStatusEl && status.available) {
          const lastUpdate = status.last_update ? new Date(status.last_update).toLocaleTimeString('uk-UA') : '–Ω–µ–≤—ñ–¥–æ–º–æ';
          updateStatusEl.innerHTML = `
            <span class="material-icons" style="font-size: 1rem; animation: ${status.cache_valid ? 'pulse 2s infinite' : 'spin 1s linear infinite'};">
              ${status.cache_valid ? 'sync' : 'sync'}
            </span>
            <span>
              –ì—Ä–∞—Ñ—ñ–∫–∏ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–∂–Ω—É –≥–æ–¥–∏–Ω—É –∑ –î–¢–ï–ö —Ç–∞ –£–∫—Ä–µ–Ω–µ—Ä–≥–æ
              <br>
              <small style="opacity: 0.7;">–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: ${lastUpdate} ‚Ä¢ –ù–∞—Å—Ç—É–ø–Ω–µ: ${status.next_update}</small>
            </span>
          `;
        }
      } catch (error) {
        console.error('Error checking update status:', error);
      }
    }

    // Initialize page
    async function init() {
      console.log('Initializing blackouts page...');
      initSearch(); // Initialize address search
      await loadData();
      renderStats();
      renderSchedule();
      renderTimeline();
      
      // Check update status
      await checkUpdateStatus();
      
      // Auto-refresh every 5 minutes
      setInterval(refreshData, 5 * 60 * 1000);
      
      // Check status every minute
      setInterval(checkUpdateStatus, 60 * 1000);
    }

    // Load data from APIs
    async function loadData() {
      try {
        // TODO: Implement real API calls to DTEK, Ukrenergo, etc.
        // For now, using sample data
        
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Sample data
        blackoutData = {
          regions: [
            {
              city: '–ö–∏—ó–≤',
              oblast: '–ö–∏—ó–≤—Å—å–∫–∞',
              status: 'stable',
              queue: null,
              nextBlackout: null,
              duration: null,
              source: '–î–¢–ï–ö –ö–∏—ó–≤—Å—å–∫—ñ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ'
            },
            {
              city: '–û–¥–µ—Å–∞',
              oblast: '–û–¥–µ—Å—å–∫–∞',
              status: 'active',
              queue: 1,
              nextBlackout: '14:00 - 18:00',
              duration: '4 –≥–æ–¥',
              source: '–î–¢–ï–ö –û–¥–µ—Å—å–∫—ñ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ'
            },
            {
              city: '–•–∞—Ä–∫—ñ–≤',
              oblast: '–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞',
              status: 'warning',
              queue: 2,
              nextBlackout: '16:00 - 20:00',
              duration: '4 –≥–æ–¥',
              source: '–î–¢–ï–ö –°—Ö—ñ–¥–µ–Ω–µ—Ä–≥–æ'
            },
            {
              city: '–î–Ω—ñ–ø—Ä–æ',
              oblast: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞',
              status: 'active',
              queue: 3,
              nextBlackout: '12:00 - 16:00',
              duration: '4 –≥–æ–¥',
              source: '–î–¢–ï–ö –î–Ω—ñ–ø—Ä–æ–≤—Å—å–∫—ñ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ'
            },
            {
              city: '–õ—å–≤—ñ–≤',
              oblast: '–õ—å–≤—ñ–≤—Å—å–∫–∞',
              status: 'stable',
              queue: null,
              nextBlackout: null,
              duration: null,
              source: '–õ—å–≤—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ'
            },
            {
              city: '–ó–∞–ø–æ—Ä—ñ–∂–∂—è',
              oblast: '–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞',
              status: 'warning',
              queue: 1,
              nextBlackout: '18:00 - 22:00',
              duration: '4 –≥–æ–¥',
              source: '–î–¢–ï–ö –ó–∞–ø–æ—Ä—ñ–∑—å–∫—ñ –µ–ª–µ–∫—Ç—Ä–æ–º–µ—Ä–µ–∂—ñ'
            }
          ],
          stats: {
            active: 2,
            scheduled: 2,
            stable: 2,
            deficit: '–ü–æ–º—ñ—Ä–Ω–∏–π'
          },
          updates: [
            {
              time: '14:30',
              title: '–û–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –¥–ª—è –û–¥–µ—Å—å–∫–æ—ó –æ–±–ª–∞—Å—Ç—ñ',
              desc: '–î–¢–ï–ö –æ–Ω–æ–≤–∏–≤ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å. –ú–æ–∂–ª–∏–≤—ñ –∑–º—ñ–Ω–∏ —É —á–µ—Ä–∑—ñ 1.',
              timestamp: Date.now() - 30 * 60 * 1000
            },
            {
              time: '13:15',
              title: '–°—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è –≤ –ö–∏—ó–≤—Å—å–∫—ñ–π –æ–±–ª–∞—Å—Ç—ñ',
              desc: '–ü–ª–∞–Ω–æ–≤—ñ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω—ñ –¥–æ –∫—ñ–Ω—Ü—è –¥–Ω—è.',
              timestamp: Date.now() - 105 * 60 * 1000
            },
            {
              time: '11:45',
              title: '–ó–±—ñ–ª—å—à–µ–Ω–Ω—è –¥–µ—Ñ—ñ—Ü–∏—Ç—É –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ',
              desc: '–£–∫—Ä–µ–Ω–µ—Ä–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –¥–µ—Ñ—ñ—Ü–∏—Ç—É –Ω–∞ 15%.',
              timestamp: Date.now() - 195 * 60 * 1000
            }
          ]
        };
        
        console.log('Data loaded:', blackoutData);
      } catch (error) {
        console.error('Error loading data:', error);
      }
    }

    // Render statistics
    function renderStats() {
      document.getElementById('activeBlackouts').textContent = blackoutData.stats.active;
      document.getElementById('scheduledBlackouts').textContent = blackoutData.stats.scheduled;
      document.getElementById('stableRegions').textContent = blackoutData.stats.stable;
      document.getElementById('deficitLevel').textContent = blackoutData.stats.deficit;
    }

    // Render schedule cards
    function renderSchedule() {
      const grid = document.getElementById('scheduleGrid');
      const loading = document.getElementById('loadingState');
      
      if (loading) {
        loading.remove();
      }
      
      grid.innerHTML = '';
      
      if (blackoutData.regions.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</p></div>';
        return;
      }
      
      blackoutData.regions.forEach(region => {
        const card = document.createElement('div');
        card.className = 'schedule-card';
        
        const statusClass = region.status;
        const statusText = {
          'active': '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è',
          'warning': '–û—á—ñ–∫—É—î—Ç—å—Å—è',
          'stable': '–°—Ç–∞–±—ñ–ª—å–Ω–æ'
        }[statusClass] || '–ù–µ–≤—ñ–¥–æ–º–æ';
        
        card.innerHTML = `
          <div class="schedule-header">
            <div class="schedule-city">${region.city}</div>
            <div class="schedule-status ${statusClass}">
              <span class="material-icons" style="font-size: 1rem;">${statusClass === 'active' ? 'power_off' : statusClass === 'warning' ? 'warning' : 'check_circle'}</span>
              ${statusText}
            </div>
          </div>
          <div class="schedule-body">
            <div class="schedule-row">
              <div class="schedule-label">–û–±–ª–∞—Å—Ç—å:</div>
              <div class="schedule-value">${region.oblast}</div>
            </div>
            ${region.queue ? `
            <div class="schedule-row">
              <div class="schedule-label">–ß–µ—Ä–≥–∞:</div>
              <div class="queue-badge">${region.queue}</div>
            </div>
            ` : ''}
            ${region.nextBlackout ? `
            <div class="schedule-row">
              <div class="schedule-label">–ù–∞—Å—Ç—É–ø–Ω–µ:</div>
              <div class="time-slot">${region.nextBlackout}</div>
            </div>
            ` : '<div class="schedule-row"><div class="schedule-label">–°—Ç–∞—Ç—É—Å:</div><div class="schedule-value" style="color: var(--success);">–ë–µ–∑ –ø–ª–∞–Ω–æ–≤–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å</div></div>'}
            ${region.duration ? `
            <div class="schedule-row">
              <div class="schedule-label">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:</div>
              <div class="schedule-value">${region.duration}</div>
            </div>
            ` : ''}
            <div class="schedule-row">
              <div class="schedule-label">–î–∂–µ—Ä–µ–ª–æ:</div>
              <div class="schedule-value" style="font-size: 0.8rem; color: var(--text-muted);">${region.source}</div>
            </div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    // Render timeline
    function renderTimeline() {
      const timeline = document.getElementById('timeline');
      timeline.innerHTML = '';
      
      if (blackoutData.updates.length === 0) {
        timeline.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì∞</div><p>–ù–µ–º–∞—î –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –æ–Ω–æ–≤–ª–µ–Ω—å</p></div>';
        return;
      }
      
      blackoutData.updates.forEach((update, index) => {
        const item = document.createElement('div');
        item.className = 'timeline-item';
        
        item.innerHTML = `
          <div class="timeline-content">
            <div class="timeline-time">${update.time}</div>
            <div class="timeline-title">${update.title}</div>
            <div class="timeline-desc">${update.desc}</div>
          </div>
          <div class="timeline-dot"></div>
        `;
        
        timeline.appendChild(item);
      });
    }

    // Address Search Functions
    let selectedAddressData = null;
    let allCities = [];
    let allAddresses = [];

    // Initialize search form
    function initSearch() {
      const form = document.getElementById('searchForm');
      form.addEventListener('submit', handleSearchSubmit);
      
      // Load cities and addresses from backend
      loadCitiesAndAddresses();
      
      // Setup autocomplete for inputs
      setupAutocomplete();
    }

    // Load cities and addresses from API
    async function loadCitiesAndAddresses() {
      try {
        const response = await fetch('/api/search_cities');
        if (response.ok) {
          const data = await response.json();
          allCities = data.cities || [];
          allAddresses = data.addresses || [];
          console.log(`Loaded ${allCities.length} cities and ${allAddresses.length} addresses`);
        }
      } catch (error) {
        console.error('Failed to load cities:', error);
      }
    }

    // Setup autocomplete for city, street, building inputs
    function setupAutocomplete() {
      const cityInput = document.getElementById('cityInput');
      const streetInput = document.getElementById('streetInput');
      const buildingInput = document.getElementById('buildingInput');

      // Create dropdown elements
      const cityDropdown = createDropdown('cityDropdown');
      const streetDropdown = createDropdown('streetDropdown');
      
      cityInput.parentElement.appendChild(cityDropdown);
      streetInput.parentElement.appendChild(streetDropdown);

      // City autocomplete
      cityInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        if (query.length < 1) {
          hideDropdown(cityDropdown);
          return;
        }

        const matches = allCities.filter(city => 
          city.toLowerCase().includes(query)
        ).slice(0, 10);

        if (matches.length > 0) {
          showCityDropdown(cityDropdown, matches, cityInput);
        } else {
          hideDropdown(cityDropdown);
        }
      });

      // Street autocomplete (based on selected city)
      streetInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        const selectedCity = cityInput.value.toLowerCase().trim();
        
        if (query.length < 1 || !selectedCity) {
          hideDropdown(streetDropdown);
          return;
        }

        // Filter addresses by city and street
        const matches = allAddresses
          .filter(addr => {
            const cityMatch = addr.city && addr.city.toLowerCase().includes(selectedCity);
            const streetMatch = addr.street && addr.street.toLowerCase().includes(query);
            return cityMatch && streetMatch;
          })
          .slice(0, 10);

        if (matches.length > 0) {
          showStreetDropdown(streetDropdown, matches, streetInput, buildingInput);
        } else {
          hideDropdown(streetDropdown);
        }
      });

      // Hide dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!cityInput.contains(e.target) && !cityDropdown.contains(e.target)) {
          hideDropdown(cityDropdown);
        }
        if (!streetInput.contains(e.target) && !streetDropdown.contains(e.target)) {
          hideDropdown(streetDropdown);
        }
      });
    }

    // Create dropdown element
    function createDropdown(id) {
      const dropdown = document.createElement('div');
      dropdown.id = id;
      dropdown.className = 'autocomplete-dropdown';
      return dropdown;
    }

    // Show city dropdown
    function showCityDropdown(dropdown, cities, input) {
      dropdown.innerHTML = cities.map(city => `
        <div class="autocomplete-item" data-city="${city}">
          <span class="material-icons">location_city</span>
          <div class="autocomplete-text">
            <div class="autocomplete-address">${city}</div>
          </div>
        </div>
      `).join('');

      dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
        item.addEventListener('click', () => {
          input.value = item.dataset.city;
          hideDropdown(dropdown);
          document.getElementById('streetInput').focus();
        });
      });

      dropdown.classList.add('show');
    }

    // Show street dropdown
    function showStreetDropdown(dropdown, addresses, streetInput, buildingInput) {
      dropdown.innerHTML = addresses.map(addr => `
        <div class="autocomplete-item" data-street="${addr.street}" data-building="${addr.building || ''}" data-group="${addr.group}">
          <span class="material-icons">route</span>
          <div class="autocomplete-text">
            <div class="autocomplete-address">${addr.street}${addr.building ? ', ' + addr.building : ''}</div>
            <div class="autocomplete-group">–ß–µ—Ä–≥–∞ ${addr.group}</div>
          </div>
        </div>
      `).join('');

      dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
        item.addEventListener('click', () => {
          streetInput.value = item.dataset.street;
          if (item.dataset.building) {
            buildingInput.value = item.dataset.building;
          }
          hideDropdown(dropdown);
        });
      });

      dropdown.classList.add('show');
    }

    // Hide dropdown
    function hideDropdown(dropdown) {
      dropdown.classList.remove('show');
    }


    // Handle search form submit
    function handleSearchSubmit(e) {
      e.preventDefault();
      
      const city = document.getElementById('cityInput').value.trim();
      const street = document.getElementById('streetInput').value.trim();
      const building = document.getElementById('buildingInput').value.trim();
      
      if (!city || !street) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ç–æ —Ç–∞ –≤—É–ª–∏—Ü—é');
        return;
      }

      // Construct full address
      const fullAddress = `${city}, ${street}${building ? ', ' + building : ''}`;
      
      // Search for schedule
      searchAndShowSchedule(city, street, building);
    }

    // Search and show schedule for address
    async function searchAndShowSchedule(city, street, building) {
      const btn = document.getElementById('searchBtn');
      btn.disabled = true;
      btn.innerHTML = '<span class="material-icons">hourglass_empty</span> –ü–æ—à—É–∫...';

      try {
        const params = new URLSearchParams({
          city: city,
          street: street,
          building: building || ''
        });
        
        const response = await fetch(`/api/get_schedule?${params.toString()}`);
        if (!response.ok) throw new Error('Failed to get schedule');
        
        const data = await response.json();
        
        if (data.error) {
          alert(data.error);
        } else {
          showMySchedule(data);
        }
      } catch (error) {
        console.error('Schedule fetch error:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
      } finally {
        btn.disabled = false;
        btn.innerHTML = '<span class="material-icons">search</span> –ó–Ω–∞–π—Ç–∏ –º—ñ–π –≥—Ä–∞—Ñ—ñ–∫';
      }
    }

    // Show user's personal schedule
    function showMySchedule(data) {
      const scheduleDiv = document.getElementById('mySchedule');
      const addressText = document.getElementById('myAddressText');
      const groupBadge = document.getElementById('myScheduleGroup');
      const timeline = document.getElementById('myScheduleTimeline');

      // Set address and group
      addressText.textContent = data.address;
      groupBadge.textContent = `–ß–µ—Ä–≥–∞ ${data.group}`;

      // Render timeline
      timeline.innerHTML = '';
      
      if (data.schedule && data.schedule.length > 0) {
        data.schedule.forEach(slot => {
          const item = document.createElement('div');
          item.className = `timeline-item ${slot.status}`;
          
          const icon = slot.status === 'active' ? 'power_off' : 
                      slot.status === 'upcoming' ? 'schedule' : 'power';
          
          item.innerHTML = `
            <div class="timeline-time">${slot.time}</div>
            <div class="timeline-status">${slot.label}</div>
            <span class="material-icons timeline-icon">${icon}</span>
          `;
          
          timeline.appendChild(item);
        });
      } else {
        timeline.innerHTML = '<div class="empty-state" style="padding: 2rem;"><p>–ì—Ä–∞—Ñ—ñ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –≤–∞—à–æ—ó –∞–¥—Ä–µ—Å–∏</p></div>';
      }

      // Show schedule
      scheduleDiv.classList.add('show');
      
      // Scroll to schedule
      setTimeout(() => {
        scheduleDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }

    // Close personal schedule
    function closeMySchedule() {
      const scheduleDiv = document.getElementById('mySchedule');
      scheduleDiv.classList.remove('show');
      document.getElementById('cityInput').value = '';
      document.getElementById('streetInput').value = '';
      document.getElementById('buildingInput').value = '';
      selectedAddressData = null;
    }

    // Refresh all data
    async function refreshData() {
      console.log('Refreshing data...');
      const btn = event.target.closest('.refresh-btn');
      if (btn) {
        btn.style.opacity = '0.5';
        btn.style.pointerEvents = 'none';
      }
      
      await loadData();
      renderStats();
      renderSchedule();
      renderTimeline();
      
      if (btn) {
        btn.style.opacity = '1';
        btn.style.pointerEvents = 'auto';
      }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', init);

    // Render all queues section
    function renderAllQueues() {
      const allQueuesGrid = document.getElementById('allQueuesGrid');
      
      // All queue subgroups: 1.1, 1.2, 2.1, 2.2, 3.1, 3.2
      const queues = [
        { id: '1.1', name: '–ß–µ—Ä–≥–∞ 1.1', group: 1 },
        { id: '1.2', name: '–ß–µ—Ä–≥–∞ 1.2', group: 1 },
        { id: '2.1', name: '–ß–µ—Ä–≥–∞ 2.1', group: 2 },
        { id: '2.2', name: '–ß–µ—Ä–≥–∞ 2.2', group: 2 },
        { id: '3.1', name: '–ß–µ—Ä–≥–∞ 3.1', group: 3 },
        { id: '3.2', name: '–ß–µ—Ä–≥–∞ 3.2', group: 3 }
      ];

      // Schedule templates for each subgroup (from backend BLACKOUT_SCHEDULES)
      const scheduleTemplates = {
        '1.1': [
          { time: '00:00 - 04:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '04:00 - 08:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '08:00 - 12:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '12:00 - 16:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' },
          { time: '16:00 - 20:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '20:00 - 24:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' }
        ],
        '1.2': [
          { time: '00:00 - 04:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '04:00 - 08:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '08:00 - 12:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' },
          { time: '12:00 - 16:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '16:00 - 20:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '20:00 - 24:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' }
        ],
        '2.1': [
          { time: '00:00 - 04:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '04:00 - 08:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '08:00 - 12:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '12:00 - 16:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '16:00 - 20:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' },
          { time: '20:00 - 24:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' }
        ],
        '2.2': [
          { time: '00:00 - 04:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '04:00 - 08:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '08:00 - 12:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '12:00 - 16:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '16:00 - 20:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '20:00 - 24:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' }
        ],
        '3.1': [
          { time: '00:00 - 04:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' },
          { time: '04:00 - 08:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '08:00 - 12:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '12:00 - 16:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '16:00 - 20:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '20:00 - 24:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' }
        ],
        '3.2': [
          { time: '00:00 - 04:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '04:00 - 08:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '08:00 - 12:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' },
          { time: '12:00 - 16:00', label: '–ú–æ–∂–ª–∏–≤–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'possible' },
          { time: '16:00 - 20:00', label: '–ê–∫—Ç–∏–≤–Ω–µ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è', status: 'active' },
          { time: '20:00 - 24:00', label: '–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è', status: 'normal' }
        ]
      };

      // Get current hour for highlighting active period
      const currentHour = new Date().getHours();
      
      queues.forEach(queue => {
        const schedule = scheduleTemplates[queue.id] || [];
        
        // Determine current status
        let isActiveNow = false;
        schedule.forEach(slot => {
          const [startTime] = slot.time.split(' - ');
          const [startHour] = startTime.split(':').map(Number);
          const endHour = (startHour + 4) % 24;
          
          if (slot.status === 'active' && currentHour >= startHour && currentHour < endHour) {
            isActiveNow = true;
          }
        });

        const card = document.createElement('div');
        card.className = 'queue-card';
        
        const statusBadge = isActiveNow 
          ? '<span class="queue-current-status active-now"><span class="material-icons" style="font-size: 0.9rem;">power_off</span>–í—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>'
          : '<span class="queue-current-status normal-now"><span class="material-icons" style="font-size: 0.9rem;">power</span>–ï–ª–µ–∫—Ç—Ä–æ–ø–æ—Å—Ç–∞—á–∞–Ω–Ω—è</span>';

        const scheduleHTML = schedule.map(slot => {
          const [startTime] = slot.time.split(' - ');
          const [startHour] = startTime.split(':').map(Number);
          const endHour = (startHour + 4) % 24;
          const isCurrentSlot = currentHour >= startHour && currentHour < endHour;
          
          const icon = slot.status === 'active' ? 'power_off' : 
                      slot.status === 'possible' ? 'warning' : 'power';
          
          return `
            <div class="queue-schedule-item ${slot.status} ${isCurrentSlot ? 'active' : ''}">
              <div class="queue-time">${slot.time}</div>
              <div class="queue-label">${slot.label}</div>
              <span class="material-icons queue-icon">${icon}</span>
            </div>
          `;
        }).join('');

        card.innerHTML = `
          <div class="queue-card-header">
            <div class="queue-title">
              <div class="queue-number">${queue.id}</div>
              <div class="queue-name">${queue.name}</div>
            </div>
            ${statusBadge}
          </div>
          <div class="queue-schedule-list">
            ${scheduleHTML}
          </div>
        `;
        
        allQueuesGrid.appendChild(card);
      });
    }

    // Call renderAllQueues on init
    const originalInit = init;
    init = async function() {
      await originalInit();
      renderAllQueues();
    };
  </script>
</body>
</html>
