<!DOCTYPE html>
<html lang="uk" prefix="og: http://ogp.me/ns#">
<head>
  <meta charset="utf-8">
  
  <!-- Preconnect –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.google-analytics.com">
  <link rel="dns-prefetch" href="https://unpkg.com">
  
  <meta name="google-adsense-account" content="ca-pub-1995509849440582">
  <meta name="recreativ-verification" content="VXNs8NHEkWpeCxidooyNMriVOz1NGrj5o6gjjhXY">
  <meta name="google-site-verification" content="googlekdCuNWvLbBfOgRB3nuii_R-rvNkS4lEfWXZ1Ba3grPA">
  <meta name="msvalidate.01" content="5C8F4E9A2B1D3A7E6F0C9B8A1D2E3F4A">
  <meta name="yandex-verification" content="neptun-ukraine-alerts-map">
  
  <!-- Google Analytics (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MW867VP8WK"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MW867VP8WK', {
      'page_title': '–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏',
      'page_location': window.location.href,
      'page_path': window.location.pathname
    });
    // Track custom events
    gtag('event', 'page_view', {
      'page_title': '–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏',
      'page_location': window.location.href
    });
  </script>
  
  <!-- Ezoic Privacy Scripts (MUST be first) -->
  <script src="https://cmp.gatekeeperconsent.com/min.js" data-cfasync="false"></script>
  <script src="https://the.gatekeeperconsent.com/cmp.min.js" data-cfasync="false"></script>
  
  <!-- Ezoic Header Script -->
  <script async src="//www.ezojs.com/ezoic/sa.min.js"></script>
  <script>
    window.ezstandalone = window.ezstandalone || {};
    ezstandalone.cmd = ezstandalone.cmd || [];
  </script>
  
  <title>–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ | –ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ | NEPTUN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  
  <!-- SEO Meta Tags - Optimized for '–∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥' -->
  <meta name="description" content="üö® –ö–ê–†–¢–ê –¢–†–ò–í–û–ì —Ç–∞ –ö–ê–†–¢–ê –®–ê–•–ï–î–Ü–í –æ–Ω–ª–∞–π–Ω ‚ö° –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ! –ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ 24/7. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫. 80,000+ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ú–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤, —Ä–∞–∫–µ—Ç, FPV-–¥—Ä–æ–Ω—ñ–≤. iOS/Android –¥–æ–¥–∞—Ç–∫–∏. NEPTUN - –Ω–∞–π—Ç–æ—á–Ω—ñ—à–∞ –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑!">
  <meta name="keywords" content="–∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤, –∫–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω, –Ω–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç–∞, neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑, –∫–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω, –º–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤, –Ω–µ–ø—Ç—É–Ω, —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥–æ–≤, –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ —É–∫—Ä–∞—ó–Ω–∏, –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ —É–∫—Ä–∞—ó–Ω–∞, –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –æ–Ω–ª–∞–π–Ω, –∫–∞—Ä—Ç–∞ —Ç—Ä–µ–≤–æ–≥, –∫–∞—Ä—Ç–∞ —Ç—Ä–µ–≤–æ–≥ —É–∫—Ä–∞–∏–Ω–∞, –∫–∞—Ä–∞—Ç —Ç—Ä–µ–≤–æ–≥, –∫–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ —É–∫—Ä–∞—ó–Ω–∏ –æ–Ω–ª–∞–π–Ω, –∫–∞—Ä—Ç–∞ –≤–æ–∑–¥—É—à–Ω—ã—Ö —Ç—Ä–µ–≤–æ–≥, –∫–∞—Ä—Ç–∞ –≤–æ–∑–¥—É—à–Ω—ã—Ö —Ç—Ä–µ–≤–æ–≥ —É–∫—Ä–∞–∏–Ω—ã, –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏, –ø–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞, –≤–æ–∑–¥—É—à–Ω–∞—è —Ç—Ä–µ–≤–æ–≥–∞ —É–∫—Ä–∞–∏–Ω–∞, —Ç—Ä–∏–≤–æ–≥–∏ —É–∫—Ä–∞—ó–Ω–∏, —Ç—Ä–∏–≤–æ–≥–∞ —É–∫—Ä–∞—ó–Ω–∞, —Ç—Ä–∏–≤–æ–≥–∞ –æ–Ω–ª–∞–π–Ω, —Ç—Ä–∏–≤–æ–≥–∞ –∑–∞—Ä–∞–∑, –¥–µ —Ç—Ä–∏–≤–æ–≥–∞, air raid map ukraine, ukraine air alert, ukraine alert map, shahed map ukraine, –∫–∞—Ä—Ç–∞ —Ä–∞–∫–µ—Ç, –∫–∞—Ä—Ç–∞ –æ–±—Å—Ç—Ä—ñ–ª—ñ–≤, –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑ —É–∫—Ä–∞—ó–Ω–∏, —Ç—Ä–∏–≤–æ–≥–∞ –æ–Ω–ª–∞–π–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥–æ–≤ —É–∫—Ä–∞–∏–Ω–∞, –∫–∞—Ä—Ç–∞ —É–≥—Ä–æ–∑ —É–∫—Ä–∞–∏–Ω–∞, neptun, –Ω–µ–ø—Ç—É–Ω —Ç—Ä–∏–≤–æ–≥–∏, –∫–∞—Ä—Ç–∞ –∞—Ç–∞–∫, –∫–∞—Ä—Ç–∞ —É–¥–∞—Ä—ñ–≤, missile map ukraine, fpv –¥—Ä–æ–Ω–∏ —É–∫—Ä–∞—ó–Ω–∞, –∫–∞–±–æ–º–±–∏ —É–∫—Ä–∞—ó–Ω–∞, live ukraine map, real time alerts ukraine, –Ω–∞–π—à–≤–∏–¥—à–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, —Ç–æ—á–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –º–æ–±—ñ–ª—å–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, telegram –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ 2026, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥–æ–≤ –æ–Ω–ª–∞–π–Ω, shahed tracker ukraine, shahed radar">
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="author" content="Neptun Team">
  <meta name="generator" content="Neptun Alert System">
  <meta name="language" content="Ukrainian">
  <meta name="geo.region" content="UA">
  <meta name="geo.placename" content="Ukraine">
  <link rel="canonical" href="https://neptun.in.ua/">
  
  <!-- Hreflang for multilingual SEO -->
  <link rel="alternate" hreflang="uk" href="https://neptun.in.ua/">
  <link rel="alternate" hreflang="ru" href="https://neptun.in.ua/">
  <link rel="alternate" hreflang="en" href="https://neptun.in.ua/">
  <link rel="alternate" hreflang="x-default" href="https://neptun.in.ua/">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="application-name" content="–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏ - NEPTUN">
  <meta name="apple-mobile-web-app-title" content="–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0f1c">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  
  <!-- Open Graph –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π -->
  <meta property="og:title" content="üî¥ –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ | –ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω | –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ 24/7 | NEPTUN">
  <meta property="og:description" content="üö® –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ —Ç–∞ —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ! ‚ö° –ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫. 80,000+ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. NEPTUN - –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑ 24/7!">
  <meta property="og:image" content="https://neptun.in.ua/static/default.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏">
  <meta property="og:url" content="https://neptun.in.ua/">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="uk_UA">
  <meta property="og:locale:alternate" content="ru_UA">
  <meta property="og:locale:alternate" content="en_US">
  <meta property="og:site_name" content="NEPTUN - –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏">
  <meta property="og:locale:alternate" content="ru_RU">
  <meta property="og:locale:alternate" content="en_US">
  <meta property="og:site_name" content="Neptun - –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="NEPTUN">
  <meta name="twitter:creator" content="NEPTUN">
  <meta name="twitter:title" content="üî¥ –ö–∞—Ä—Ç–∞ –¢—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏ | NEPTUN">
  <meta name="twitter:description" content="üö® –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫! 50,000+ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –æ–Ω–ª–∞–π–Ω. –ú–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏ iOS/Android. –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ 24/7.">
  <meta name="twitter:image" content="https://neptun.in.ua/static/default.png">
  <meta name="twitter:image:alt" content="–ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏">
  
  <!-- Additional Meta Tags for SEO -->
  <meta name="classification" content="Safety, Security, Emergency Alert System">
  <meta name="rating" content="General">
  <meta name="distribution" content="Global">
  <meta name="coverage" content="Ukraine">
  <meta name="target" content="all">
  <meta name="audience" content="all">
  <meta name="revisit-after" content="1 days">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <!-- Schema.org JSON-LD - Enhanced for TOP queries: –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤, –∫–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω, —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ | –ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ - NEPTUN",
    "alternateName": ["–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥", "–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤", "–ö–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω", "–ù–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç–∞", "Neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑", "–ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ", "–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω", "–ú–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤", "–ù–µ–ø—Ç—É–Ω", "–†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤", "–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥–æ–≤", "Shahed map Ukraine"],
    "url": "https://neptun.in.ua/",
    "description": "–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ —Ç–∞ –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ. –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ —Ç–∞ –∫–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ 24/7. NEPTUN - –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑ –£–∫—Ä–∞—ó–Ω–∏. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥. 80,000+ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.",
    "applicationCategory": "UtilitiesApplication",
    "applicationSubCategory": "Emergency Alert System",
    "operatingSystem": "Web, iOS, Android",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "UAH",
      "availability": "https://schema.org/InStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.9",
      "ratingCount": "25420",
      "bestRating": "5",
      "worstRating": "1"
    },
    "author": {
      "@type": "Organization",
      "name": "Neptun Team",
      "url": "https://neptun.in.ua/"
    },
    "inLanguage": ["uk-UA", "ru-RU", "en-US"],
    "datePublished": "2024-01-01",
    "dateModified": "2026-01-02",
    "keywords": "–∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤, –∫–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω, –Ω–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç–∞, neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑, –∫–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω, –º–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤, –Ω–µ–ø—Ç—É–Ω, —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤",
    "featureList": ["–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –æ–Ω–ª–∞–π–Ω", "–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤", "–†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤", "–ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤", "–ú–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤", "Neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑", "–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥", "Push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è", "iOS/Android –¥–æ–¥–∞—Ç–∫–∏"]
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Neptun",
    "url": "https://neptun.in.ua/",
    "logo": "https://neptun.in.ua/static/default.png",
    "description": "–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏",
    "sameAs": [
      "https://t.me/neptunsupport",
      "https://t.me/+aBR79kExNQM1ZjZi"
    ],
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "Customer Support",
      "email": "support@neptun.in.ua",
      "url": "https://neptun.in.ua/contact",
      "availableLanguage": ["Ukrainian", "Russian", "English"]
    }
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Neptun - –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏",
    "url": "https://neptun.in.ua/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://neptun.in.ua/?search={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "inLanguage": "uk-UA"
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "–Ø–∫ —á–∞—Å—Ç–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "–ö–∞—Ä—Ç–∞ NEPTUN –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥, —â–æ —Ä–æ–±–∏—Ç—å —ó—ó —Å—É—á–∞—Å–Ω–æ—é –∫–∞—Ä—Ç–æ—é —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏. –¶–µ —à–≤–∏–¥–∫–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É."
        }
      },
      {
        "@type": "Question",
        "name": "–ß–∏ —î –º–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏ NEPTUN –¥–ª—è iOS —Ç–∞ Android?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "–¢–∞–∫! NEPTUN –º–∞—î –ø–æ–≤–Ω–æ—Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –º–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏ –¥–ª—è iOS (iPhone/iPad) —Ç–∞ Android. –í–æ–Ω–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ, –ø—Ä–∞—Ü—é—é—Ç—å –æ—Ñ–ª–∞–π–Ω, –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —Ç–∞ –º–∞—é—Ç—å —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –∫–∞—Ä—Ç–∏ –∑–∞–≥—Ä–æ–∑."
        }
      },
      {
        "@type": "Question",
        "name": "–Ø–∫—ñ —Ç–∏–ø–∏ –∑–∞–≥—Ä–æ–∑ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –∫–∞—Ä—Ç–∞?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "NEPTUN –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î 12 —Ç–∏–ø—ñ–≤ –∑–∞–≥—Ä–æ–∑: —à–∞—Ö–µ–¥–∏ (–ë–ü–õ–ê), –±–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ —Ç–∞ –∫—Ä–∏–ª–∞—Ç—ñ —Ä–∞–∫–µ—Ç–∏, FPV-–¥—Ä–æ–Ω–∏, –∞—Ä—Ç–∏–ª–µ—Ä—ñ–π—Å—å–∫—ñ –æ–±—Å—Ç—Ä—ñ–ª–∏, –ö–ê–ë –±–æ–º–±–∏, –†–ó–°–í, —Ö—ñ–º—ñ—á–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞, —Ä–∞–¥—ñ–∞—Ü—ñ–π–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞, –≤—É–ª–∏—á–Ω—ñ –±–æ—ó —Ç–∞ –∑–∞–≥—Ä–æ–∑–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ–≥–æ –¥–µ—Å–∞–Ω—Ç—É. –ö–æ–∂–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞ –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –º–∞—Ä–∫–µ—Ä."
        }
      },
      {
        "@type": "Question",
        "name": "–ß–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∞ NEPTUN?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "–¢–∞–∫, NEPTUN –ø–æ–≤–Ω—ñ—Å—Ç—é –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–ª—è –≤—Å—ñ—Ö —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤. –ù–µ–º–∞—î –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤, –ø—ñ–¥–ø–∏—Å–æ–∫ –∞–±–æ —Ä–µ–∫–ª–∞–º–∏. –ú–∏ –ø—Ä–∞—Ü—é—î–º–æ 24/7 –∑–∞—Ä–∞–¥–∏ –±–µ–∑–ø–µ–∫–∏ –£–∫—Ä–∞—ó–Ω–∏."
        }
      },
      {
        "@type": "Question",
        "name": "–Ø–∫ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ Telegram-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Ç—Ä–∏–≤–æ–≥–∏?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "–ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ Telegram-–∫–∞–Ω–∞–ª NEPTUN –¥–ª—è –º–∏—Ç—Ç—î–≤–∏—Ö —Å–ø–æ–≤—ñ—â–µ–Ω—å –ø—Ä–æ —Ç—Ä–∏–≤–æ–≥–∏ —É –≤–∞—à–æ–º—É —Ä–µ–≥—ñ–æ–Ω—ñ. –ë–æ—Ç –ø—ñ–¥—Ç—Ä–∏–º—É—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –∑–∞ –æ–±–ª–∞—Å—Ç—è–º–∏ —Ç–∞ —Ç–∏–ø–∞–º–∏ –∑–∞–≥—Ä–æ–∑."
        }
      }
    ]
  }
  </script>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "–ì–æ–ª–æ–≤–Ω–∞",
        "item": "https://neptun.in.ua/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥",
        "item": "https://neptun.in.ua/#map"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
        "item": "https://neptun.in.ua/#stats"
      }
    ]
  }
  </script>
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  
  <!-- Google AdSense Verification -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1995509849440582"
     crossorigin="anonymous"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Leaflet JS –¥–ª—è OpenStreetMap -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <!-- Leaflet MarkerCluster –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" crossorigin=""/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js" crossorigin=""></script>
  <style>
    :root {
      /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è —Å–∞–π—Ç–∞ */
      --main-bg: #0a0f1c;
      --panel-bg: #111827;
      --accent: #3b82f6;
      --accent2: #10b981;
      --text: #f3f4f6;
      --text2: #d1d5db;
      --text-muted: #9ca3af;
      --border: #1f2937;
      --shadow: rgba(0, 0, 0, 0.25);
      --card-bg: rgba(17, 24, 39, 0.95);
      --card-blur: blur(12px);
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      /* –ü—Ä–æ—Å—Ç–∞—è —Å–µ—Ä–∞—è –∫–∞—Ä—Ç–∞ */
      --map-filter: grayscale(0.7) brightness(0.7);
      --map-border-radius: 1.25rem;
    }
    
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--main-bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.5;
    }
    
    /* –§—ñ–ª—å—Ç—Ä —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏ –∫–∞—Ä—Ç–∏ */
    .ukraine-map-tiles.light-theme {
      filter: grayscale(0.7) brightness(0.7);
    }
    
    /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ */
    .ukraine-map-tiles.dark-theme {
      filter: none;
    }
    
    #map {
      border-radius: var(--map-border-radius);
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 
                  0 0 0 1px rgba(255, 255, 255, 0.08);
      transition: filter 0.3s ease, box-shadow 0.3s ease;
    }
    
    #map:hover {
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 
                  0 0 0 1px rgba(255, 255, 255, 0.08);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ - —á–∏—Å—Ç—ã–π —à—Ä–∏—Ñ—Ç */
    .leaflet-container {
      font-family: 'Inter', 'Ubuntu', 'DejaVu Sans', sans-serif;
      font-feature-settings: "liga" 1, "calt" 1;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #f8f9fa !important;
    }
    
    /* –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–≥–æ Leaflet –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã */
    .leaflet-control-attribution {
      background: rgba(255, 255, 255, 0.9) !important;
      border-radius: 0.5rem;
      padding: 0.25rem 0.5rem !important;
      font-size: 0.7rem !important;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –∫–∞—Ä—Ç—ã */
    .leaflet-control-zoom {
      border: none !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
      border-radius: 0.75rem !important;
      overflow: hidden;
    }
    
    .leaflet-control-zoom a {
      background: rgba(255, 255, 255, 0.95) !important;
      color: #1f2937 !important;
      border: none !important;
      width: 36px !important;
      height: 36px !important;
      line-height: 36px !important;
      font-size: 20px !important;
      transition: background 0.2s ease, transform 0.2s ease;
    }
    
    .leaflet-control-zoom a:hover {
      background: rgba(255, 255, 255, 1) !important;
      transform: scale(1.05);
    }
    
    .leaflet-control-zoom a:first-child {
      border-bottom: 1px solid rgba(0, 0, 0, 0.08) !important;
    }
    
    /* –ü–æ–ø–∞–ø—ã - –∫—Ä–∞—Å–∏–≤–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π –¥–∏–∑–∞–π–Ω */
    .leaflet-popup-content-wrapper {
      background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(249, 250, 251, 0.98) 50%, 
        rgba(243, 244, 246, 0.98) 100%) !important;
      border-radius: 1.2rem !important;
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.1),
        0 12px 48px -12px rgba(0, 0, 0, 0.25),
        0 8px 24px -8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.8) !important;
      padding: 0 !important;
      border: 1px solid rgba(203, 213, 225, 0.4) !important;
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .leaflet-popup-content-wrapper::before {
      content: "";
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.15) 0%, 
        rgba(147, 51, 234, 0.1) 50%, 
        rgba(236, 72, 153, 0.12) 100%);
      border-radius: 1.2rem;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .leaflet-popup-content-wrapper:hover::before {
      opacity: 1;
    }
    
    .leaflet-popup-content-wrapper:hover {
      transform: translateY(-2px);
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.2),
        0 16px 64px -16px rgba(0, 0, 0, 0.3),
        0 12px 32px -12px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.9) !important;
    }
    
    .leaflet-popup-tip {
      background: linear-gradient(145deg, 
        rgba(255, 255, 255, 0.98) 0%, 
        rgba(249, 250, 251, 0.98) 100%) !important;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.6) !important;
      border: 1px solid rgba(203, 213, 225, 0.4) !important;
    }
    
    /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ */
    img {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      will-change: auto;
    }
    
    .plain-marker-img, .cluster img {
      image-rendering: -webkit-optimize-contrast;
      transform: translateZ(0);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }
    
    /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ */
    .cluster img, .plain-marker-img {
      transition: opacity 0.2s ease-in-out;
    }
    
    .cluster img[src*="data:image"], .plain-marker-img[src*="data:image"] {
      opacity: 0.6;
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ */
    .ukraine-map-tiles {
      filter: brightness(1.08) contrast(0.95) saturate(1.1);
    }
    
    .ukraine-labels {
      filter: brightness(0.9) contrast(1.1);
      font-weight: 500;
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ */
    .leaflet-container {
      background: #e2e8f0 !important; /* –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Å–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –¥–ª—è –∫–∞—Ä—Ç—ã */
    }
    
    /* –°—Ç–∏–ª–∏ –∑—É–º-–∫–æ–Ω—Ç—Ä–æ–ª–ª–æ–≤ */
    .leaflet-control-zoom {
      border: none !important;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1) !important;
      border-radius: 12px !important;
      overflow: hidden;
    }
    
    .leaflet-control-zoom a {
      background: var(--card-bg) !important;
      color: var(--text) !important;
      border: 1px solid var(--border) !important;
      width: 40px !important;
      height: 40px !important;
      line-height: 38px !important;
      font-size: 18px !important;
      font-weight: 600 !important;
      transition: all 0.2s ease !important;
    }
    
    .leaflet-control-zoom a:hover {
      background: var(--accent) !important;
      color: white !important;
      transform: scale(1.05);
    }
    
    .leaflet-control-zoom a:first-child {
      border-radius: 12px 12px 0 0 !important;
    }
    
    .leaflet-control-zoom a:last-child {
      border-radius: 0 0 12px 12px !important;
      border-top: none !important;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–∫—Ä–∞–∏–Ω—Å–∫–∏—Ö —Ç–æ–ø–æ–Ω–∏–º–æ–≤ */
    .leaflet-control-attribution {
      background: var(--card-bg) !important;
      color: var(--text2) !important;
      border: 1px solid var(--border) !important;
      border-radius: 8px !important;
      box-shadow: 0 4px 12px var(--shadow) !important;
      font-size: 11px !important;
      padding: 4px 8px !important;
    }
    
    .leaflet-control-attribution a {
      color: var(--accent) !important;
      text-decoration: none !important;
    }
    
    .leaflet-control-attribution a:hover {
      text-decoration: underline !important;
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –º–µ—Ç–æ–∫ - —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ */
    .leaflet-popup-content-wrapper {
      background: linear-gradient(145deg, 
        rgba(15, 23, 42, 0.98) 0%, 
        rgba(30, 41, 59, 0.98) 50%, 
        rgba(17, 24, 39, 0.98) 100%) !important;
      color: var(--text) !important;
      border: 1px solid rgba(59, 130, 246, 0.25) !important;
      border-radius: 1.2rem !important;
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.15),
        0 12px 48px -12px rgba(0, 0, 0, 0.65),
        0 8px 24px -8px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(59, 130, 246, 0.1) !important;
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .leaflet-popup-content-wrapper::before {
      content: "";
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.2) 0%, 
        rgba(147, 51, 234, 0.15) 50%, 
        rgba(236, 72, 153, 0.18) 100%);
      border-radius: 1.2rem;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .leaflet-popup-content-wrapper:hover::before {
      opacity: 1;
    }
    
    .leaflet-popup-content-wrapper:hover {
      transform: translateY(-2px);
      border-color: rgba(59, 130, 246, 0.4) !important;
      box-shadow: 
        0 0 0 1px rgba(59, 130, 246, 0.3),
        0 16px 64px -16px rgba(0, 0, 0, 0.75),
        0 12px 32px -12px rgba(0, 0, 0, 0.55),
        inset 0 1px 0 rgba(59, 130, 246, 0.15) !important;
    }
    
    .leaflet-popup-tip {
      background: linear-gradient(145deg, 
        rgba(15, 23, 42, 0.98) 0%, 
        rgba(30, 41, 59, 0.98) 100%) !important;
      border: 1px solid rgba(59, 130, 246, 0.25) !important;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.35),
        inset 0 1px 0 rgba(59, 130, 246, 0.1) !important;
    }
    
  /* Modern Navbar - Premium Design */
  .navbar {
    width: 100%;
    background: linear-gradient(180deg, rgba(15, 23, 42, 0.98) 0%, rgba(15, 23, 42, 0.95) 100%);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    color: var(--text);
    font-weight: 600;
    font-size: 1rem;
    padding: 0.75rem 1.5rem;
    box-shadow: 
      0 4px 30px rgba(0, 0, 0, 0.3),
      0 1px 0 rgba(255, 255, 255, 0.05) inset;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid rgba(59, 130, 246, 0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
    transition: all 0.3s ease;
  }
  
  .navbar::before {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(59, 130, 246, 0.5) 50%, 
      transparent 100%);
    opacity: 0.5;
  }
  
  .navbar::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(59, 130, 246, 0.02) 50%, 
      transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  
  .navbar:hover::after {
    opacity: 1;
  }
    
  .navbar .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
  }
  
  .logo-text {
    font-size: 1.4rem;
    font-weight: 900;
    letter-spacing: 2px;
    background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 30%, #8b5cf6 70%, #60a5fa 100%);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    position: relative;
    transition: all 0.3s ease;
    animation: logoShine 3s ease infinite;
  }
  
  @keyframes logoShine {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  .logo-text::before {
    content: "NEPTUN";
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #60a5fa, #3b82f6, #8b5cf6);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    filter: blur(12px);
    opacity: 0.5;
    z-index: -1;
  }

  /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - Premium Design */
  .live-users {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.9rem;
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(30, 41, 59, 0.9));
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 14px;
    font-size: 0.7rem;
    font-weight: 600;
    position: relative;
    box-shadow: 
      0 4px 15px rgba(0, 0, 0, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.05);
    transition: all 0.25s ease;
    overflow: hidden;
  }
  
  .live-users::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
    animation: liveShimmer 3s ease infinite;
  }
  
  @keyframes liveShimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }
  
  
  /* Desktop live counter - visible by default */
  .desktop-live {
    display: inline-flex;
  }
  
  .mobile-live {
    display: none;
  }
  
  .live-users:hover {
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
    border-color: rgba(59, 130, 246, 0.4);
    transform: translateY(-1px);
  }
  
  .live-users::before {
    content: "";
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
    flex-shrink: 0;
  }
  
  .live-header {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }

  .live-users .live-label {
    color: #94a3b8;
    font-weight: 500;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .live-users .live-count {
    color: #10b981;
    font-weight: 800;
    font-size: 0.85rem;
    transition: all 0.3s ease;
  }
  
  .live-users .live-count.updating {
    animation: countUpdate 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  
  @keyframes countUpdate {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); color: #34d399; }
    100% { transform: scale(1); }
  }



  /* Footer link hover effects */
  .footer-section a:hover {
    color: #3b82f6 !important;
    transform: translateX(5px);
  }

  .live-breakdown {
    display: inline-flex;
    gap: 0.3rem;
    align-items: center;
  }

  .live-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.2rem;
    padding: 0.15rem 0.4rem;
    border-radius: 999px;
    font-size: 0.6rem;
    background: rgba(59, 130, 246, 0.08);
    border: 1px solid rgba(59, 130, 246, 0.15);
    white-space: nowrap;
    line-height: 1;
  }

  .live-chip strong {
    color: #e2e8f0;
    font-weight: 700;
    font-size: 0.65rem;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .live-users {
      font-size: 0.65rem;
      padding: 0.35rem 0.65rem;
      gap: 0.4rem;
    }
    .live-users .live-count {
      font-size: 0.8rem;
    }
    .live-chip {
      font-size: 0.55rem;
      padding: 0.12rem 0.35rem;
    }
  }
  
  @media (max-width: 480px) {
    .live-users {
      font-size: 0.6rem;
      padding: 0.3rem 0.55rem;
      gap: 0.35rem;
      align-items: flex-start;
    }
    .live-breakdown {
      flex-wrap: wrap;
    }
  }
    
  .navbar .nav-links {
    display: flex;
    gap: 0.4rem;
    font-size: 0.875rem;
    align-items: center;
    flex: 1;
    justify-content: center;
    max-width: 600px;
  }
  
  .navbar .nav-links a {
    color: rgba(148, 163, 184, 0.9);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    padding: 0.55rem 1rem;
    border-radius: 12px;
    line-height: 1;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    position: relative;
    overflow: hidden;
    border: 1px solid transparent;
  }
  
  .navbar .nav-links a::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
    border-radius: 12px;
  }
  
  .navbar .nav-links a:hover {
    color: #fff;
    transform: translateY(-1px);
    border-color: rgba(59, 130, 246, 0.2);
  }
  
  .navbar .nav-links a:hover::before {
    opacity: 1;
  }
  
  .navbar .nav-links a.active {
    color: #ffffff;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(6, 182, 212, 0.15));
    box-shadow: 
      0 0 0 1px rgba(59, 130, 246, 0.3),
      0 4px 12px rgba(59, 130, 246, 0.2),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  
  .navbar .nav-links a.active::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #3b82f6, transparent);
    border-radius: 2px;
  }
  
  .navbar .nav-links a i {
    font-size: 1.1rem;
    transition: transform 0.3s ease;
  }
  
  .navbar .nav-links a:hover i {
    transform: scale(1.1);
  }
    
    /* Donate button */
    .donate-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.6rem 1.2rem;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      border: 2px solid rgba(251, 191, 36, 0.3);
      border-radius: 2rem;
      color: #1f2937;
      font-weight: 700;
      font-size: 0.85rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .donate-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }
    
    .donate-btn:hover::before {
      left: 100%;
    }
    
    .donate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
      border-color: #fbbf24;
    }
    
    .donate-btn:active {
      transform: translateY(0);
    }
    
    .donate-btn .donate-icon {
      font-size: 1.1rem;
    }
    
    .donate-count {
      font-size: 0.7rem;
      color: rgba(31, 41, 55, 0.7);
      font-weight: 600;
    }
    
    @media (max-width: 768px) {
      .donate-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
      }
      
      .donate-btn .donate-text {
        display: none;
      }
    }
    

    
    @media (max-width: 480px) {
      /* Extra compact mobile styles */
      .navbar {
        padding: 0.5rem 0.75rem;
        gap: 0.4rem;
      }
      
      .navbar .logo {
        gap: 0.5rem;
      }
      
      .navbar .logo .logo-text {
        font-size: 0.95rem;
        letter-spacing: 0.5px;
      }
      
      .live-users {
        padding: 0.4rem 0.65rem;
        font-size: 0.6rem;
        border-radius: 0.75rem;
        min-width: 0;
        max-width: 200px;
      }
      
      .live-users .live-count {
        font-size: 0.85rem;
      }
      
      .live-users::before {
        width: 10px;
        height: 10px;
        top: 0.5rem;
        right: 0.5rem;
      }
    }
    /* Ad blocks styling */
    .ad-container {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.6), rgba(31, 41, 55, 0.5));
      border: 1px dashed rgba(59, 130, 246, 0.3);
      border-radius: 0.75rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 250px;
      position: relative;
      overflow: hidden;
    }
    
    .ad-container::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.05), transparent);
      opacity: 0.3;
    }
    
    .ad-placeholder {
      color: rgba(148, 163, 184, 0.6);
      font-size: 0.75rem;
      text-align: center;
      font-weight: 500;
      z-index: 1;
    }
    
    .ad-sidebar {
      position: sticky;
      top: 1rem;
      width: 260px;
      min-height: 500px;
    }
    
    .ad-native {
      margin: 1rem 0;
      min-height: 120px;
      max-height: 200px;
    }
    
    .ad-anchor {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 900;
      min-height: 50px;
      display: none;
    }
    
    @media (max-width: 768px) {
      .ad-sidebar {
        display: none;
      }
      
      .ad-anchor {
        display: flex;
      }
    }
    
    @media (min-width: 769px) {
      .ad-anchor {
        display: none;
      }
    }
    
    .main-content {
      display: block;
      padding: 0;
      max-width: 100%;
      margin: 0;
      width: 100%;
    }
    
    @media (max-width: 1400px) {
      .main-content {
        display: block;
        padding: 0;
      }
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 1rem;
      box-shadow: 0 8px 32px var(--shadow);
      padding: 1.5rem;
      border: 1px solid var(--border);
      height: fit-content;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px var(--shadow);
    }
    .card h2 {
      margin: 0 0 1.5rem 0;
      font-size: 1.5rem;
      color: var(--text);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .card h2::before {
      content: '';
      display: block;
      width: 4px;
      height: 1.5rem;
      background: var(--accent);
      border-radius: 2px;
    }
    
    .card .event-list {
      max-height: calc(100vh - 15rem);
      overflow-y: auto;
      padding-right: 0.5rem;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }
    
    .card .event-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .card .event-list::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .card .event-list::-webkit-scrollbar-thumb {
      background-color: var(--border);
      border-radius: 3px;
    }
    
    .event {
      background: var(--panel-bg);
      border-radius: 0.75rem;
      margin-bottom: 1rem;
      padding: 1rem;
      box-shadow: 0 2px 8px var(--shadow);
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      border: 1px solid var(--border);
      transition: all 0.2s;
    }
    
    .event:hover {
      transform: translateX(4px);
      border-color: var(--accent);
    }
    .event:last-child { 
      margin-bottom: 0; 
    }
    
    .event .event-icon {
      width: 2.5rem;
      height: 2.5rem;
      padding: 0.5rem;
      border-radius: 0.75rem;
      background: rgba(59, 130, 246, 0.1);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .event .event-icon svg {
      width: 100%;
      height: 100%;
    }
    
    .event .event-info {
      flex: 1;
      color: var(--text);
      font-size: 0.9375rem;
      line-height: 1.5;
      /* Limit to 3 lines on desktop */
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Show full text on mobile */
    @media (max-width: 768px) {
      .event .event-info {
        -webkit-line-clamp: unset;
        line-clamp: unset;
        display: block;
      }
    }
    
    .event .event-time {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .event .event-time::before {
      content: '';
      display: inline-block;
      width: 0.5rem;
      height: 0.5rem;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.7;
    }
    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--panel-bg);
      border-radius: 0.75rem;
      border: 1px solid var(--border);
    }
    
    .filters label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .filters input, .filters select {
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 0.625rem 1rem;
      font-size: 0.9375rem;
      background: var(--main-bg);
      color: var(--text);
      transition: all 0.2s;
      width: 100%;
    }
    
    .filters input:hover, .filters select:hover {
      border-color: var(--accent);
    }
    .filters input:focus, .filters select:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    
    .filters button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 0.5rem;
      padding: 0.625rem 1.25rem;
      font-size: 0.9375rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .filters button:hover {
      background: var(--accent);
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    .filters button:active {
      transform: translateY(0);
    }
    
    .filters button i {
      font-size: 1.25rem;
    }
    .map-card {
      grid-column: 2;
      grid-row: 1 / 4;
      padding: 0;
      overflow: hidden;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
      border-radius: 1.25rem;
      border: 1px solid rgba(208, 217, 226, 0.6);
      position: relative;
      box-shadow: 
        0 10px 40px -12px rgba(0, 0, 0, 0.25),
        0 4px 12px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.8) inset,
        0 0 60px -20px rgba(59, 130, 246, 0.15);
      transition: box-shadow 0.3s ease;
    }
    .map-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #06b6d4, #10b981, #f59e0b, #ef4444);
      border-radius: 1.25rem 1.25rem 0 0;
      z-index: 1;
      opacity: 0.8;
    }
    
    #map {
      height: calc(100vh - 4rem);
      width: 100%;
      border-radius: 1.25rem;
      background: linear-gradient(145deg, #f1f4f8, #e8edf2);
      box-shadow: 
        0 0 0 1px rgba(0, 0, 0, 0.04),
        0 4px 20px -8px rgba(0, 0, 0, 0.2),
        inset 0 0 0 1px rgba(255, 255, 255, 0.6),
        inset 0 2px 10px rgba(0, 0, 0, 0.03);
      position: relative;
    }
  /* Marker loading overlay */
  #markerLoadingOverlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: linear-gradient(140deg, rgba(10, 15, 28, 0.96), rgba(17, 24, 39, 0.96));
    z-index: 1200;
    color: #e2e8f0;
    gap: 1.2rem;
    font-family: Inter, system-ui, sans-serif;
    transition: opacity 0.5s ease, visibility 0.5s ease;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
  #markerLoadingOverlay::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 60%);
    animation: pulseGlow 3s ease-in-out infinite;
  }
  @keyframes pulseGlow {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.1); }
  }
  #markerLoadingOverlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
  #markerLoadingOverlay .spinner {
    width: 64px;
    height: 64px;
    border: 5px solid rgba(255, 255, 255, 0.1);
    border-top-color: #3b82f6;
    border-right-color: #06b6d4;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    box-shadow: 0 0 30px -5px rgba(59, 130, 246, 0.6), inset 0 0 20px rgba(59, 130, 246, 0.1);
    position: relative;
    z-index: 1;
  }
  #markerLoadingOverlay h3 {
    margin: 0;
    font-size: 1.15rem;
    font-weight: 600;
    letter-spacing: 0.5px;
    background: linear-gradient(90deg, #3b82f6, #06b6d4, #10b981);
    background-size: 200% 100%;
    animation: gradientShift 3s ease-in-out infinite;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-align: center;
    position: relative;
    z-index: 1;
  }
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  #markerLoadingOverlay p {
    margin: 0;
    font-size: 0.82rem;
    max-width: 380px;
    text-align: center;
    opacity: 0.8;
    line-height: 1.5;
    position: relative;
    z-index: 1;
  }
  
  /* Regional threat zones styling */
  .regional-threat-zone {
    pointer-events: auto;
    transition: all 0.3s ease;
  }
  
  .regional-threat-glow {
    pointer-events: none;
  }
  
  /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç—ã - —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–µ */
  
  /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞—Ä—Ç—ã - —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–µ */
  .leaflet-container {
    font-family: 'Inter', system-ui, sans-serif;
    font-size: 14px;
  }
  
  .leaflet-popup-content-wrapper {
    background: #fff;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  
  .leaflet-popup-content {
    color: #333;
  }
  
  .leaflet-popup-tip {
    background: #fff;
    border: 1px solid #ccc;
  }
  
  @keyframes spin{to{transform:rotate(360deg);}}
    #map:after { /* –ª–µ–≥–∫–∞—è –≤–∏–Ω—å–µ—Ç–∫–∞ */
      content:"";position:absolute;inset:0;pointer-events:none;background:radial-gradient(circle at 60% 40%,rgba(0,0,0,0) 60%,rgba(0,0,0,.08) 100%);
      opacity:.5;
    }
    
    .map-controls {
      position: absolute;
      top: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      z-index: 1200;
    }
    
    .map-control-btn {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.98));
      border: 1px solid rgba(195, 205, 214, 0.8);
      border-radius: 0.75rem;
      padding: 0.6rem;
      color: #1e293b;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.8) inset, 0 8px 24px -10px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
    }
    .map-control-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent);
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .map-control-btn:hover {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.9) inset, 0 0 20px rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
    }
    .map-control-btn:active { transform: translateY(-1px) scale(1.02); }
    .map-control-btn i { font-size: 22px; transition: transform 0.3s ease; }
    .map-control-btn:hover i { transform: scale(1.1); }
    
    /* Active state for region boundaries button */
    #regionBoundariesBtn.active {
      background: linear-gradient(145deg, #f59e0b, #d97706) !important;
      color: white !important;
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.45), 0 0 0 1px rgba(245, 158, 11, 0.9) inset, 0 0 25px rgba(245, 158, 11, 0.2);
      border-color: rgba(245, 158, 11, 0.6);
    }
    #regionBoundariesBtn.active:hover {
      background: linear-gradient(145deg, #d97706, #b45309) !important;
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5), 0 0 0 1px rgba(245, 158, 11, 1) inset, 0 0 30px rgba(245, 158, 11, 0.3);
    }
    
    /* Active state for text size button */
    #textSizeBtn.active {
      background: linear-gradient(145deg, #10b981, #059669) !important;
      color: white !important;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.45), 0 0 0 1px rgba(16, 185, 129, 0.9) inset, 0 0 25px rgba(16, 185, 129, 0.2);
      border-color: rgba(16, 185, 129, 0.6);
    }
    #textSizeBtn.active:hover {
      background: linear-gradient(145deg, #059669, #047857) !important;
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5), 0 0 0 1px rgba(16, 185, 129, 1) inset, 0 0 30px rgba(16, 185, 129, 0.3);
    }
    .map-controls { pointer-events: none; }
    .map-controls .map-control-btn { pointer-events: auto; }
    
    /* Enhanced Leaflet popup styles */
    .leaflet-popup-content-wrapper {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
      border: 1px solid rgba(215, 221, 227, 0.6);
      border-radius: 1rem;
      box-shadow: 0 8px 30px -8px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.8) inset;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .leaflet-popup-tip {
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid rgba(215, 221, 227, 0.6);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .leaflet-container a { color: #2563eb; transition: color 0.2s ease; }
    .leaflet-container a:hover { color: #1d4ed8; }
    
/* Simplified marker: only raw PNG image (no styled container) */
.plain-marker-img{width:100%;height:100%;object-fit:contain;image-rendering:auto;filter:drop-shadow(0 1px 2px rgba(0,0,0,.45));}

/* White outline for Shahed markers specifically */
.shahed-marker-active .plain-marker-img,
.shahed-flying .plain-marker-img {
  filter: 
    drop-shadow(0 0 3px rgba(255,255,255,0.9))
    drop-shadow(0 0 6px rgba(255,255,255,0.6))
    drop-shadow(0 1px 2px rgba(0,0,0,.45));
}

/* White outline for Shahed SVG markers */
.shahed-marker-active svg,
.shahed-flying svg {
  filter: 
    drop-shadow(0 0 3px rgba(255,255,255,0.9))
    drop-shadow(0 0 6px rgba(255,255,255,0.6))
    drop-shadow(0 1px 2px rgba(0,0,0,.45));
}

.tm-badge{position:absolute;top:-6px;right:-6px;background:linear-gradient(135deg,#dc2626,#b91c1c);color:#fff;font-size:11px;font-weight:700;padding:2px 5px;border-radius:12px;box-shadow:0 2px 6px -1px rgba(0,0,0,.5);font-family:Inter,system-ui,sans-serif;line-height:1;z-index:10;pointer-events:none;}
.tm-wrap{position:relative;display:inline-block;}  /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ - –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–π */
.marker-rotator{display:inline-flex;align-items:center;justify-content:center;transform-origin:center center;transition:transform 0.2s ease;}
  
  @keyframes popIn{from{transform:scale(.5);opacity:0;}to{transform:scale(1);opacity:1;}}
  @keyframes slideIn{from{opacity:0;transform:translateX(100px);}to{opacity:1;transform:translateX(0);}}
  @keyframes slideOut{from{opacity:1;transform:translateX(0);}to{opacity:0;transform:translateX(100px);}}
    @media (max-width: 1100px) {
      .main-content {
        grid-template-columns: 1fr;
        padding: 1rem;
      }
      
      .map-card {
        grid-column: 1;
        grid-row: 1;
        height: 50vh;
      }
      
      #map {
        height: 100%;
      }
      
      .card {
        grid-column: 1;
      }
    }
    
    @media (max-width: 700px) {
      .navbar {
        padding: 0.65rem 1rem;
        gap: 0.5rem;
      }
      
      /* Hide NEPTUN text on mobile */
      .navbar .logo .logo-text {
        font-size: 1.1rem;
      }
      
      /* Show mobile live counter, hide desktop one */
      .desktop-live {
        display: none !important;
      }
      
      .mobile-live {
        display: flex !important;
        position: static;
        transform: none;
        left: auto;
        top: auto;
        margin: 0;
        width: 100%;
        min-width: 0;
        max-width: 240px;
      }
      
      /* Ensure logo has proper flex layout on mobile */
      .navbar .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex: 1;
      }
      
      .navbar .nav-links {
        display: none;
      }
      
      .main-content {
        padding: 0.5rem;
        gap: 0.5rem;
      }
      
      .card {
        padding: 1rem;
        border-radius: 0.75rem;
      }
      
      .filters {
        grid-template-columns: 1fr;
      }
    }
    
    /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –¥–ª—è –∫–∞—Ä—Ç–∏ */
    [class*="copyrights-pane"] {
      background-color: var(--panel-bg) !important;
      color: var(--text) !important;
    }
    
    /* –ê–Ω—ñ–º–∞—Ü—ñ—ó */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .event {
      animation: fadeIn 0.3s ease-out;
    }
  /* Warning modal */
  /* Increased z-index to sit above Leaflet panes (popup pane ~700) */
  .modal-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.75);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:10000;
    animation:fadeIn .3s ease;
  }
  
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .modal{
    background:linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
    border:2px solid rgba(59,130,246,0.3);
    border-radius:1.5rem;
    padding:2.5rem;
    max-width:560px;
    width:92%;
    box-shadow:0 25px 50px -12px rgba(0,0,0,0.8), 0 0 0 1px rgba(59,130,246,0.2), inset 0 1px 0 0 rgba(255,255,255,0.05);
    font-size:1rem;
    line-height:1.7;
    position:relative;
    font-weight:500;
    animation:modalSlideIn .4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .modal::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at center, rgba(59, 130, 246, 0.08) 0%, transparent 70%);
    pointer-events: none;
  }
  
  .modal h3{
    margin:0 0 1.5rem;
    font-size:2rem;
    letter-spacing:0.5px;
    background:linear-gradient(135deg,#3b82f6,#8b5cf6,#ec4899);
    -webkit-background-clip:text;
    background-clip:text;
    -webkit-text-fill-color:transparent;
    font-weight:800;
    position:relative;
    z-index:1;
  }
  
  .modal p{
    margin:1rem 0;
    color:#e2e8f0;
    font-size:1.05rem;
    position:relative;
    z-index:1;
  }
  
  .modal p strong{
    color:#60a5fa;
    font-weight:700;
  }
  
  .modal button{
    margin-top:1.5rem;
    background:linear-gradient(135deg, #2563eb, #1d4ed8);
    color:#fff;
    font-weight:700;
    border:0;
    padding:0.875rem 2rem;
    border-radius:0.875rem;
    cursor:pointer;
    box-shadow:0 10px 25px -5px rgba(37,99,235,0.5), 0 0 0 1px rgba(59,130,246,0.3);
    transition:all .3s cubic-bezier(0.16, 1, 0.3, 1);
    font-size:1.05rem;
    letter-spacing:0.5px;
    position:relative;
    z-index:1;
    overflow:hidden;
  }
  
  .modal button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  
  .modal button:hover::before {
    width: 300px;
    height: 300px;
  }
  
  .modal button:hover{
    background:linear-gradient(135deg, #1d4ed8, #1e40af);
    transform:translateY(-3px);
    box-shadow:0 15px 35px -5px rgba(37,99,235,0.6), 0 0 0 1px rgba(59,130,246,0.4);
  }
  
  .modal button:active{
    transform:translateY(-1px);
  }
  
  .modal-close{
    position:absolute;
    top:1rem;
    right:1rem;
    background:rgba(30,41,59,0.8);
    border:2px solid rgba(59,130,246,0.3);
    color:#94a3b8;
    width:40px;
    height:40px;
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    font-weight:700;
    font-size:22px;
    line-height:1;
    transition:all .3s cubic-bezier(0.16, 1, 0.3, 1);
    z-index:2;
  }
  
  .modal-close:hover{
    color:#fff;
    background:rgba(59,130,246,0.2);
    border-color:rgba(59,130,246,0.5);
    transform:rotate(90deg) scale(1.1);
  }
  
  @media (max-width:600px){
    .modal{
      padding:2rem 1.5rem;
      font-size:0.95rem;
      border-radius:1.25rem;
    }
    .modal h3{
      font-size:1.5rem;
      margin-bottom:1rem;
    }
    .modal p{
      font-size:1rem;
    }
    .modal button{
      padding:0.75rem 1.5rem;
      font-size:1rem;
    }
    .modal-close{
      width:36px;
      height:36px;
      font-size:20px;
    }
  }
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    .input-group {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .input-suffix {
      position: absolute;
      right: 1rem;
      color: var(--text-muted);
      pointer-events: none;
    }
    
    /* About section wrapper - below the map */
    .about-section-wrapper {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1.5rem;
    }
    
    .about-section-wrapper .card {
      background: var(--card-bg);
    }
    
    .about-section-wrapper h2 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.75rem;
      color: var(--accent);
    }
    
    .info-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .info-section {
      background: var(--panel-bg);
      padding: 1.5rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      transition: transform 0.2s, border-color 0.2s;
    }
    
    .info-section:hover {
      transform: translateY(-2px);
      border-color: var(--accent);
    }
    
    .info-section h3 {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .info-section h3 .material-icons {
      font-size: 1.5rem;
    }
    
    .info-section p {
      margin: 0;
      color: var(--text2);
      font-size: 0.9375rem;
      line-height: 1.6;
    }
    
    @media (max-width: 768px) {
      .about-section-wrapper {
        margin: 1rem 0;
        padding: 2rem 1rem !important;
      }
      
      .about-section-wrapper .card {
        margin: 0 !important;
        padding: 1rem;
      }
      
      .info-content {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .info-section {
        padding: 1rem;
      }
    }
    
    .accent-link {
      color: var(--accent);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      transition: opacity 0.2s;
    }
    
    .accent-link:hover {
      opacity: 0.8;
    }
    
    .accent-link i {
      font-size: 1rem;
    }
    /* --- Mobile full-width centering fix (eliminate right gap) --- */
    * { box-sizing: border-box; }
    @media (max-width: 840px){
      html, body { width:100%; max-width:100%; overflow-x:hidden; }
      .main-content { display:block; padding:0 !important; margin:0 !important; width:100vw; max-width:100vw; }
      .map-card { width:100vw; max-width:100vw; margin:0 !important; border-radius:0; }
      .about-section-wrapper { padding-left: 1rem !important; padding-right: 1rem !important; }
      .about-section-wrapper .card { width:100% !important; max-width:100% !important; margin:0 !important; }
      #map { width:100%; max-width:100%; border-radius:0; }
    }
    /* --- Fullscreen map (custom) --- */
    body.map-expanded { overflow:hidden; }
    body.map-expanded .navbar { display:none; }
    body.map-expanded .main-content { padding:0 !important; margin:0 !important; }
    body.map-expanded .map-card { position:fixed; inset:0; z-index:500; width:100vw !important; height:100vh !important; border-radius:0 !important; }
    body.map-expanded #map { height:100vh !important; width:100vw !important; border-radius:0 !important; }
    body.map-expanded .card:not(.map-card) { display:none !important; }
    /* Dynamic viewport height for mobile browsers supporting dvh */
    @supports (height: 100dvh) {
      body.map-expanded .map-card { height:100dvh !important; }
      body.map-expanded #map { height:100dvh !important; }
    }
    /* Ensure controls stay above map in fullscreen */
  body.map-expanded .map-controls { z-index:1200; top:0.75rem; right:0.75rem; }
  /* Force-hide any default Google fullscreen control if Google re-injects it */
  .gm-fullscreen-control { display:none !important; }
  /* --- Disclaimer bar --- */
  .disclaimer-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1100;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.98));
    border-top: 1px solid rgba(251, 191, 36, 0.3);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    font-size: 0.82rem;
    color: #e2e8f0;
    line-height: 1.5;
    box-shadow: 0 -4px 30px rgba(0, 0, 0, 0.4), 0 -1px 0 rgba(251, 191, 36, 0.1) inset;
    animation: slideUpDisclaimer 0.5s ease-out;
  }
  @keyframes slideUpDisclaimer {
    from { transform: translateY(100%); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .disclaimer-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5) 20%, rgba(251, 191, 36, 0.8) 50%, rgba(251, 191, 36, 0.5) 80%, transparent);
  }
  .disclaimer-bar.hidden {display:none !important;}
  .disclaimer-bar b {color:#fbbf24;font-weight:700;text-shadow: 0 0 20px rgba(251, 191, 36, 0.4);}
  .disclaimer-icon {
    flex: 0 0 auto;
    width: 38px;
    height: 38px;
    border-radius: 12px;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 700;
    color: #fff;
    box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2), 0 4px 15px rgba(245, 158, 11, 0.4), 0 0 30px rgba(251, 191, 36, 0.2);
    animation: pulseWarning 2s ease-in-out infinite;
  }
  @keyframes pulseWarning {
    0%, 100% { box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2), 0 4px 15px rgba(245, 158, 11, 0.4), 0 0 30px rgba(251, 191, 36, 0.2); }
    50% { box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.3), 0 4px 20px rgba(245, 158, 11, 0.6), 0 0 40px rgba(251, 191, 36, 0.4); }
  }
  .disclaimer-text { flex: 1; }
  .disclaimer-close {
    margin-left: auto;
    background: linear-gradient(135deg, #1e293b, #0f172a);
    border: 1px solid rgba(148, 163, 184, 0.2);
    color: #cbd5e1;
    width: 34px;
    height: 34px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.25s ease;
  }
  .disclaimer-close:hover {
    background: linear-gradient(135deg, #334155, #1e293b);
    color: #fff;
    border-color: rgba(251, 191, 36, 0.3);
    box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
    transform: scale(1.05);
  }
  .disclaimer-actions {
    margin-top: 0.5rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.6rem;
  }
  .disclaimer-actions a {
    text-decoration: none;
    background: linear-gradient(135deg, rgba(51, 65, 85, 0.8), rgba(30, 41, 59, 0.8));
    color: #e2e8f0;
    font-size: 0.7rem;
    padding: 0.45rem 0.75rem;
    border-radius: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    border: 1px solid rgba(148, 163, 184, 0.15);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.25s ease;
  }
  .disclaimer-actions a:hover {
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(217, 119, 6, 0.2));
    color: #fbbf24;
    border-color: rgba(251, 191, 36, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
  }
  @media (max-width:720px){
    .disclaimer-bar{
      flex-direction: row;
      align-items: flex-start;
      font-size: 0.72rem;
      padding: 0.85rem 1rem;
      gap: 0.75rem;
    }
    .disclaimer-icon { width: 30px; height: 30px; font-size: 16px; border-radius: 10px; }
    .disclaimer-close { width: 28px; height: 28px; font-size: 14px; }
  }
    
  /* === –°–¢–ò–õ–ò –î–õ–Ø –¢–†–ê–Ñ–ö–¢–û–†–Ü–ô === */
  
  /* –ú–∞—Ä–∫–µ—Ä —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ë–ø–õ–ê - DISABLED FOR PERFORMANCE */
  .shahed-marker-active {
    border-radius: 50%;
  }
  
  /* –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—ë—Ç–∞ */
  .direction-arrow {
    position: absolute;
    width: 40px;
    height: 40px;
    pointer-events: none;
    z-index: 1000;
  }
  
  /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–π */
  .animated-trajectory {
    transition: opacity 0.3s ease, stroke-width 0.2s ease;
  }
  
  .animated-trajectory:hover {
    opacity: 1 !important;
    stroke-width: 5;
  }
  
  /* –ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–∏–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ */
  .black-sea-trajectory {
    stroke: #ef4444;
    stroke-width: 4;
    stroke-dasharray: 10, 6;
    stroke-linecap: round;
    fill: none;
    opacity: 0.85;
    filter: drop-shadow(0 0 4px rgba(239, 68, 68, 0.7));
  }
  
  /* SVG —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –ø–æ–ª—ë—Ç–∞ */
  .trajectory-line {
    stroke: #ef4444;
    stroke-width: 3;
    stroke-dasharray: 8, 4;
    stroke-linecap: round;
    fill: none;
    opacity: 0.9;
    filter: drop-shadow(0 0 3px rgba(239, 68, 68, 0.6));
  }
  
  /* Multi-region trajectory lines */
  .multi-region-trajectory {
    stroke: #00d4ff;
    stroke-width: 4;
    stroke-dasharray: 10, 6;
    stroke-linecap: round;
    fill: none;
    opacity: 0.8;
    filter: drop-shadow(0 0 4px rgba(0, 212, 255, 0.7));
  }
  
  /* –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ (–≤—ñ–¥ –¥–∂–µ—Ä–µ–ª–∞ –¥–æ —Ü—ñ–ª—ñ) */
  .trajectory-gradient {
    --color-start: rgba(239, 68, 68, 0.9);
    --color-end: rgba(239, 68, 68, 0.2);
  }
  
  /* –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ë–ø–õ–ê */
  .shahed-popup {
    background: rgba(17, 24, 39, 0.98);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    color: #f3f4f6;
    font-size: 14px;
    min-width: 200px;
  }
  
  .shahed-popup .popup-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(239, 68, 68, 0.2);
  }
  
  .shahed-popup .popup-icon {
    font-size: 20px;
  }
  
  .shahed-popup .popup-title {
    font-weight: 600;
    color: #ef4444;
  }
  
  .shahed-popup .popup-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 13px;
  }
  
  .shahed-popup .popup-row {
    display: flex;
    justify-content: space-between;
    gap: 12px;
  }
  
  .shahed-popup .popup-label {
    color: #9ca3af;
  }
  
  .shahed-popup .popup-value {
    color: #f3f4f6;
    font-weight: 500;
  }
  
  /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞ */
  @keyframes marker-appear {
    0% {
      opacity: 0;
      transform: scale(0.5) translateY(-20px);
    }
    60% {
      transform: scale(1.1) translateY(0);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
  
  .marker-new {
    animation: marker-appear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  </style>
</head>
<body>
  <!-- Smart Mass Attack Warning Banner -->
  <div id="massAttackBanner" class="mass-attack-banner hidden" role="alert" aria-live="assertive">
    <div class="ma-icon">‚ö†Ô∏è</div>
    <div class="ma-content">
      <div class="ma-title">–ú–æ–∂–ª–∏–≤–∞ –º–∞—Å–æ–≤–∞–Ω–∞ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∞ –∞—Ç–∞–∫–∞</div>
      <div class="ma-text" id="maDynamicText">–°—å–æ–≥–æ–¥–Ω—ñ –æ—á—ñ–∫—É—î—Ç—å—Å—è –º–∞—Å–æ–≤–∞–Ω–∞ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∞ –∞—Ç–∞–∫–∞ —à–∞—Ö–µ–¥—ñ–≤ —Ç–∞ —Ä–∞–∫–µ—Ç.</div>
      <div class="ma-meta" id="maHeuristics"></div>
    </div>
    <button class="ma-close" id="maClose" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó</button>
  </div>

  <!-- Server Donation Banner -->
  <div id="serverDonationBanner" class="server-donation-banner" style="display: none;">
    <div class="donation-close" onclick="closeServerDonationBanner()">√ó</div>
    <div class="server-donation-content">
      <div class="server-urgency-header">
        <div class="server-urgency-icon">‚ö†Ô∏è</div>
        <div class="server-urgency-text">
          <div class="server-title">–¢–µ—Ä–º—ñ–Ω–æ–≤–∏–π –∑–±—ñ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä!</div>
          <div class="server-subtitle">–ü–æ—Ç—Ä—ñ–±–Ω–æ $180 –¥–ª—è –æ–ø–ª–∞—Ç–∏ Render —Ö–æ—Å—Ç–∏–Ω–≥—É</div>
        </div>
      </div>
      
      <div class="server-explanation">
        <div class="server-warning">
          <strong>üö® –ë–µ–∑ –æ–ø–ª–∞—Ç–∏ –∫–∞—Ä—Ç–∞ –ø—Ä–∏–ø–∏–Ω–∏—Ç—å —Ä–æ–±–æ—Ç—É!</strong>
        </div>
        <div class="server-details">
          <p><span class="detail-icon">üí∞</span> <strong>–°—É–º–∞:</strong> $180 USD —â–æ–º—ñ—Å—è—Ü—è</p>
          <p><span class="detail-icon">üåê</span> <strong>–•–æ—Å—Ç–∏–Ω–≥:</strong> Render.com Professional Plan</p>
          <p><span class="detail-icon">‚è∞</span> <strong>–¢–µ—Ä–º—ñ–Ω:</strong> –î–æ –∫—ñ–Ω—Ü—è –º—ñ—Å—è—Ü—è</p>
          <p><span class="detail-icon">üë•</span> <strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:</strong> –¢–∏—Å—è—á—ñ —â–æ–¥–Ω—è –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –∫–∞—Ä—Ç–∏</p>
        </div>
      </div>
      
      <div class="server-donation-methods">
        <div class="server-method-title">–°–ø–æ—Å–æ–±–∏ –¥–æ–ø–æ–º–æ–≥–∏:</div>
        
        <div class="server-method">
          <button class="server-donate-btn mono" onclick="window.open('https://send.monobank.ua/jar/6Vi9TVzJZQ', '_blank')">
            <span class="server-btn-icon">üè¶</span>
            <span class="server-btn-text">MonoBank –ë–∞–Ω–∫–∞ ‚Ä¢ $180</span>
          </button>
        </div>
        
        <div class="server-method">
          <button class="server-donate-btn card" onclick="copyToClipboard('4441111121107290', '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ –ú–æ–Ω–æ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!')">
            <span class="server-btn-icon">üí≥</span>
            <span class="server-btn-text">–ú–æ–Ω–æ: 4441‚Ä¢‚Ä¢‚Ä¢7290</span>
          </button>
        </div>
        
        <div class="server-method">
          <button class="server-donate-btn privat" onclick="copyToClipboard('5168745153133886', '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!')">
            <span class="server-btn-icon">üèõÔ∏è</span>
            <span class="server-btn-text">–ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫: 5168‚Ä¢‚Ä¢‚Ä¢3886</span>
          </button>
        </div>
      </div>
      
      <div class="server-gratitude">
        <strong>üôè –î—è–∫—É—î–º–æ –∑–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É!</strong><br>
        <small>–†–∞–∑–æ–º –º–∏ –∑–±–µ—Ä–µ–∂–µ–º–æ –∫–∞—Ä—Ç—É –æ–Ω–ª–∞–π–Ω –¥–ª—è –≤—Å—ñ—Ö —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤</small>
      </div>
    </div>
  </div>

  <style>
    /* Mass Attack Banner - Beautiful White Design */
    .mass-attack-banner{
      position:fixed;
      top:4.5rem;
      left:50%;
      transform:translateX(-50%);
      width:min(720px,94%);
      background:linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
      border:2px solid #ef4444;
      border-radius:1.2rem;
      padding:1.2rem 1.4rem;
      display:flex;
      gap:1rem;
      z-index:1400;
      box-shadow:0 20px 50px -12px rgba(0,0,0,.15),
                 0 0 0 1px rgba(239,68,68,.1) inset,
                 0 8px 32px rgba(239,68,68,.2);
      color:#1e293b;
      animation:maSlide .55s cubic-bezier(.4,0,.2,1);
    }
    .mass-attack-banner.hidden{display:none;}
    .ma-icon{
      flex:0 0 auto;
      font-size:2.2rem;
      line-height:1;
      filter:drop-shadow(0 2px 4px rgba(239,68,68,.3));
    }
    .ma-content{flex:1;min-width:0;}
    .ma-title{
      font-size:1.15rem;
      font-weight:800;
      letter-spacing:.3px;
      margin-bottom:.5rem;
      color:#dc2626;
      text-shadow:0 1px 2px rgba(220,38,38,.1);
    }
    .ma-text{
      font-size:.95rem;
      font-weight:500;
      line-height:1.5;
      color:#334155;
    }
    .ma-meta{
      margin-top:.6rem;
      font-size:.7rem;
      letter-spacing:.8px;
      text-transform:uppercase;
      display:flex;
      flex-wrap:wrap;
      gap:.5rem;
      color:#64748b;
      font-weight:600;
    }
    .ma-close{
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      color:#64748b;
      width:36px;
      height:36px;
      border-radius:.8rem;
      font-size:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-weight:600;
      transition:.2s;
      flex-shrink:0;
    }
    .ma-close:hover{
      background:#dc2626;
      border-color:#dc2626;
      color:#fff;
      transform:scale(1.05);
    }
    @keyframes maSlide{from{opacity:0;transform:translate(-50%,-12px);}to{opacity:1;transform:translate(-50%,0);} }
    @media(max-width:680px){
      .mass-attack-banner{top:3.8rem;padding:1rem 1.1rem;border-radius:1rem;width:min(680px,92%);}
      .ma-title{font-size:1rem;}
      .ma-icon{font-size:1.8rem;}
      .ma-text{font-size:.88rem;}
    }

    /* Donation Banner Styles */
    .donation-banner {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: min(420px, calc(100vw - 40px));
      background: linear-gradient(145deg, #1e3a8a, #7c2d12, #166534);
      border: 2px solid rgba(255, 215, 0, 0.6);
      border-radius: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7), 
                  0 0 0 1px rgba(255, 215, 0, 0.2) inset,
                  0 0 30px rgba(255, 215, 0, 0.3);
      z-index: 1300;
      overflow: hidden;
      animation: donationSlideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .donation-banner:hover {
      transform: translateY(-5px);
      box-shadow: 0 35px 70px -12px rgba(0, 0, 0, 0.8), 
                  0 0 0 1px rgba(255, 215, 0, 0.3) inset,
                  0 0 40px rgba(255, 215, 0, 0.4);
    }
    
    .donation-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      z-index: 10;
      transition: all 0.2s ease;
    }
    
    .donation-close:hover {
      background: rgba(220, 38, 38, 0.8);
      transform: scale(1.1);
    }
    
    .donation-content {
      position: relative;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .donation-video {
      position: relative;
      width: 100%;
      height: 140px;
      overflow: hidden;
      border-radius: 18px 18px 0 0;
    }
    
    .donation-video video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(0.8) contrast(1.1);
    }
    
    .donation-video::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, 
                  transparent 0%, 
                  rgba(0, 0, 0, 0.3) 70%, 
                  rgba(0, 0, 0, 0.6) 100%);
    }
    
    .donation-info {
      padding: 20px;
      position: relative;
      background: linear-gradient(145deg, 
                  rgba(30, 58, 138, 0.95), 
                  rgba(124, 45, 18, 0.95), 
                  rgba(22, 101, 52, 0.95));
    }
    
    .donation-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.3rem;
      font-weight: 800;
      color: #fff;
      margin-bottom: 8px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .donation-icon {
      font-size: 1.5rem;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
    }
    
    .donation-subtitle {
      font-size: 0.9rem;
      color: #e2e8f0;
      margin-bottom: 18px;
      line-height: 1.4;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .donation-methods {
      display: grid;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .donate-btn {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      text-align: left;
      position: relative;
      overflow: hidden;
    }
    
    .donate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
                  transparent, 
                  rgba(255, 255, 255, 0.2), 
                  transparent);
      transition: left 0.5s ease;
    }
    
    .donate-btn:hover::before {
      left: 100%;
    }
    
    .donate-btn.mono {
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      color: white;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
    }
    
    .donate-btn.card {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
    }
    
    .donate-btn.privat {
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
      box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
    }
    
    .donate-btn.paypal {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: #1f2937;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }
    
    .donate-btn:hover {
      transform: translateY(-2px);
      filter: brightness(1.1);
    }
    
    .donate-btn:active {
      transform: translateY(0);
    }
    
    .btn-icon {
      font-size: 1.1rem;
      flex-shrink: 0;
    }
    
    .btn-text {
      flex: 1;
      font-size: 0.85rem;
    }
    
    .donation-message {
      text-align: center;
      font-size: 0.9rem;
      color: #fbbf24;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    @keyframes donationSlideIn {
      from {
        opacity: 0;
        transform: translateX(100%) translateY(20px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateX(0) translateY(0) scale(1);
      }
    }
    
    .donation-banner.hidden {
      display: none;
    }
    
    /* Server Donation Banner Styles */
    .server-donation-banner {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(480px, 90vw);
      max-height: 85vh;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #374151 100%);
      border: 2px solid #ef4444;
      border-radius: 20px;
      box-shadow: 0 25px 60px -15px rgba(0, 0, 0, 0.8), 
                  0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                  0 0 20px rgba(239, 68, 68, 0.4);
      z-index: 1500;
      color: #f8fafc;
      animation: serverBannerSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    @keyframes serverBannerSlide {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    @keyframes serverBannerSlideOut {
      from {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
      to {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
    }
    
    .server-donation-content {
      padding: 24px;
      position: relative;
    }
    
    .server-urgency-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 12px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }
    
    .server-urgency-header::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -100%;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, transparent, #ef4444, transparent);
    }
    
    .server-urgency-icon {
      font-size: 2.5rem;
    }
    
    .server-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #ef4444;
      margin-bottom: 4px;
    }
    
    .server-subtitle {
      font-size: 1rem;
      color: #fbbf24;
      font-weight: 500;
    }
    
    .server-explanation {
      margin-bottom: 24px;
    }
    
    .server-warning {
      background: linear-gradient(135deg, #dc2626, #ef4444);
      color: white;
      padding: 12px 16px;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 16px;
      font-size: 1rem;
      box-shadow: 0 4px 15px rgba(220, 38, 38, 0.4);
    }
    
    .server-details {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 12px;
      padding: 16px;
    }
    
    .server-details p {
      margin: 8px 0;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 0.9rem;
    }
    
    .detail-icon {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
    }
    
    .server-details strong {
      color: #fbbf24;
      min-width: 100px;
    }
    
    .server-donation-methods {
      margin-bottom: 20px;
    }
    
    .server-method-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e5e7eb;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .server-method {
      margin-bottom: 12px;
    }
    
    .server-donate-btn {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
      position: relative;
      overflow: hidden;
    }
    
    .server-donate-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .server-donate-btn:hover::before {
      left: 100%;
    }
    
    .server-donate-btn.mono {
      background: linear-gradient(135deg, #7c3aed, #a855f7);
      color: white;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
    }
    
    .server-donate-btn.card {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      color: white;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4);
    }
    
    .server-donate-btn.privat {
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
      box-shadow: 0 4px 15px rgba(5, 150, 105, 0.4);
    }
    
    .server-donate-btn.paypal {
      background: linear-gradient(135deg, #f59e0b, #fbbf24);
      color: #1f2937;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }
    
    .server-donate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .server-btn-icon {
      font-size: 1.2rem;
    }
    
    .server-gratitude {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
    
    .server-gratitude strong {
      color: #10b981;
      font-size: 1.1rem;
    }
    
    .server-gratitude small {
      color: #d1d5db;
      font-size: 0.85rem;
      display: block;
      margin-top: 8px;
    }
    
    /* Mini Donation Banner Styles */
    .mini-donation-banner {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 280px;
      background: linear-gradient(135deg, #1e3a8a, #7c2d12, #166534);
      border: 1px solid rgba(255, 215, 0, 0.4);
      border-radius: 12px;
      box-shadow: 0 8px 25px -8px rgba(0, 0, 0, 0.6), 
                  0 0 0 1px rgba(255, 215, 0, 0.15) inset;
      z-index: 1200;
      animation: miniSlideIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .mini-donation-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px -8px rgba(0, 0, 0, 0.7), 
                  0 0 0 1px rgba(255, 215, 0, 0.25) inset;
    }
    
    .mini-donation-banner.hidden {
      display: none;
    }
    
    .mini-donation-content {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
    }
    
    .mini-donation-icon {
      font-size: 1.8rem;
      flex-shrink: 0;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
    }
    
    .mini-donation-text {
      flex: 1;
      min-width: 0;
    }
    
    .mini-donation-title {
      font-size: 0.9rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 2px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    }
    
    .mini-donation-subtitle {
      font-size: 0.75rem;
      color: #e2e8f0;
      opacity: 0.9;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .mini-donate-btn {
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      border: none;
      border-radius: 8px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .mini-donate-btn:hover {
      background: linear-gradient(135deg, #2563eb, #1e40af);
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.6);
    }
    
    .mini-donate-btn:active {
      transform: scale(0.95);
    }
    
    .mini-btn-icon {
      font-size: 1.1rem;
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
    }
    
    @keyframes miniSlideIn {
      from {
        opacity: 0;
        transform: translateX(100%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
    }
    
    @keyframes miniSlideOut {
      from {
        opacity: 1;
        transform: translateX(0) scale(1);
      }
      to {
        opacity: 0;
        transform: translateX(100%) scale(0.8);
      }
    }
    
    /* Mobile responsiveness */
    @media (max-width: 480px) {
      .donation-banner {
        bottom: 10px;
        right: 10px;
        left: 10px;
        width: calc(100vw - 20px);
      }
      
      .donation-video {
        height: 120px;
      }
      
      .donation-title {
        font-size: 1.1rem;
      }
      
      .donation-subtitle {
        font-size: 0.8rem;
      }
      
      .donate-btn {
        padding: 10px 12px;
        font-size: 0.8rem;
      }
      
      .btn-text {
        font-size: 0.75rem;
      }
      
      /* Mini banner mobile styles */
      .mini-donation-banner {
        top: 10px;
        right: 10px;
        width: 240px;
      }
      
      .mini-donation-content {
        padding: 12px;
        gap: 10px;
      }
      
      .mini-donation-icon {
        font-size: 1.5rem;
      }
      
      .mini-donation-title {
        font-size: 0.8rem;
      }
      
      .mini-donation-subtitle {
        font-size: 0.7rem;
      }
      
      .mini-donate-btn {
        width: 32px;
        height: 32px;
      }
      
      .mini-btn-icon {
        font-size: 1rem;
      }
    }
  </style>
  <style>
  /* Place search control - Modern Design */
  .place-search:hover{box-shadow:0 12px 38px -8px rgba(0,0,0,.65),0 0 0 1px rgba(59,130,246,.25),0 2px 16px rgba(37,99,235,.15);}
  .place-search input{background:rgba(255,255,255,.08);border:1.5px solid rgba(255,255,255,.12);color:#fff;padding:.55rem .85rem;border-radius:.9rem;min-width:280px;font-size:.85rem;outline:none;transition:.25s cubic-bezier(.34,1.56,.64,1);font-weight:500;letter-spacing:.3px;}
  .place-search input::placeholder{color:rgba(255,255,255,.5);font-weight:400;}
  .place-search input:focus{border-color:#3b82f6;background:rgba(59,130,246,.12);box-shadow:0 0 0 3px rgba(59,130,246,.25),0 4px 12px rgba(37,99,235,.2);transform:translateY(-1px);} 
  .place-search{position:absolute;top:1.2rem;left:50%;transform:translateX(-50%);display:flex;gap:.5rem;background:linear-gradient(135deg,rgba(15,23,42,.95) 0%,rgba(30,41,59,.92) 100%);padding:.65rem .95rem;border-radius:1.3rem;box-shadow:0 8px 32px -8px rgba(0,0,0,.6),0 0 0 1px rgba(59,130,246,.15),0 2px 12px rgba(37,99,235,.1);z-index:950;align-items:center;transition:.3s cubic-bezier(.34,1.56,.64,1);}
  .place-search input{background:rgba(255,255,255,.08);border:1px solid rgba(59,130,246,.25);color:#f1f5f9;padding:.55rem .8rem;border-radius:.85rem;font-size:.85rem;width:340px;outline:none;transition:.25s;font-weight:500;}
  .place-search input::placeholder{color:rgba(255,255,255,.45);font-weight:400;}
  .place-search input:focus{border-color:rgba(59,130,246,.65);background:rgba(59,130,246,.1);box-shadow:0 0 0 3px rgba(59,130,246,.1);}
  .place-search button{background:linear-gradient(135deg,#2563eb 0%,#7c3aed 100%);border:none;color:#fff;padding:.55rem .85rem;border-radius:.85rem;cursor:pointer;display:flex;align-items:center;gap:.3rem;box-shadow:0 4px 16px -4px rgba(37,99,235,.6),0 0 0 1px rgba(255,255,255,.15) inset;transition:.25s cubic-bezier(.34,1.56,.64,1);font-size:.8rem;font-weight:600;letter-spacing:.5px;position:relative;overflow:hidden;}
  .place-search button:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.2),transparent);opacity:0;transition:.25s;}
  .place-search button:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 6px 22px -4px rgba(37,99,235,.7),0 0 0 1px rgba(255,255,255,.25) inset;}
  .place-search button:hover:before{opacity:1;}
  .place-search button:active{transform:translateY(-1px) scale(.98);} 
  @media (max-width:820px){.place-search{top:auto;bottom:.9rem;left:.9rem;transform:none;right:.9rem;margin:0;flex-wrap:nowrap;min-width:0;padding:.55rem .75rem;}.place-search input{min-width:0;width:170px;font-size:.8rem;padding:.5rem .7rem;}}
  .ps-suggest::-webkit-scrollbar{width:6px;}
  .ps-suggest::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:3px;}
  .ps-suggest::-webkit-scrollbar-thumb{background:rgba(59,130,246,.4);border-radius:3px;}
  .ps-suggest::-webkit-scrollbar-thumb:hover{background:rgba(59,130,246,.6);}
  .ps-item{padding:.55rem .75rem;border-radius:.8rem;font-size:.8rem;cursor:pointer;display:flex;justify-content:space-between;gap:.7rem;transition:.2s;color:#e2e8f0;font-weight:500;}
  .ps-item:hover{background:rgba(59,130,246,.15);transform:translateX(4px);box-shadow:0 2px 8px rgba(59,130,246,.15);}
  .ps-item.active{background:rgba(59,130,246,.2);box-shadow:0 2px 12px rgba(59,130,246,.2);}
  .ps-item span:first-child{color:#fff;font-weight:600;}
  .ps-item span:last-child{color:rgba(255,255,255,.6);font-size:.75rem;}
  .ps-empty{padding:.65rem .8rem;font-size:.75rem;color:rgba(255,255,255,.5);text-align:center;font-weight:500;}
    .donate-modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:1400;}
    .donate-modal-overlay.active{display:flex;animation:fadeIn .35s ease;}
    .donate-modal{
      width:min(560px,92vw);
      background:linear-gradient(160deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);
      border:1px solid rgba(59,130,246,.2);
      border-radius:24px;
      padding:2rem;
      position:relative;
      box-shadow:0 25px 60px -15px rgba(0,0,0,.6),0 0 80px rgba(59,130,246,.1);
      font-family:inherit;
      color:#e2e8f0;
      animation:modalSlideUp .4s cubic-bezier(.34,1.56,.64,1);
    }
    @keyframes modalSlideUp{from{opacity:0;transform:translateY(30px) scale(.95);}to{opacity:1;transform:translateY(0) scale(1);}}
    .donate-modal:before{content:"";position:absolute;inset:0;border-radius:inherit;padding:1px;background:linear-gradient(135deg,rgba(59,130,246,.5),rgba(139,92,246,.4),rgba(59,130,246,.3));-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;}
    .donate-title{margin:0 0 1rem;font-size:1.5rem;letter-spacing:.5px;font-weight:800;background:linear-gradient(135deg,#60a5fa,#a78bfa,#60a5fa);background-size:200% 200%;-webkit-background-clip:text;background-clip:text;color:transparent;display:flex;align-items:center;gap:.6rem;animation:logoShine 3s ease infinite;}
    .donate-sub{margin:0 0 1.25rem;font-size:.9rem;color:rgba(148,163,184,.9);line-height:1.6;}
    .donate-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));margin:0 0 1.25rem;}
    .donate-card{
      position:relative;
      background:rgba(30,41,59,.5);
      border:1px solid rgba(59,130,246,.15);
      border-radius:16px;
      padding:1.1rem;
      display:flex;
      flex-direction:column;
      gap:.6rem;
      overflow:hidden;
      min-height:120px;
      transition:.3s;
    }
    .donate-card:hover{border-color:rgba(59,130,246,.3);transform:translateY(-2px);box-shadow:0 10px 30px -10px rgba(59,130,246,.2);}
    .donate-card:before{content:"";position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle,rgba(59,130,246,.2),transparent 70%);pointer-events:none;}
    .donate-label{font-size:.7rem;text-transform:uppercase;letter-spacing:1.5px;font-weight:700;color:#60a5fa;}
    .donate-value{font-family:'JetBrains Mono',monospace,Consolas,monospace;font-weight:600;font-size:1rem;word-break:break-all;color:#f1f5f9;}
    .donate-actions{margin-top:auto;display:flex;gap:.5rem;flex-wrap:wrap;}
    .btn-mini{
      background:linear-gradient(135deg,#2563eb,#3b82f6);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:.5rem .85rem;
      font-size:.7rem;
      font-weight:600;
      letter-spacing:.4px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:.4rem;
      box-shadow:0 4px 15px -4px rgba(37,99,235,.4);
      transition:.25s;
    }
    .btn-mini.alt{background:rgba(51,65,85,.8);box-shadow:none;}
    .btn-mini:hover{transform:translateY(-2px);box-shadow:0 6px 20px -4px rgba(37,99,235,.5);}
    .btn-mini.alt:hover{background:rgba(71,85,105,.9);}
    .donate-close{position:absolute;top:1rem;right:1rem;width:36px;height:36px;background:rgba(30,41,59,.8);border:1px solid rgba(255,255,255,.1);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#94a3b8;cursor:pointer;font-weight:600;font-size:16px;transition:.2s;}
    .donate-close:hover{background:rgba(51,65,85,.9);color:#fff;border-color:rgba(255,255,255,.2);}
    .jar-link-button{
      width:100%;
      background:linear-gradient(135deg,#3b82f6,#8b5cf6);
      color:#fff;
      border:none;
      border-radius:14px;
      padding:1rem 1.5rem;
      font-size:.9rem;
      font-weight:700;
      letter-spacing:.5px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.6rem;
      margin-top:.5rem;
      cursor:pointer;
      box-shadow:0 8px 30px -8px rgba(59,130,246,.4);
      transition:.3s;
      position:relative;
      overflow:hidden;
    }
    .jar-link-button::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:.5s;}
    .jar-link-button:hover::before{left:100%;}
    .jar-link-button:hover{transform:translateY(-3px);box-shadow:0 12px 40px -8px rgba(59,130,246,.5);}    
    .donate-footer{font-size:.65rem;color:rgba(100,116,139,.8);margin-top:.75rem;letter-spacing:.3px;text-align:center;}
    .copy-toast {
      position: fixed;
      bottom: calc(1.4rem + 64px);
      right: 1.4rem;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(59, 130, 246, 0.3);
      color: #e2e8f0;
      padding: 0.7rem 1rem;
      border-radius: 0.85rem;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.5px;
      box-shadow: 0 8px 30px -8px rgba(0, 0, 0, 0.5), 0 0 20px rgba(59, 130, 246, 0.15);
      display: none;
      z-index: 1500;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      animation: toastSlideIn 0.3s ease-out;
    }
    @keyframes toastSlideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .copy-toast.show{display:block;animation:fadeIn .25s ease, fadeOut .4s linear 2.4s forwards;}
    @keyframes fadeOut{to{opacity:0;transform:translateY(4px);}}
    
    /* Support button in navbar */
    .support-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
    }
    .support-btn i {
      font-size: 16px;
      animation: heartPulse 1.5s ease infinite;
    }
    @keyframes heartPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.15); }
    }
    .support-btn:hover {
      background: linear-gradient(135deg, #ff7b7b 0%, #ff6b6b 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    .support-btn:active {
      transform: translateY(0) scale(0.98);
    }
    @media (max-width: 700px) {
      .support-btn {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 8px;
      }
      .support-btn i {
        font-size: 14px;
      }
    }
    /* Mobile support button */
    .support-btn-mobile {
      display: none;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.25s ease;
      box-shadow: 0 2px 10px rgba(255, 107, 107, 0.3);
    }
    .support-btn-mobile i {
      font-size: 18px;
      animation: heartPulse 1.5s ease infinite;
    }
    .support-btn-mobile:hover {
      background: linear-gradient(135deg, #ff7b7b 0%, #ff6b6b 100%);
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    .support-btn-mobile:active {
      transform: scale(0.95);
    }
    @media (max-width: 900px) {
      .support-btn-mobile {
        display: flex;
      }
    }
    
    .map-theme-fab{position:fixed;bottom:5rem;right:1.5rem;z-index:1300;background:linear-gradient(135deg,rgba(30,41,59,.95),rgba(51,65,85,.95));backdrop-filter:blur(10px);color:#fff;border:1px solid rgba(255,255,255,.1);border-radius:14px;width:3.2rem;height:3.2rem;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 8px 25px -8px rgba(0,0,0,.4);transition:.25s;}
    .map-theme-fab i{font-size:18px;}
    .map-theme-fab:hover{transform:translateY(-3px);box-shadow:0 12px 30px -8px rgba(0,0,0,.5);border-color:rgba(59,130,246,.3);}
    .map-theme-fab:active{transform:translateY(0) scale(.98);}
    @media (max-width:700px){.map-theme-fab{bottom:4.4rem;right:.9rem;width:2.8rem;height:2.8rem;border-radius:12px;} .map-theme-fab i{font-size:16px;}}
    @media (max-width:900px){ .map-theme-fab{ right:1rem; bottom:4.6rem; } }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –∫–∞—Ä—Ç—ã */
    .map-dark-theme .leaflet-marker-icon {
      filter: drop-shadow(0 0 4px rgba(255,255,255,0.8)) brightness(1.1) !important;
    }
    
    .map-dark-theme .leaflet-popup-content-wrapper {
      background: #1f2937 !important;
      color: #f3f4f6 !important;
    }
    
    .map-dark-theme .leaflet-popup-tip {
      background: #1f2937 !important;
    }
    
    .map-dark-theme .leaflet-control-zoom a {
      background: #374151 !important;
      color: #f3f4f6 !important;
      border-color: #4b5563 !important;
    }
    
    .map-dark-theme .leaflet-control-zoom a:hover {
      background: #4b5563 !important;
    }
    
    .map-dark-theme .leaflet-control-attribution {
      background: rgba(31, 41, 55, 0.8) !important;
      color: #d1d5db !important;
    }
    
    .map-dark-theme .leaflet-control-attribution a {
      color: #93c5fd !important;
    }
    
    /* –°—Ç–∏–ª—ñ –¥–ª—è MarkerCluster –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ */
    .marker-cluster-small {
      background-color: rgba(59, 130, 246, 0.6);
    }
    .marker-cluster-small div {
      background-color: rgba(59, 130, 246, 0.8);
    }
    
    .marker-cluster-medium {
      background-color: rgba(245, 158, 11, 0.6);
    }
    .marker-cluster-medium div {
      background-color: rgba(245, 158, 11, 0.8);
    }
    
    .marker-cluster-large {
      background-color: rgba(239, 68, 68, 0.6);
    }
    .marker-cluster-large div {
      background-color: rgba(239, 68, 68, 0.8);
    }
    
    .marker-cluster {
      background-clip: padding-box;
      border-radius: 20px;
    }
    .marker-cluster div {
      width: 30px;
      height: 30px;
      margin-left: 5px;
      margin-top: 5px;
      text-align: center;
      border-radius: 15px;
      font: 12px "Inter", "Helvetica Neue", Arial, Helvetica, sans-serif;
      font-weight: 700;
    }
    .marker-cluster span {
      line-height: 30px;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

  </style>


  <button class="map-theme-fab" id="mapThemeFab" onclick="toggleMapTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏ —Ç–µ–º—É –∫–∞—Ä—Ç–∏"><i class="material-icons" id="mapThemeIcon">dark_mode</i></button>
  <div class="donate-modal-overlay" id="donateModal" role="dialog" aria-labelledby="donateTitle" aria-modal="true">
    <div class="donate-modal">
      <button class="donate-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏" onclick="toggleDonate(false)">√ó</button>
      <h3 class="donate-title" id="donateTitle"><i class="material-icons" style="font-size:22px;">favorite</i>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑—Ä–æ–±–∫—É</h3>
      <p class="donate-sub">–í–∞—à–∞ –¥–æ–ø–æ–º–æ–≥–∞ –ø—Ä–∏—à–≤–∏–¥—à—É—î —Ä–æ–∑–≤–∏—Ç–æ–∫ —Ç–æ—á–Ω–æ—Å—Ç—ñ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ–π –º–∞–ø–∏. –ö–æ–∂–Ω–∞ –≥—Ä–∏–≤–Ω—è = –∫—Ä–∞—â–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∑–∞–≥—Ä–æ–∑.</p>
      <div class="donate-grid">
        <div class="donate-card">
          <div class="donate-label">–ú–æ–Ω–æ (UAH)</div>
          <div class="donate-value" data-val="4441111121107290">4441 1111 2110 7290</div>
          <div class="donate-actions">
            <button class="btn-mini" onclick="copyDonate('4441111121107290', this)"><i class="material-icons" style="font-size:14px;">content_copy</i>–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
        </div>
        <div class="donate-card">
          <div class="donate-label">–ü—Ä–∏–≤–∞—Ç (UAH)</div>
          <div class="donate-value" data-val="5168745153133886">5168 7451 5313 3886</div>
          <div class="donate-actions">
            <button class="btn-mini" onclick="copyDonate('5168745153133886', this)"><i class="material-icons" style="font-size:14px;">content_copy</i>–ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
          </div>
        </div>
        <div class="donate-card">
          <div class="donate-label">Monobank –ë–∞–Ω–∫–∞</div>
          <div class="donate-value" style="font-size:.8rem;line-height:1.25;word-break:break-word;">send.monobank.ua/jar/6Vi9TVzJZQ</div>
          <div class="donate-actions">
            <button class="btn-mini" onclick="openJar()"><i class="material-icons" style="font-size:14px;">open_in_new</i>–í—ñ–¥–∫—Ä–∏—Ç–∏</button>
            <button class="btn-mini alt" onclick="copyDonate('https://send.monobank.ua/jar/6Vi9TVzJZQ', this)"><i class="material-icons" style="font-size:14px;">content_copy</i>–õ—ñ–Ω–∫</button>
          </div>
        </div>
      </div>
      <button class="jar-link-button" onclick="openJar()"><i class="material-icons">rocket_launch</i><span>–ó–∞–¥–æ–Ω–∞—Ç–∏—Ç–∏ –∑–∞—Ä–∞–∑</span></button>
      <div class="donate-footer">–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –Ω–µ —Å—Ç–≤–æ—Ä—é—î –∑–æ–±–æ–≤'—è–∑–∞–Ω—å. –ó–≤—ñ—Ç–∏ –π –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —É —Å–ø—ñ–ª—å–Ω–æ—Ç—ñ Telegram.</div>
  <div class="donate-footer">–ê–¥–º—ñ–Ω–º–µ–∂—ñ: OCHA FISS / SSP–ï ¬´–ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ—ñ—è¬ª, COD-AB (–æ–Ω–æ–≤–ª. —Å—ñ—á–µ–Ω—å 2025), CC BY-IGO. –ú–æ–∂–ª–∏–≤—ñ –∑–∞—Ç—Ä–∏–º–∫–∏ –ø–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–Ω—å (—Ä–µ—Ñ–æ—Ä–º–∞ hromadas).</div>
    </div>
  </div>
  <div class="copy-toast" id="copyToast">–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ</div>
  <div id="disclaimerBar" class="disclaimer-bar" role="note" aria-label="–í–∞–∂–ª–∏–≤–µ –∑–∞—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è" style="display:none;">
    <div class="disclaimer-icon">!</div>
    <div class="disclaimer-text">
      <div><b>–£–í–ê–ì–ê:</b> –î–∞–Ω—ñ —Ñ–æ—Ä–º—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∂–µ—Ä–µ–ª (Telegram —Ç–æ—â–æ) —Ç–∞ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Ö–∏–±–∫–∏. –°–µ—Ä–≤—ñ—Å <b>–Ω–µ —î</b> –æ—Ñ—ñ—Ü—ñ–π–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é –æ–ø–æ–≤—ñ—â–µ–Ω–Ω—è —ñ –Ω–µ –∑–∞–º—ñ–Ω—é—î —Å–∏–≥–Ω–∞–ª—ñ–≤ –ü–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è –∫–æ—Ä–∏–≥—É–≤–∞–Ω–Ω—è –≤–æ–≥–Ω—é —á–∏ —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è –ø–æ–∑–∏—Ü—ñ–π –°–∏–ª –û–±–æ—Ä–æ–Ω–∏. –ó–∞–≤–∂–¥–∏ –¥–æ—Ç—Ä–∏–º—É–π—Ç–µ—Å—å –≤–∫–∞–∑—ñ–≤–æ–∫ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –æ—Ä–≥–∞–Ω—ñ–≤.</div>
      <div class="disclaimer-actions">
        <a href="#about"><span class="material-icons" style="font-size:14px;">info</span> –î–æ–∫–ª–∞–¥–Ω—ñ—à–µ</a>
        <a href="https://t.me/+zFxu_4W_ishiNjli" target="_blank" rel="noopener"><span class="material-icons" style="font-size:14px;">group</span> –°–ø—ñ–ª—å–Ω–æ—Ç–∞</a>
      </div>
    </div>
    <button class="disclaimer-close" aria-label="–ó–∞–∫—Ä–∏—Ç–∏" onclick="hideDisclaimer()">√ó</button>
  </div>
  <div class="navbar">
    <div class="logo">
      <span class="logo-text">NEPTUN</span>
      <div class="live-users mobile-live" id="liveUsers" title="–ê–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ –∑–∞—Ä–∞–∑ –æ–Ω–ª–∞–π–Ω ‚Ä¢ –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥">
        <div class="live-header">
          <span class="live-label">–æ–Ω–ª–∞–π–Ω</span>
          <span class="live-count" data-role="live-total">0</span>
        </div>
        <div class="live-breakdown">
          <span class="live-chip">
            üåê <strong data-role="live-web">0</strong>
          </span>
          <span class="live-chip">
            üì± <strong data-role="live-apps">0</strong>
          </span>
          <span class="live-chip">
            ü§ñ <strong data-role="live-android">0</strong>
          </span>
          <span class="live-chip">
            üçé <strong data-role="live-ios">0</strong>
          </span>
        </div>
      </div>
    </div>
    <button class="support-btn-mobile" onclick="toggleDonate()" title="–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç"><i class="material-icons">favorite</i></button>
    <div class="nav-links">
      <a href="#map" class="active"><i class="material-icons">map</i> –ö–∞—Ä—Ç–∞</a>
      <a href="/analytics" target="_blank"><i class="material-icons">analytics</i> –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</a>
      <a href="#about"><i class="material-icons">info</i> –Ü–Ω—Ñ–æ</a>
      <button class="support-btn" onclick="toggleDonate()" title="–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç"><i class="material-icons">favorite</i> –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏</button>
    </div>
    <div class="live-users desktop-live" id="liveUsersDesktop" title="–ê–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ –∑–∞—Ä–∞–∑ –æ–Ω–ª–∞–π–Ω ‚Ä¢ –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥">
      <div class="live-header">
        <span class="live-label">–æ–Ω–ª–∞–π–Ω</span>
        <span class="live-count" data-role="live-total">0</span>
      </div>
      <div class="live-breakdown">
        <span class="live-chip">
          üåê <strong data-role="live-web">0</strong>
        </span>
        <span class="live-chip">
          üì± <strong data-role="live-apps">0</strong>
        </span>
        <span class="live-chip">
          ü§ñ <strong data-role="live-android">0</strong>
        </span>
        <span class="live-chip">
          üçé <strong data-role="live-ios">0</strong>
        </span>
      </div>
    </div>
  </div>

  <!-- SEO Optimized Header - TOP queries: –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥, –∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤, –∫–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω, —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ -->
  <header class="seo-header" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); border: 0;">
    <h1>–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ üö® –ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ | –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω - NEPTUN –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑</h1>
    <h2>–ö–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω: –ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ | –ú–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤ | –ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω</h2>
    <h3>–ù–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç–∞ | Neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑ | –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ —Ç–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ 24/7</h3>
    <h4>–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω | –ö–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ | –†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ –£–∫—Ä–∞—ó–Ω–∞ | –ù–µ–ø—Ç—É–Ω</h4>
    <p>
      <strong>–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥</strong> —Ç–∞ <strong>–ö–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤</strong> NEPTUN - –Ω–∞–π—Ç–æ—á–Ω—ñ—à–∞ <strong>–∫–∞—Ä—Ç–∞ –Ω–µ–ø—Ç—É–Ω</strong> —Ç–∞ <strong>—Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤</strong> –æ–Ω–ª–∞–π–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ! 
      <strong>–ù–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç–∞</strong> - —Ü–µ <strong>–∫–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</strong> —Ç–∞ <strong>–∫–∞—Ä—Ç–∞ —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω</strong> –∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥. 
      <strong>Neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑</strong> –ø–æ–∫–∞–∑—É—î <strong>–º–∞–ø–∞ —à–∞—Ö–µ–¥—ñ–≤</strong>, –±–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ —Ä–∞–∫–µ—Ç–∏, –∫—Ä–∏–ª–∞—Ç—ñ —Ä–∞–∫–µ—Ç–∏, FPV –¥—Ä–æ–Ω–∏, –ö–ê–ë–∏, –æ–±—Å—Ç—Ä—ñ–ª–∏, –†–°–ó–í, –∞–≤—ñ–∞—Ü—ñ—é. 
      <strong>–†–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤</strong> —Ç–∞ <strong>–∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥</strong> –ø—Ä–∞—Ü—é—î 24/7 –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ. 
      80,000+ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –æ–±–∏—Ä–∞—é—Ç—å –Ω–∞—à—É <strong>–∫–∞—Ä—Ç—É —à–∞—Ö–µ–¥—ñ–≤</strong> —Ç–∞ <strong>–∫–∞—Ä—Ç—É –Ω–µ–ø—Ç—É–Ω</strong> —â–æ–¥–Ω—è. 
      –ú–æ–±—ñ–ª—å–Ω—ñ –¥–æ–¥–∞—Ç–∫–∏ iOS/Android —Ç–∞ Telegram —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è. –¢–æ—á–Ω–∞ <strong>–∫–∞—Ä—Ç–∞ –ø–æ–ª—å–æ—Ç—É —à–∞—Ö–µ–¥—ñ–≤</strong> —Ç–∞ <strong>—Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤</strong> –¥–ª—è –≤—Å—ñ—Ö —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤!
    </p>
    
    <nav aria-label="–û—Å–Ω–æ–≤–Ω—ñ —Ä–æ–∑–¥—ñ–ª–∏ –∫–∞—Ä—Ç–∏ —Ç—Ä–∏–≤–æ–≥ —Ç–∞ —Ä–∞–¥–∞—Ä—É —à–∞—Ö–µ–¥—ñ–≤">
      <ul>
        <li><a href="#map">–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ —Ç–∞ —Ä–∞–¥–∞—Ä —à–∞—Ö–µ–¥—ñ–≤ –æ–Ω–ª–∞–π–Ω</a></li>
        <li><a href="/blackouts">–ö–∞—Ä—Ç–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å —Å–≤—ñ—Ç–ª–∞</a></li>
        <li><a href="/about">–ü—Ä–æ —Å–∏—Å—Ç–µ–º—É Neptun –∫–∞—Ä—Ç–∞ –∑–∞–≥—Ä–æ–∑</a></li>
        <li><a href="/faq">–ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –∫–∞—Ä—Ç—É —à–∞—Ö–µ–¥—ñ–≤ —Ç–∞ –Ω–µ–ø—Ç—É–Ω –∫–∞—Ä—Ç—É</a></li>
        <li><a href="/safety">–ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–ø–µ–∫–∏ –ø—Ä–∏ —Ç—Ä–∏–≤–æ–∑—ñ —Ç–∞ —à–∞—Ö–µ–¥–∞—Ö</a></li>
      </ul>
    </nav>
    
    <article>
      <h5>–¢–∏–ø–∏ –∑–∞–≥—Ä–æ–∑ –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–∏–≤–æ–≥:</h5>
      <ul>
        <li><strong>–®–∞—Ö–µ–¥–∏ (SHAHED)</strong> - –±–µ–∑–ø—ñ–ª–æ—Ç–Ω—ñ –ª—ñ—Ç–∞–ª—å–Ω—ñ –∞–ø–∞—Ä–∞—Ç–∏-–∫–∞–º—ñ–∫–∞–¥–∑–µ —Ç–∏–ø—É Shahed-136 –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–∏–≤–æ–≥</li>
        <li><strong>–ë–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ —Ä–∞–∫–µ—Ç–∏</strong> - –≤–∏—Å–æ–∫–æ—à–≤–∏–¥–∫—ñ—Å–Ω—ñ —Ä–∞–∫–µ—Ç–∏ –∑ –∫–æ—Ä–æ—Ç–∫–∏–º —á–∞—Å–æ–º –ø—ñ–¥–ª—å–æ—Ç—É –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–µ–≤–æ–≥</li>
        <li><strong>–ö—Ä–∏–ª–∞—Ç—ñ —Ä–∞–∫–µ—Ç–∏</strong> - –∫–µ—Ä–æ–≤–∞–Ω—ñ —Ä–∞–∫–µ—Ç–∏ –∑ –º–∞—Ä—à–æ–≤–∏–º –¥–≤–∏–≥—É–Ω–æ–º</li>
        <li><strong>FPV –¥—Ä–æ–Ω–∏</strong> - –º–∞–ª—ñ –±–µ–∑–ø—ñ–ª–æ—Ç–Ω–∏–∫–∏ –∑ –∫–∞–º–µ—Ä–æ—é –≤—ñ–¥ –ø–µ—Ä—à–æ—ó –æ—Å–æ–±–∏</li>
        <li><strong>–ö–ê–ë–∏</strong> - –∫–µ—Ä–æ–≤–∞–Ω—ñ –∞–≤—ñ–∞—Ü—ñ–π–Ω—ñ –±–æ–º–±–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏</li>
        <li><strong>–ê—Ä—Ç–∏–ª–µ—Ä—ñ–π—Å—å–∫—ñ –æ–±—Å—Ç—Ä—ñ–ª–∏</strong> - –∑–∞–≥—Ä–æ–∑–∞ –≤—ñ–¥ –Ω–∞–∑–µ–º–Ω–æ—ó –∞—Ä—Ç–∏–ª–µ—Ä—ñ—ó</li>
        <li><strong>–†–°–ó–í</strong> - —Ä–µ–∞–∫—Ç–∏–≤–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –∑–∞–ª–ø–æ–≤–æ–≥–æ –≤–æ–≥–Ω—é</li>
        <li><strong>–ê–≤—ñ–∞—Ü—ñ—è</strong> - –∑–∞–≥—Ä–æ–∑–∞ –≤—ñ–¥ –≤–æ—Ä–æ–∂–æ—ó –∞–≤—ñ–∞—Ü—ñ—ó –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–∏–≤–æ–≥</li>
        <li><strong>–†–æ–∑–≤—ñ–¥—É–≤–∞–ª—å–Ω—ñ –¥—Ä–æ–Ω–∏</strong> - —Ä–æ–∑–≤—ñ–¥–∫–∞ —Ç–µ—Ä–∏—Ç–æ—Ä—ñ—ó</li>
        <li><strong>–í–∏–±—É—Ö–∏</strong> - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∏–±—É—Ö–∏ –≤ —Ä–µ–≥—ñ–æ–Ω–∞—Ö</li>
        <li><strong>–í—ñ–¥–±—ñ–π —Ç—Ä–∏–≤–æ–≥–∏</strong> - —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ—Ç—Ä—è–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏</li>
      </ul>
    </article>
    
    <section>
      <h5>–û—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∫–∞—Ä—Ç–∏ —Ç—Ä–∏–≤–æ–≥ NEPTUN:</h5>
      <ul>
        <li>‚úÖ –ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –æ–Ω–ª–∞–π–Ω - –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</li>
        <li>‚úÖ –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –∑ –ø–æ–∑–Ω–∞—á–µ–Ω–Ω—è–º –≤—Å—ñ—Ö —Ç–∏–ø—ñ–≤ –∑–∞–≥—Ä–æ–∑</li>
        <li>‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–∂–Ω—É –∑–∞–≥—Ä–æ–∑—É –Ω–∞ –∫–∞—Ä—Ç—ñ —Ç—Ä–µ–≤–æ–≥ (—Ç–∏–ø, —á–∞—Å, –º—ñ—Å—Ü–µ)</li>
        <li>‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç—Ä–∏–≤–æ–≥ –ø–æ —Ä–µ–≥—ñ–æ–Ω–∞—Ö —Ç–∞ –æ–±–ª–∞—Å—Ç—è—Ö –Ω–∞ –∫–∞—Ä—Ç—ñ</li>
        <li>‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥—ñ–π —Ç–∞ –∞—Ä—Ö—ñ–≤ —Ç—Ä–∏–≤–æ–≥</li>
        <li>‚úÖ –ú–æ–±—ñ–ª—å–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ –¥–ª—è iOS —Ç–∞ Android</li>
        <li>‚úÖ –®–≤–∏–¥–∫–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–∞—Ä—Ç–∏ —Ç—Ä–∏–≤–æ–≥ (–∫–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥)</li>
        <li>‚úÖ –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ 24/7</li>
        <li>‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Telegram –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å</li>
        <li>‚úÖ –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Ç–∏–ø–∞–º–∏ –∑–∞–≥—Ä–æ–∑</li>
      </ul>
    </section>
  </header>

  <!-- Warning Modal -->
  <div class="modal-overlay" id="warnModal" style="display:none;">
    <div class="modal" role="alertdialog" aria-modal="true" aria-labelledby="warnTitle">
      <h3 id="warnTitle">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è!</h3>
      <p>–ú–∞–ø—É <strong>–Ω–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏</strong> –≤ –ø—Ä—è–º–∏—Ö —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—è—Ö TikTok —Ç–∞ —ñ–Ω—à–∏—Ö —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö.</p>
      <p>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è <strong>—Ç—ñ–ª—å–∫–∏ –≤ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–∏—Ö —Ü—ñ–ª—è—Ö.</strong></p>
  <p style="margin-top:.6rem;color:#fca5a5;"><strong>–£–≤–∞–≥–∞:</strong> –í —Ä–∞–∑—ñ –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ—Ä—É—à–µ–Ω–Ω—è –≤–∞—à —Ç—ñ–∫—Ç–æ–∫ –∞–∫–∞—É–Ω—Ç –±—É–¥–µ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏.</p>
      <button onclick="ackWarn()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
    </div>
  </div>

  <div class="main-content">
    <!-- Telegram Subscribe Banner -->
    <a href="https://t.me/+aBR79kExNQM1ZjZi" target="_blank" class="tg-banner" id="tgBanner">
      <div class="tg-banner-bg"></div>
      <div class="tg-banner-content">
        <div class="tg-banner-left">
          <svg class="tg-banner-icon" viewBox="0 0 48 48" fill="none" width="32" height="32">
            <path d="M41.42 7.31L3.92 22.27c-2.56 1.03-2.55 2.46-.47 3.1l9.62 3 3.72 11.42c.45 1.25.23 1.75 1.52 1.75.99 0 1.43-.45 1.98-1l3.94-3.83 8.2 6.05c1.51.83 2.6.4 2.98-1.4l5.4-25.44c.55-2.2-.84-3.2-2.39-2.61z" fill="white"/>
          </svg>
          <div class="tg-banner-text">
            <span class="tg-banner-title">üì¢ –ü—Ä—è–º–µ —ñ–Ω—Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥ —Ö–ª–æ–ø—Ü—ñ–≤ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º</span>
            <span class="tg-banner-desc">‚ö° –ë—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó ‚Ä¢ üí¨ –ü—Ä—è–º–µ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ –∞–¥–º—ñ–Ω–æ–º ‚Ä¢ üë• 80,000+ –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤</span>
          </div>
        </div>
        <div class="tg-banner-btn">
          <span>–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
          </svg>
        </div>
      </div>
      <button class="tg-banner-close" onclick="event.preventDefault(); event.stopPropagation(); closeTgBanner();" aria-label="–ó–∞–∫—Ä–∏—Ç–∏">√ó</button>
    </a>
    
    <style>
      .tg-banner {
        display: flex;
        position: relative;
        width: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        border: 1px solid rgba(255, 107, 107, 0.4);
        border-radius: 16px;
        padding: 14px 20px;
        margin-bottom: 16px;
        text-decoration: none;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(255, 107, 107, 0.2), inset 0 1px 0 rgba(255,255,255,0.05);
        transition: all 0.3s ease;
      }
      .tg-banner:hover {
        transform: translateY(-2px);
        border-color: rgba(255, 107, 107, 0.6);
        box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3), inset 0 1px 0 rgba(255,255,255,0.05);
      }
      .tg-banner-bg {
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.5;
      }
      .tg-banner-content {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        gap: 16px;
        z-index: 1;
      }
      .tg-banner-left {
        display: flex;
        align-items: center;
        gap: 14px;
        flex: 1;
        min-width: 0;
      }
      .tg-banner-icon {
        flex-shrink: 0;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
      }
      .tg-banner-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
        min-width: 0;
      }
      .tg-banner-title {
        color: white;
        font-size: 15px;
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .tg-banner-desc {
        color: rgba(255,255,255,0.85);
        font-size: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .tg-banner-btn {
        display: flex;
        align-items: center;
        gap: 6px;
        background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
        color: white;
        padding: 10px 18px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        flex-shrink: 0;
        transition: all 0.2s;
        box-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }
      .tg-banner:hover .tg-banner-btn {
        background: linear-gradient(135deg, #00e4ba 0%, #00d4aa 100%);
        transform: scale(1.03);
        box-shadow: 0 4px 15px rgba(0, 212, 170, 0.4);
      }
      .tg-banner-close {
        position: absolute;
        top: 8px;
        right: 8px;
        width: 24px;
        height: 24px;
        border: none;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        color: white;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        z-index: 2;
      }
      .tg-banner-close:hover {
        background: rgba(255,255,255,0.3);
      }
      .tg-banner.hidden {
        display: none;
      }
      @media (max-width: 768px) {
        .tg-banner {
          padding: 12px 16px;
          border-radius: 12px;
        }
        .tg-banner-content {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }
        .tg-banner-icon {
          width: 28px;
          height: 28px;
        }
        .tg-banner-title {
          font-size: 14px;
        }
        .tg-banner-desc {
          font-size: 11px;
          white-space: normal;
        }
        .tg-banner-btn {
          width: 100%;
          justify-content: center;
          padding: 12px;
        }
        .tg-banner-close {
          top: 6px;
          right: 6px;
        }
      }
    </style>
    
    <script>
      function closeTgBanner() {
        const banner = document.getElementById('tgBanner');
        if (banner) {
          banner.classList.add('hidden');
          localStorage.setItem('tg_banner_closed', Date.now().toString());
        }
      }
      
      // Check if banner should be hidden
      document.addEventListener('DOMContentLoaded', function() {
        const lastClosed = localStorage.getItem('tg_banner_closed');
        if (lastClosed) {
          const threeDays = 3 * 24 * 60 * 60 * 1000;
          if (Date.now() - parseInt(lastClosed) < threeDays) {
            const banner = document.getElementById('tgBanner');
            if (banner) banner.classList.add('hidden');
          }
        }
      });
    </script>

    <!-- Map moved to top -->
    <div class="map-card">
      <div class="map-controls">
        <button class="map-control-btn" onclick="map.setZoom(map.getZoom() + 1)">
          <i class="material-icons">add</i>
        </button>
        <button class="map-control-btn" onclick="map.setZoom(map.getZoom() - 1)">
          <i class="material-icons">remove</i>
        </button>
        <button class="map-control-btn" onclick="map.setCenter({lat: 48.3794, lng: 31.1656})">
          <i class="material-icons">center_focus_strong</i>
        </button>
  <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –æ–±–ª–∞—Å—Ç–µ–π –∏ —Ä–∞–∑–º–µ—Ä–æ–º —Ç–µ–∫—Å—Ç–∞ —É–¥–∞–ª–µ–Ω—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É -->

        <button class="map-control-btn" id="expandBtn" onclick="toggleMapExpand()" title="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É" aria-label="–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É">
          <i class="material-icons" id="expandIcon">fullscreen</i>
        </button>
      </div>
      <div id="markerLoadingOverlay" class="hidden">
        <div class="spinner" aria-hidden="true"></div>
        <h3>–ó–∞—á–µ–∫–∞–π —Ö–≤–∏–ª—å–∫—É‚Ä¶</h3>
        <p>–ó–∞—Ä–∞–∑ –º—ñ—Ç–∫–∏ –∑‚Äô—è–≤–ª—è—Ç—å—Å—è (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è / –¥–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–∏ –Ω–∞ –º–∞–ø—É).</p>
      </div>
      <div id="map"></div>
      <!-- Search control -->
      <div id="placeSearch" class="place-search">
        <input type="text" id="placeSearchInput" placeholder="–ü–æ—à—É–∫ –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É‚Ä¶" aria-label="–ü–æ—à—É–∫ –º—ñ—Å—Ç–∞/—Å–µ–ª–∞" autocomplete="off">
        <button id="placeSearchBtn" title="–ó–Ω–∞–π—Ç–∏" aria-label="–ó–Ω–∞–π—Ç–∏"><i class="material-icons" style="font-size:18px;vertical-align:middle;">search</i></button>
        <div id="placeSearchSuggest" class="ps-suggest" style="display:none;"></div>
      </div>
    </div>

  </div>

  <!-- About Section (below the map) -->
  <div class="about-section-wrapper">
    <div class="about-bg-particles"></div>
    <div class="about-bg-glow"></div>
    
    <div class="about-container" id="about">
      <div class="about-header">
        <span class="about-badge">üõ°Ô∏è –ë–µ–∑–ø–µ–∫–∞ –£–∫—Ä–∞—ó–Ω–∏</span>
        <h2 class="about-title">–ü—Ä–æ —Å–∏—Å—Ç–µ–º—É NEPTUN</h2>
        <p class="about-subtitle">–ù–∞–π—à–≤–∏–¥—à–∞ —Ç–∞ –Ω–∞–π—Ç–æ—á–Ω—ñ—à–∞ –∫–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –≤ –£–∫—Ä–∞—ó–Ω—ñ</p>
      </div>
      
      <div class="about-grid">
        <div class="about-card about-card-blue">
          <div class="about-card-glow"></div>
          <div class="about-card-icon">
            <i class="material-icons">security</i>
          </div>
          <h3>–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</h3>
          <p>–°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—É—î –≥–µ–æ–≥—Ä–∞—Ñ—ñ—é –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç–∞ —ñ–Ω—à—ñ –∑–∞–≥—Ä–æ–∑–∏ (—Ä–∞–∫–µ—Ç–∏, –ë–ø–õ–ê, –∞—Ä—Ç–∏–ª–µ—Ä—ñ—è) –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –¥–∂–µ—Ä–µ–ª —É —Ä–µ–∂–∏–º—ñ –±–ª–∏–∑—å–∫–æ–º—É –¥–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É.</p>
        </div>
        
        <div class="about-card about-card-green">
          <div class="about-card-glow"></div>
          <div class="about-card-icon">
            <i class="material-icons">speed</i>
          </div>
          <h3>–û–Ω–æ–≤–ª–µ–Ω–Ω—è</h3>
          <p>–î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–∂–Ω—ñ <strong>10 —Å–µ–∫—É–Ω–¥</strong> –∑ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—ñ.</p>
        </div>
        
        <div class="about-card about-card-orange">
          <div class="about-card-glow"></div>
          <div class="about-card-icon">
            <i class="material-icons">warning_amber</i>
          </div>
          <h3>–í–∞–∂–ª–∏–≤–æ</h3>
          <p>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ç–∞ —Ç–∏–ø–∏ –∑–∞–≥—Ä–æ–∑ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ú–æ–∂–ª–∏–≤—ñ –ø–æ—Ö–∏–±–∫–∏ —É –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—ñ –º—ñ—Å—Ü—å. –ó–∞–≤–∂–¥–∏ –∑–≤–µ—Ä—Ç–∞–π—Ç–µ —É–≤–∞–≥—É –Ω–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è.</p>
        </div>
        
        <div class="about-card about-card-purple">
          <div class="about-card-glow"></div>
          <div class="about-card-icon">
            <i class="material-icons">rocket_launch</i>
          </div>
          <h3>–†–æ–∑—Ä–æ–±–∫–∞</h3>
          <p>–ü—Ä–æ—î–∫—Ç <a href="https://t.me/+aBR79kExNQM1ZjZi" target="_blank" class="about-link">–ù–ï–ü–¢–£–ù <i class="material-icons">open_in_new</i></a> ‚Äî –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞—Ç–∏–≤–∞ –¥–ª—è –±–µ–∑–ø–µ–∫–∏ —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤.</p>
        </div>
      </div>
      
      <div class="about-stats">
        <div class="about-stat">
          <span class="about-stat-num">80,000+</span>
          <span class="about-stat-label">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</span>
        </div>
        <div class="about-stat-divider"></div>
        <div class="about-stat">
          <span class="about-stat-num">24/7</span>
          <span class="about-stat-label">–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</span>
        </div>
        <div class="about-stat-divider"></div>
        <div class="about-stat">
          <span class="about-stat-num">10 —Å–µ–∫</span>
          <span class="about-stat-label">–û–Ω–æ–≤–ª–µ–Ω–Ω—è</span>
        </div>
        <div class="about-stat-divider"></div>
        <div class="about-stat">
          <span class="about-stat-num">12+</span>
          <span class="about-stat-label">–¢–∏–ø—ñ–≤ –∑–∞–≥—Ä–æ–∑</span>
        </div>
      </div>
    </div>
  </div>
  
  <style>
    .about-section-wrapper {
      background: linear-gradient(180deg, #0a0f1c 0%, #0f172a 50%, #1e1b4b 100%);
      padding: 5rem 1rem;
      margin-top: 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .about-bg-particles {
      position: absolute;
      inset: 0;
      background-image: 
        radial-gradient(2px 2px at 20px 30px, rgba(59, 130, 246, 0.3), transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(139, 92, 246, 0.3), transparent),
        radial-gradient(2px 2px at 50px 160px, rgba(236, 72, 153, 0.3), transparent),
        radial-gradient(2px 2px at 90px 40px, rgba(59, 130, 246, 0.3), transparent),
        radial-gradient(2px 2px at 130px 80px, rgba(139, 92, 246, 0.3), transparent),
        radial-gradient(2px 2px at 160px 120px, rgba(16, 185, 129, 0.3), transparent);
      background-size: 200px 200px;
      animation: aboutParticles 20s linear infinite;
      opacity: 0.5;
    }
    
    @keyframes aboutParticles {
      0% { transform: translateY(0); }
      100% { transform: translateY(-200px); }
    }
    
    .about-bg-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 800px;
      height: 800px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, rgba(139, 92, 246, 0.1) 30%, transparent 70%);
      pointer-events: none;
    }
    
    .about-container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    
    .about-header {
      text-align: center;
      margin-bottom: 3.5rem;
    }
    
    .about-badge {
      display: inline-block;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
      border: 1px solid rgba(59, 130, 246, 0.3);
      padding: 8px 20px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      color: #60a5fa;
      margin-bottom: 1rem;
      letter-spacing: 0.5px;
    }
    
    .about-title {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      background: linear-gradient(135deg, #ffffff 0%, #60a5fa 50%, #a78bfa 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0 0 1rem;
      line-height: 1.2;
    }
    
    .about-subtitle {
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .about-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    
    .about-card {
      position: relative;
      padding: 2rem;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }
    
    .about-card:hover {
      transform: translateY(-8px);
      border-color: rgba(255, 255, 255, 0.2);
    }
    
    .about-card-glow {
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      opacity: 0;
      transition: opacity 0.4s;
      pointer-events: none;
    }
    
    .about-card:hover .about-card-glow {
      opacity: 1;
    }
    
    .about-card-blue .about-card-glow { background: radial-gradient(circle at center, rgba(59, 130, 246, 0.15), transparent 50%); }
    .about-card-green .about-card-glow { background: radial-gradient(circle at center, rgba(16, 185, 129, 0.15), transparent 50%); }
    .about-card-orange .about-card-glow { background: radial-gradient(circle at center, rgba(245, 158, 11, 0.15), transparent 50%); }
    .about-card-purple .about-card-glow { background: radial-gradient(circle at center, rgba(139, 92, 246, 0.15), transparent 50%); }
    
    .about-card-blue { border-color: rgba(59, 130, 246, 0.3); }
    .about-card-green { border-color: rgba(16, 185, 129, 0.3); }
    .about-card-orange { border-color: rgba(245, 158, 11, 0.3); }
    .about-card-purple { border-color: rgba(139, 92, 246, 0.3); }
    
    .about-card-blue:hover { border-color: rgba(59, 130, 246, 0.5); box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2); }
    .about-card-green:hover { border-color: rgba(16, 185, 129, 0.5); box-shadow: 0 20px 40px rgba(16, 185, 129, 0.2); }
    .about-card-orange:hover { border-color: rgba(245, 158, 11, 0.5); box-shadow: 0 20px 40px rgba(245, 158, 11, 0.2); }
    .about-card-purple:hover { border-color: rgba(139, 92, 246, 0.5); box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2); }
    
    .about-card-icon {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1.25rem;
      position: relative;
    }
    
    .about-card-icon i {
      font-size: 28px;
    }
    
    .about-card-blue .about-card-icon { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .about-card-green .about-card-icon { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .about-card-orange .about-card-icon { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .about-card-purple .about-card-icon { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
    
    .about-card h3 {
      color: white;
      font-size: 1.35rem;
      font-weight: 700;
      margin: 0 0 0.75rem;
    }
    
    .about-card p {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.95rem;
      line-height: 1.7;
      margin: 0;
    }
    
    .about-card strong {
      color: #60a5fa;
    }
    
    .about-link {
      color: #a78bfa;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: color 0.3s;
    }
    
    .about-link:hover {
      color: #c4b5fd;
    }
    
    .about-link i {
      font-size: 14px;
    }
    
    .about-stats {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      flex-wrap: wrap;
    }
    
    .about-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .about-stat-num {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .about-stat-label {
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .about-stat-divider {
      width: 1px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
    }
    
    @media (max-width: 768px) {
      .about-section-wrapper {
        padding: 3rem 1rem;
      }
      .about-grid {
        gap: 1rem;
      }
      .about-card {
        padding: 1.5rem;
      }
      .about-stats {
        gap: 1rem;
        padding: 1.5rem 1rem;
      }
      .about-stat-num {
        font-size: 1.5rem;
      }
      .about-stat-divider {
        display: none;
      }
    }
  </style>

  <!-- Anchor Ad Block (mobile only, sticky bottom) - HIDDEN until AdSense approval -->
  <div class="ad-container ad-anchor" id="adAnchor" style="display: none;">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-1995509849440582"
         data-ad-slot="XXXXXXXXXX"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <div class="ad-placeholder" style="font-size: 0.7rem;">üì¢ –†–µ–∫–ª–∞–º–∞</div>
  </div>
  <!-- Turf.js for geometry operations -->
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
  <!-- Supercluster –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó –º–∞—Ä–∫–µ—Ä—ñ–≤ (–∑–∞–º—ñ—Å—Ç—å Leaflet MarkerCluster) -->
  <script src="https://unpkg.com/supercluster@7.1.5/dist/supercluster.min.js"></script>
  
  <!-- BANDWIDTH OPTIMIZATION: Region boundaries removed to save 19MB -->
  <script>
    // Stub for removed region boundaries to prevent errors
    window.REGION_BOUNDARIES = {type: "FeatureCollection", features: []};

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è PNG-–º–∞—Ä–∫–µ—Ä–∞
    function createPNGMarker(type) {
      // –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å —Ñ–∞–π–ª–æ–º
      const files = {
        shahed: 'shahed.png',
        avia: 'avia.png',
        artillery: 'artillery.png',
        // –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –∏–∫–æ–Ω–æ–∫ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
      };
      const filename = files[type] || 'default.png';
      const img = document.createElement('img');
      img.src = `/static/${filename}`;
      img.className = 'plain-marker-img';
      img.width = 32;
      img.height = 32;
      return img;
    }
  </script>
  <script type="text/javascript">
    // @ts-nocheck
    
    // Early donation amount function definition to prevent ReferenceError
    window.loadDonationAmount = function() {
      console.log('loadDonationAmount called (early stub)');
      // Will be replaced by full implementation below
    };
    




    

    
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = 'toast toast-' + type;
      toast.textContent = message;
      
      // Set styles individually
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.right = '20px';
      toast.style.padding = '12px 16px';
      toast.style.borderRadius = '8px';
      toast.style.color = 'white';
      toast.style.fontWeight = '500';
      toast.style.zIndex = '9999';
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-20px)';
      toast.style.transition = 'all 0.3s ease';
      toast.style.background = (type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6');
      
      document.body.appendChild(toast);
      
      // Animate in
      setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
      }, 10);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }
    
    // Donation Banner Functions
    function closeDonationBanner() {
      const banner = document.getElementById('donationBanner');
      const miniBanner = document.getElementById('miniDonationBanner');
      
      if (banner) {
        banner.style.animation = 'donationSlideOut 0.5s ease forwards';
        setTimeout(() => {
          banner.classList.add('hidden');
          localStorage.setItem('donationBannerClosed', Date.now().toString());
          
          // Show mini banner after main banner is closed
          if (miniBanner) {
            setTimeout(() => {
              miniBanner.classList.remove('hidden');
            }, 300);
          }
        }, 500);
      }
    }
    
    // Server Donation Banner Functions
    function showServerDonationBanner() {
      const serverBanner = document.getElementById('serverDonationBanner');
      if (serverBanner) {
        serverBanner.style.display = 'block';
        serverBanner.style.animation = 'serverBannerSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
      }
    }
    
    function closeServerDonationBanner() {
      const serverBanner = document.getElementById('serverDonationBanner');
      if (serverBanner) {
        serverBanner.style.animation = 'serverBannerSlideOut 0.5s ease forwards';
        setTimeout(() => {
          serverBanner.style.display = 'none';
          localStorage.setItem('serverDonationBannerClosed', Date.now().toString());
        }, 500);
      }
    }
    
    function showMainDonationBanner() {
      const banner = document.getElementById('donationBanner');
      const miniBanner = document.getElementById('miniDonationBanner');
      
      // Hide mini banner
      if (miniBanner) {
        miniBanner.style.animation = 'miniSlideOut 0.4s ease forwards';
        setTimeout(() => {
          miniBanner.classList.add('hidden');
          miniBanner.style.animation = '';
        }, 400);
      }
      
      // Show main banner
      if (banner) {
        banner.classList.remove('hidden');
        banner.style.animation = 'donationSlideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
        // Remove the "closed" timestamp so it can be shown again
        localStorage.removeItem('donationBannerClosed');
      }
    }
    
    function copyToClipboard(text, successMessage) {
      navigator.clipboard.writeText(text).then(() => {
        showToast(successMessage, 'success');
      }).catch(() => {
        // Fallback for older browsers
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showToast(successMessage, 'success');
        } catch (err) {
          showToast('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏', 'error');
        }
        document.body.removeChild(textarea);
      });
    }
    
    // Show donation banner if not closed recently (24 hours)
    function showDonationBanner() {
      const banner = document.getElementById('donationBanner');
      const miniBanner = document.getElementById('miniDonationBanner');
      const lastClosed = localStorage.getItem('donationBannerClosed');
      const now = Date.now();
      const dayInMs = 24 * 60 * 60 * 1000; // 24 hours
      
      if (!lastClosed || (now - parseInt(lastClosed)) > dayInMs) {
        // Show main banner, hide mini banner
        if (banner) {
          banner.classList.remove('hidden');
        }
        if (miniBanner) {
          miniBanner.classList.add('hidden');
        }
      } else {
        // Hide main banner, show mini banner
        if (banner) {
          banner.classList.add('hidden');
        }
        if (miniBanner) {
          // Show mini banner after a delay
          setTimeout(() => {
            miniBanner.classList.remove('hidden');
          }, 1000);
        }
      }
    }
    
    // Initialize donation banner when page loads
    document.addEventListener('DOMContentLoaded', () => {
      // Add slide out animation to styles
      const style = document.createElement('style');
      style.textContent = `
        @keyframes donationSlideOut {
          from {
            opacity: 1;
            transform: translateX(0) translateY(0) scale(1);
          }
          to {
            opacity: 0;
            transform: translateX(100%) translateY(20px) scale(0.9);
          }
        }
      `;
      document.head.appendChild(style);
      
      // Show banner after a short delay
      setTimeout(showDonationBanner, 2000);
    });
    


    document.addEventListener('DOMContentLoaded', ()=>{
  // Removed hookZoomRedraw() call for FPS optimization
    });
    // Disclaimer persistence
    function hideDisclaimer(){
      const el = document.getElementById('disclaimerBar');
      if(el){ el.classList.add('hidden'); }
      try { localStorage.setItem('disclaimer_ack','1'); } catch(e){}
    }
    function showDisclaimer(){
      const el = document.getElementById('disclaimerBar');
      if(!el) return;
      if(localStorage.getItem('disclaimer_ack')==='1') return; // already acknowledged
      el.style.display='flex';
    }
    document.addEventListener('DOMContentLoaded', showDisclaimer);
    
    // Donate button click handler
    document.addEventListener('DOMContentLoaded', () => {
      const donateBtn = document.getElementById('donateBtn');
      if (donateBtn) {
        donateBtn.addEventListener('click', (e) => {
          e.preventDefault();
          toggleDonate(true);
        });
      }
    });
    
    // Donation modal logic
    function toggleDonate(force){
      const ov = document.getElementById('donateModal');
      if(!ov) return;
      let show;
      if(typeof force === 'boolean') show = force; else show = !ov.classList.contains('active');
      ov.classList.toggle('active', show);
      if(show){
        try { document.body.style.overflow='hidden'; } catch(e){}
      } else {
        try { document.body.style.overflow=''; } catch(e){}
      }
    }
    
    // Server Support Functions (updated for card layout)
  function loadDonationAmount() {
      try {
        const amountElement = document.getElementById('donationAmount')?.querySelector('.amount');
        const supportAmountElement = document.getElementById('supportAmount');
        const progressAmountElement = document.getElementById('progressAmount');
        const progressFillElement = document.getElementById('progressFill');
        
        if (!amountElement && !supportAmountElement) return;
        
        const targetAmount = 13200; // Target amount in UAH
        
        // Check for cached amount
        const cachedAmount = localStorage.getItem('donationAmount');
        const cacheTime = localStorage.getItem('donationAmountTime');
        const now = Date.now();
        
        // Default fallback amount (known current amount)
        const fallbackAmount = 462;
        
        // Use cache if it's less than 15 minutes old (reduced from 30)
        if (cachedAmount && cacheTime && (now - parseInt(cacheTime)) < 900000) {
          const amount = parseFloat(cachedAmount) || fallbackAmount;
          updateAmountDisplay(amount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
          console.log('Using cached donation amount:', amount, '–≥—Ä–Ω');
          return;
        }
        
        // IMMEDIATELY show fallback amount to avoid showing 0
        updateAmountDisplay(fallbackAmount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
        console.log('Showing fallback amount immediately:', fallbackAmount, '–≥—Ä–Ω');
        
        // Then try to fetch real data in background with retry
        fetchMonobankAmountWithRetry(targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement, now);
        
      } catch(e) {
        console.error('Failed to load donation amount:', e);
        // Show fallback amount on any error
        const fallbackAmount = 462;
        updateAmountDisplay(fallbackAmount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
      }
  }
  // Expose on window for external calls/guards
  try { window.loadDonationAmount = loadDonationAmount; } catch(e){}
    
    // Enhanced function with retry mechanism
    async function fetchMonobankAmountWithRetry(targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement, cacheTime, retryCount = 0) {
      const maxRetries = 3;
      const retryDelay = [1000, 3000, 5000]; // Delays for each retry
      
      try {
        await fetchMonobankAmount(targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement, cacheTime);
      } catch (error) {
        console.warn('Attempt ' + (retryCount + 1) + ' failed:', error);
        
        if (retryCount < maxRetries) {
          console.log('Retrying in ' + retryDelay[retryCount] + 'ms...');
          setTimeout(() => {
            fetchMonobankAmountWithRetry(targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement, cacheTime, retryCount + 1);
          }, retryDelay[retryCount]);
        } else {
          console.warn('All retry attempts failed, keeping fallback amount');
        }
      }
    }

    async function fetchMonobankAmount(targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement, cacheTime) {
      try {
        // Use a CORS proxy to fetch Monobank jar data
        const jarId = '6Vi9TVzJZQ';
        
        // Try multiple proxy services for better reliability
        const proxyUrls = [
          'https://api.allorigins.win/get?url=' + encodeURIComponent('https://send.monobank.ua/jar/' + jarId),
          'https://cors-anywhere.herokuapp.com/https://send.monobank.ua/jar/' + jarId,
          'https://thingproxy.freeboard.io/fetch/https://send.monobank.ua/jar/' + jarId
        ];
        
        let htmlContent = null;
        let lastError = null;
        
        // Try each proxy until one works
        for (let i = 0; i < proxyUrls.length; i++) {
          const proxyUrl = proxyUrls[i];
          try {
            console.log('Trying proxy ' + (i + 1) + '/' + proxyUrls.length + ': ' + proxyUrl.split('?')[0] + '...');
            
            // Add timeout to fetch
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 8000); // 8 second timeout
            
            const response = await fetch(proxyUrl, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
                'X-Requested-With': 'XMLHttpRequest'
              },
              signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            
            if (!response.ok) {
              throw new Error('HTTP ' + response.status + ': ' + response.statusText);
            }
            
            const data = await response.json();
            htmlContent = data.contents || data;
            if (htmlContent && htmlContent.length > 100) { // Make sure we got actual content
              console.log('Proxy ' + (i + 1) + ' successful, content length: ' + htmlContent.length);
              break;
            } else {
              throw new Error('Empty or invalid content received');
            }
            
          } catch (err) {
            lastError = err;
            console.warn('Proxy ' + (i + 1) + ' failed: ' + err.message);
            
            // Add small delay between proxy attempts
            if (i < proxyUrls.length - 1) {
              await new Promise(resolve => setTimeout(resolve, 500));
            }
            continue;
          }
        }
        
        if (!htmlContent) {
          throw new Error('All proxies failed. Last error: ' + lastError);
        }
        
        // Parse the HTML to extract the current amount
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        
        // Look for amount in the page content with multiple patterns
        let amount = 0;
        
        // Try different patterns to find the amount
        const patterns = [
          // Pattern 1: Look for "–ó—ñ–±—Ä–∞–Ω–æ: 462 –≥—Ä–Ω" or similar (most specific)
          /–∑—ñ–±—Ä–∞–Ω–æ[:\s]*(\d+(?:[,\s]\d{3})*(?:[.,]\d+)?)\s*–≥—Ä–Ω/i,
          // Pattern 2: Look for "—Å—É–º–∞: 462 –≥—Ä–Ω" or similar
          /—Å—É–º–∞[:\s]*(\d+(?:[,\s]\d{3})*(?:[.,]\d+)?)\s*–≥—Ä–Ω/i,
          // Pattern 3: JSON-like structure with amount
          /"amount"[:\s]*(\d+(?:[.,]\d+)?)/i,
          // Pattern 4: Look for large numbers in quotes (JSON-like)
          /"(\d{3,}(?:[.,]\d+)?)"/,
          // Pattern 5: Look for amount in span or div with class containing "amount"
          /<[^>]*class="[^"]*amount[^"]*"[^>]*>[\s\S]*?(\d+(?:[,\s]\d{3})*(?:[.,]\d+)?)/i,
          // Pattern 6: Look for large numbers followed by –≥—Ä–Ω (broader)
          /(\d{2,}(?:[,\s]\d{3})*(?:[.,]\d+)?)\s*–≥—Ä–Ω/i,
          // Pattern 7: Look for amount in data attributes
          /data-amount="(\d+(?:[.,]\d+)?)"/i,
          // Pattern 8: Find numbers that look like currency amounts (3+ digits)
          /\b(\d{3,}(?:[.,]\d{2})?)\b/g
        ];
        
        for (let i = 0; i < patterns.length; i++) {
          const pattern = patterns[i];
          const isGlobal = pattern.global;
          
          if (isGlobal) {
            // For global patterns, find all matches
            let match;
            while ((match = pattern.exec(htmlContent)) !== null) {
              const rawAmount = match[1].replace(/[,\s]/g, '').replace(',', '.');
              const parsedAmount = parseFloat(rawAmount);
              if (parsedAmount && parsedAmount >= 400 && parsedAmount <= 15000) { // Reasonable range
                if (parsedAmount > amount) {
                  amount = parsedAmount;
                  console.log('Found amount using pattern ' + (i + 1) + ': ' + parsedAmount);
                }
              }
            }
          } else {
            // For non-global patterns
            const match = htmlContent.match(pattern);
            if (match) {
              const rawAmount = match[1].replace(/[,\s]/g, '').replace(',', '.');
              const parsedAmount = parseFloat(rawAmount);
              if (parsedAmount && parsedAmount >= 400 && parsedAmount <= 15000) { // Reasonable range
                if (parsedAmount > amount) {
                  amount = parsedAmount;
                  console.log('Found amount using pattern ' + (i + 1) + ': ' + parsedAmount);
                }
              }
            }
          }
        }
        
        // If still no amount found, try parsing the DOM structure
        if (amount === 0 || amount < 400) {
          console.log('Trying DOM parsing for amount...');
          const amountElements = doc.querySelectorAll('[class*="amount"], [class*="sum"], [class*="total"], [class*="collected"], [class*="raised"]');
          for (const element of amountElements) {
            const text = element.textContent || element.innerText || '';
            const numberMatch = text.match(/(\d+(?:[,\s]\d{3})*(?:[.,]\d+)?)/);
            if (numberMatch) {
              const parsedAmount = parseFloat(numberMatch[1].replace(/[,\s]/g, '').replace(',', '.'));
              if (parsedAmount && parsedAmount >= 400 && parsedAmount <= 15000) {
                if (parsedAmount > amount) {
                  amount = parsedAmount;
                  console.log('Found amount in DOM element: ' + parsedAmount);
                }
              }
            }
          }
        }
        
        // If amount is reasonable, cache and use it
        if (amount >= 400) {
          localStorage.setItem('donationAmount', amount.toString());
          localStorage.setItem('donationAmountTime', cacheTime.toString());
          
          updateAmountDisplay(amount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
          
          console.log('Donation amount loaded:', amount, '–≥—Ä–Ω');
        } else {
          // Amount is too low or invalid, use fallback
          console.warn('Invalid amount detected:', amount, 'using fallback');
          throw new Error('Invalid amount: ' + amount);
        }
        
        // Debug: log the HTML content to help with troubleshooting
        if (amount === 0 || amount < 400) {
          console.warn('Low amount detected, HTML content preview:', htmlContent.substring(0, 500));
        }
        
      } catch(error) {
        console.warn('Failed to fetch from Monobank, using fallback:', error);
        
        // Fallback to a reasonable estimate based on current knowledge
        const fallbackAmount = 462; // Current known amount from manual check
        updateAmountDisplay(fallbackAmount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
        
        // Cache fallback for 5 minutes (shorter cache for fallback)
        localStorage.setItem('donationAmount', fallbackAmount.toString());
        localStorage.setItem('donationAmountTime', Date.now().toString());
      }
    }
    
    // Alternative method: try to get data from Monobank public API
    async function tryMonobankPublicAPI() {
      try {
        // This is a fallback method to try getting jar info
        const jarId = '6Vi9TVzJZQ';
        
        // Try direct approach with different headers
  const response = await fetch('https://send.monobank.ua/jar/' + jarId, {
          method: 'GET',
          mode: 'no-cors',
          headers: {
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'
          }
        });
        
        console.log('Direct Monobank response:', response);
        
      } catch (error) {
        console.log('Direct Monobank API not accessible:', error);
      }
    }
    
    function updateAmountDisplay(amount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement) {
      const formattedAmount = formatAmount(amount);
      const progressPercent = Math.min((amount / targetAmount) * 100, 100);
      
      if (amountElement) amountElement.textContent = formattedAmount;
      if (supportAmountElement) supportAmountElement.textContent = formattedAmount;
      if (progressAmountElement) progressAmountElement.textContent = formattedAmount;
      if (progressFillElement) {
        progressFillElement.style.width = progressPercent + '%';
        progressFillElement.style.background = progressPercent >= 100 
          ? 'linear-gradient(90deg, #10b981, #059669)' 
          : 'linear-gradient(90deg, #3b82f6, #8b5cf6)';
      }
      
      // Store as last known good amount
      localStorage.setItem('lastKnownAmount', amount.toString());
    }
    
    function handleAmountError(amountElement, supportAmountElement, progressAmountElement) {
      if (amountElement) amountElement.textContent = '0';
      if (supportAmountElement) supportAmountElement.textContent = '0';
      if (progressAmountElement) progressAmountElement.textContent = '0';
    }
    
    function formatAmount(amount) {
      // Format number with thousand separators and proper decimal handling
      if (typeof amount === 'string') {
        const num = parseFloat(amount);
        if (isNaN(num)) return amount;
        amount = num;
      }
      
      // Round to 2 decimal places if needed, then format with commas
      const rounded = Math.round(amount * 100) / 100;
      return rounded.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    function copyDonate(val, btn){
      try { navigator.clipboard.writeText(val); } catch(e){
        const ta=document.createElement('textarea'); ta.value=val; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); }catch(e2){} document.body.removeChild(ta);
      }
      const toast = document.getElementById('copyToast');
      if(toast){ toast.classList.remove('show'); void toast.offsetWidth; toast.classList.add('show'); }
      if(btn){
        const orig = btn.innerHTML;
        btn.innerHTML = '<i class="material-icons" style="font-size:14px;">check_circle</i>–ì–æ—Ç–æ–≤–æ';
        setTimeout(()=>{ btn.innerHTML = orig; }, 2200);
      }
    }
    function openJar(){ window.open('https://send.monobank.ua/jar/6Vi9TVzJZQ','_blank','noopener'); }
    
    function refreshDonationAmount() {
      // Clear cache and force reload
      localStorage.removeItem('donationAmount');
      localStorage.removeItem('donationAmountTime');
      
      // Show loading state
      const supportAmountElement = document.getElementById('supportAmount');
      const progressAmountElement = document.getElementById('progressAmount');
      
      if (supportAmountElement) supportAmountElement.textContent = '...';
      if (progressAmountElement) progressAmountElement.textContent = '...';
      
      // Reload amount
      loadDonationAmount();
      
      console.log('Manual refresh of donation amount triggered');
    }
    
    // Debug functions for console testing
    window.testMonobankAPI = async function() {
      console.log('Testing Monobank API access...');
      
      const jarId = '6Vi9TVzJZQ';
      const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://send.monobank.ua/jar/' + jarId);
      
      try {
        const response = await fetch(proxyUrl);
        const data = await response.json();
        console.log('API Response:', data);
        
        if (data.contents) {
          console.log('HTML Content preview:', data.contents.substring(0, 1000));
          
          // Test parsing
          const patterns = [
            /–∑—ñ–±—Ä–∞–Ω–æ[:\s]*(\d+(?:[,\s]\d{3})*(?:[.,]\d+)?)\s*–≥—Ä–Ω/i,
            /(\d{2,}(?:[,\s]\d{3})*(?:[.,]\d+)?)\s*–≥—Ä–Ω/i
          ];
          
          for (const pattern of patterns) {
            const match = data.contents.match(pattern);
            if (match) {
              console.log('Found amount with pattern:', pattern, 'Amount:', match[1]);
            }
          }
        }
        
      } catch (error) {
        console.error('API Test failed:', error);
      }
    };
    
    window.setManualAmount = function(amount) {
      const targetAmount = 13200;
      const amountElement = document.getElementById('donationAmount')?.querySelector('.amount');
      const supportAmountElement = document.getElementById('supportAmount');
      const progressAmountElement = document.getElementById('progressAmount');
      const progressFillElement = document.getElementById('progressFill');
      
      updateAmountDisplay(amount, targetAmount, amountElement, supportAmountElement, progressAmountElement, progressFillElement);
      
      // Cache the manually set amount
      localStorage.setItem('donationAmount', amount.toString());
      localStorage.setItem('donationAmountTime', Date.now().toString());
      
      console.log('Manual amount set to:', amount);
    };
    
    // Keyboard event handlers
    document.addEventListener('keydown', e => { 
      if(e.key === 'Escape') { 
        toggleDonate(false); 
      } 
    });
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const UKRAINE_CENTER = { lat: 48.3794, lng: 31.1656 };
    
    // Cache busting timestamp for image updates
    const IMAGE_VERSION = '20251003120000'; // Updated when images are optimized
    
    // Optimized icon loading system with placeholders - synchronized with admin panel
    const ICONS = {
      shahed: '/static/shahed.png?v=' + IMAGE_VERSION,
      raketa: '/static/raketa.png?v=' + IMAGE_VERSION,
      kab: '/static/rszv.png?v=' + IMAGE_VERSION, // –ö–ê–ë—ã (–∞–≤—ñ–∞—Ü—ñ–π–Ω—ñ –±–æ–º–±–∏)
      avia: '/static/avia.png?v=' + IMAGE_VERSION,
      pvo: '/static/rozved.png?v=' + IMAGE_VERSION,
      rozved: '/static/rozved.png?v=' + IMAGE_VERSION, // Reconnaissance UAVs
      rszv: '/static/rszv.png?v=' + IMAGE_VERSION,
      vibuh: '/static/vibuh.png?v=' + IMAGE_VERSION,
      alarm: '/static/trivoga.png?v=' + IMAGE_VERSION,
      alarm_cancel: '/static/vidboi.png?v=' + IMAGE_VERSION,
      mlrs: '/static/rszv.png?v=' + IMAGE_VERSION, // Fix: use rszv.png for mlrs
      artillery: '/static/obstril.png?v=' + IMAGE_VERSION, // Fix: use obstril.png for artillery 
      obstril: '/static/obstril.png?v=' + IMAGE_VERSION,
      fpv: '/static/fpv.png?v=' + IMAGE_VERSION,
      pusk: '/static/pusk.png?v=' + IMAGE_VERSION, // Fix: add missing pusk icon
      manual: '/static/raketa.png?v=' + IMAGE_VERSION, // Fix: add manual fallback
      default: '/static/default.png?v=' + IMAGE_VERSION
    };
    
    // Placeholder versions for instant loading - synchronized with admin panel
    const PLACEHOLDERS = {
      shahed: '/static/placeholders/shahed.png?v=' + IMAGE_VERSION,
      raketa: '/static/placeholders/raketa.png?v=' + IMAGE_VERSION,
      avia: '/static/placeholders/avia.png?v=' + IMAGE_VERSION,
      pvo: '/static/placeholders/rozved.png?v=' + IMAGE_VERSION,
      rozved: '/static/placeholders/rozved.png?v=' + IMAGE_VERSION, // Reconnaissance UAVs
      rszv: '/static/placeholders/rszv.png?v=' + IMAGE_VERSION,
      vibuh: '/static/placeholders/vibuh.png?v=' + IMAGE_VERSION,
      alarm: '/static/placeholders/trivoga.png?v=' + IMAGE_VERSION,
      alarm_cancel: '/static/placeholders/vidboi.png?v=' + IMAGE_VERSION,
      mlrs: '/static/placeholders/rszv.png?v=' + IMAGE_VERSION, // Fix: use rszv.png for mlrs
      artillery: '/static/placeholders/obstril.png?v=' + IMAGE_VERSION, // Fix: use obstril.png for artillery
      obstril: '/static/placeholders/obstril.png?v=' + IMAGE_VERSION,
      fpv: '/static/placeholders/fpv.png?v=' + IMAGE_VERSION,
      pusk: '/static/placeholders/pusk.png?v=' + IMAGE_VERSION, // Fix: add missing pusk placeholder
      manual: '/static/placeholders/raketa.png?v=' + IMAGE_VERSION, // Fix: add manual fallback
      default: '/static/placeholders/default.png?v=' + IMAGE_VERSION
    };
    
    // Lazy loading system for images with progressive enhancement
    const imageCache = new Map();
    const loadingImages = new Map();
    const placeholderCache = new Map();
    
    // Tiny placeholder for immediate display
    const INSTANT_PLACEHOLDER = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
    
    // Fallback icon for errors
    const FALLBACK_ICON = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAALElEQVQokWP8////fwY0wAgjGJgGLABWMMRAFEg0gGE0GoBmGuwmCkYBAGmxD/dzJvLRwAAAABJRU5ErkJggg==';
    
    // Progressive image loader: placeholder ‚Üí optimized image
    function loadImageProgressive(iconType) {
      const fullUrl = ICONS[iconType] || ICONS.default;
      const placeholderUrl = PLACEHOLDERS[iconType] || PLACEHOLDERS.default;
      
      return new Promise((resolve) => {
        // Step 1: Try to load placeholder first (very fast)
        if (placeholderUrl && !placeholderCache.has(placeholderUrl)) {
          const placeholderImg = new Image();
          placeholderImg.onload = () => {
            placeholderCache.set(placeholderUrl, true);
          };
          placeholderImg.src = placeholderUrl;
        }
        
        // Return placeholder immediately for instant display
        resolve(placeholderUrl || INSTANT_PLACEHOLDER);
        
        // Step 2: Load full quality image in background
        setTimeout(() => {
          if (!imageCache.has(fullUrl)) {
            const fullImg = new Image();
            fullImg.onload = () => {
              imageCache.set(fullUrl, true);
              // Update any markers using this icon
              updateMarkersWithFullImage(iconType, fullUrl);
            };
            fullImg.onerror = () => {
              console.warn('Failed to load full image: ' + fullUrl);
              imageCache.set(fullUrl, 'error');
            };
            fullImg.src = fullUrl;
          }
        }, 100); // Small delay to prioritize placeholder loading
      });
    }
    
    // Update markers with full quality images when available
    function updateMarkersWithFullImage(iconType, fullUrl) {
      // Find all img elements using this icon type and update them
      document.querySelectorAll('img[data-icon-type="' + iconType + '"]').forEach(img => {
        if (imageCache.get(fullUrl) === true) {
          img.style.transition = 'opacity 0.3s ease-in-out';
          img.style.opacity = '0.7';
          setTimeout(() => {
            img.src = fullUrl;
            img.style.opacity = '1';
          }, 50);
        }
      });
    }
    
    // Priority-based preloading for most common icons
    function preloadCriticalIcons() {
      const criticalIcons = ['shahed', 'raketa', 'avia', 'rozved', 'alarm']; // Most common types
      
      criticalIcons.forEach((iconType, index) => {
        setTimeout(() => {
          loadImageProgressive(iconType);
        }, index * 100); // Stagger loading
      });
    }
    
    // Background preloading for remaining icons (lower priority)
    function preloadRemainingIcons() {
      const remainingIcons = Object.keys(ICONS).filter(key => 
        !['shahed', 'raketa', 'avia', 'alarm'].includes(key)
      );
      
      // Delay and spread out loading to avoid bandwidth congestion
      remainingIcons.forEach((iconType, index) => {
        setTimeout(() => {
          loadImageProgressive(iconType);
        }, (index + 1) * 300); // 300ms between each load
      });
    }
    
    // Smart icon getter with progressive loading
    async function getIconUrl(iconType) {
      try {
        return await loadImageProgressive(iconType);
      } catch (error) {
        console.warn('Failed to get icon ' + iconType + ':', error);
        return FALLBACK_ICON;
      }
    }
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  let map;
    let markerLayer = null;
    let markers = [];
    const DEBUG_MARKER_LOGS = false;
    const markerDebugLog = (...args) => { if (DEBUG_MARKER_LOGS) { console.debug(...args); } };
    const MARKER_UPDATE_MIN_INTERVAL = 30000; // debounce full redraws (optimized for FPS)
    let lastMarkerUpdateAt = 0;
    let markerUpdateRunning = false;
    let markerUpdateQueued = false;
    let markerUpdateTimer = null;
    let markerUpdatePromise = null;

    function requestMarkerUpdate(options = {}) {
      const force = !!options.force;
      const now = Date.now();
      if (markerUpdateRunning) {
        markerUpdateQueued = true;
        return;
      }
      const since = now - lastMarkerUpdateAt;
      if (!force && since < MARKER_UPDATE_MIN_INTERVAL) {
        if (!markerUpdateTimer) {
          markerUpdateTimer = setTimeout(() => {
            markerUpdateTimer = null;
            requestMarkerUpdate({ force: true });
          }, MARKER_UPDATE_MIN_INTERVAL - since);
        }
        return;
      }
      if (markerUpdateTimer) {
        clearTimeout(markerUpdateTimer);
        markerUpdateTimer = null;
      }
      runMarkerUpdate();
    }

    function runMarkerUpdate() {
      if (markerUpdateRunning && markerUpdatePromise) {
        return markerUpdatePromise;
      }
      markerUpdateRunning = true;
      markerUpdatePromise = updateMarkers().finally(() => {
        lastMarkerUpdateAt = Date.now();
        markerUpdateRunning = false;
        markerUpdatePromise = null;
        if (markerUpdateQueued) {
          markerUpdateQueued = false;
          requestMarkerUpdate({ force: true });
        }
      });
      return markerUpdatePromise;
    }
    // –ü—Ä–æ—Å—Ç–∞ –º–∞–ø–∞ —Ç—Ä–∞–Ω—Å–ª—ñ—Ç–µ—Ä–∞—Ü—ñ—ó/–ø–µ—Ä–µ–∫–ª–∞–¥—É —Ä–æ—Å—ñ–π—Å—å–∫–∏—Ö / –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö –Ω–∞–∑–≤ –Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ
    const PLACE_UA_MAP = (()=>{
      const m = new Map([
        ['–∫–∏–µ–≤','–ö–∏—ó–≤'],['–∫–∏—ó–≤','–ö–∏—ó–≤'],['kiev','–ö–∏—ó–≤'],
        ['–æ–¥–µ—Å—Å–∞','–û–¥–µ—Å–∞'],['odesa','–û–¥–µ—Å–∞'],
        ['—Ö–∞—Ä—å–∫–æ–≤','–•–∞—Ä–∫—ñ–≤'],['kharkov','–•–∞—Ä–∫—ñ–≤'],['—Ö–∞—Ä–∫—ñ–≤','–•–∞—Ä–∫—ñ–≤'],
        ['–¥–Ω–µ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å–∫','–î–Ω—ñ–ø—Ä–æ'],['–¥–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫','–î–Ω—ñ–ø—Ä–æ'],['–¥–Ω–µ–ø—Ä','–î–Ω—ñ–ø—Ä–æ'],['–¥–Ω—ñ–ø—Ä','–î–Ω—ñ–ø—Ä–æ'],['dnipro','–î–Ω—ñ–ø—Ä–æ'],
        ['—á–µ—Ä–Ω–∏–≥–æ–≤','–ß–µ—Ä–Ω—ñ–≥—ñ–≤'],['—á–µ—Ä–Ω–∏–≥—ñ–≤','–ß–µ—Ä–Ω—ñ–≥—ñ–≤'],
        ['–∑–∞–ø–æ—Ä–æ–∂—å–µ','–ó–∞–ø–æ—Ä—ñ–∂–∂—è'],['–∑–∞–ø–æ—Ä–æ–∂—å–µ','–ó–∞–ø–æ—Ä—ñ–∂–∂—è'],['–∑–∞–ø–æ—Ä—ñ–∂—å–µ','–ó–∞–ø–æ—Ä—ñ–∂–∂—è'],['–∑–∞–ø–æ—Ä—ñ–∂–∂—è','–ó–∞–ø–æ—Ä—ñ–∂–∂—è'],
        ['–Ω–∏–∫–æ–ª–∞–µ–≤','–ú–∏–∫–æ–ª–∞—ó–≤'],['–º–∏–∫–æ–ª–∞–µ–≤','–ú–∏–∫–æ–ª–∞—ó–≤'],['–º–∏–∫–æ–ª–∞—ó–≤','–ú–∏–∫–æ–ª–∞—ó–≤'],
        ['–∂–∏—Ç–æ–º–∏—Ä','–ñ–∏—Ç–æ–º–∏—Ä'],
        ['–ø–æ–ª—Ç–∞–≤–∞','–ü–æ–ª—Ç–∞–≤–∞'],
        ['—Ö–µ—Ä—Å–æ–Ω','–•–µ—Ä—Å–æ–Ω'],
        ['–ª—É–≥–∞–Ω—Å–∫','–õ—É–≥–∞–Ω—Å—å–∫'],['–ª—É–≥–∞–Ω—Å—å–∫','–õ—É–≥–∞–Ω—Å—å–∫'],
        ['–¥–æ–Ω–µ—Ü–∫','–î–æ–Ω–µ—Ü—å–∫'],['–¥–æ–Ω–µ—Ü—å–∫','–î–æ–Ω–µ—Ü—å–∫'],
        ['—Å—É–º–∏','–°—É–º–∏'],['—Å—É–º—ã','–°—É–º–∏'],
        ['—á–µ—Ä–∫–∞—Å—Å—ã','–ß–µ—Ä–∫–∞—Å–∏'],['—á–µ—Ä–∫–∞—Å—ñ','–ß–µ—Ä–∫–∞—Å–∏'],
        ['—á–µ—Ä–Ω–æ–≤—Ü—ã','–ß–µ—Ä–Ω—ñ–≤—Ü—ñ'],['—á–µ—Ä–Ω—ñ–≤—Ü—ñ','–ß–µ—Ä–Ω—ñ–≤—Ü—ñ'],
        ['–∏–≤–∞–Ω–æ-—Ñ—Ä–∞–Ω–∫–æ–≤—Å–∫','–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫'],['—ñ–≤–∞–Ω–æ-—Ñ—Ä–∞–Ω–∫—ñ–≤—Å—å–∫','–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫'],
        ['–ª—å–≤–æ–≤','–õ—å–≤—ñ–≤'],['–ª—å–≤—ñ–≤','–õ—å–≤—ñ–≤'],
        ['—É–∂–≥–æ—Ä–æ–¥','–£–∂–≥–æ—Ä–æ–¥'],
        ['—Ç–µ—Ä–Ω–æ–ø–æ–ª—å','–¢–µ—Ä–Ω–æ–ø—ñ–ª—å'],['—Ç–µ—Ä–Ω–æ–ø—ñ–ª—å','–¢–µ—Ä–Ω–æ–ø—ñ–ª—å'],
        ['–≤–∏–Ω–Ω–∏—Ü–∞','–í—ñ–Ω–Ω–∏—Ü—è'],['–≤—ñ–Ω–Ω–∏—Ü—è','–í—ñ–Ω–Ω–∏—Ü—è'],
        ['—Ä–æ–≤–Ω–æ','–†—ñ–≤–Ω–µ'],['—Ä–æ–≤–Ω–µ','–†—ñ–≤–Ω–µ'],['—Ä—ñ–≤–Ω–µ','–†—ñ–≤–Ω–µ'],
        ['–∫—Ä–æ–ø–∏–≤–Ω–∏—Ü–∫–∏–π','–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π'],['–∫—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π','–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π'],
        ['—Å–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å','–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å'],
        ['—Å–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å','–°—ñ–º—Ñ–µ—Ä–æ–ø–æ–ª—å'],
        ['–º–∞—Ä–∏—É–ø–æ–ª—å','–ú–∞—Ä—ñ—É–ø–æ–ª—å'],['–º–∞—Ä—ñ—É–ø–æ–ª—å','–ú–∞—Ä—ñ—É–ø–æ–ª—å'],
        ['–≥–æ—Ä–ª–æ–≤–∫–∞','–ì–æ—Ä–ª—ñ–≤–∫–∞'],['–≥–æ—Ä–ª—ñ–≤–∫–∞','–ì–æ—Ä–ª—ñ–≤–∫–∞'],
        ['–∞–ª—á–µ–≤—Å–∫','–ê–ª—á–µ–≤—Å—å–∫'],['–∞–ª—á–µ–≤—Å—å–∫','–ê–ª—á–µ–≤—Å—å–∫']
      ]);
      return m;
    })();
    function normalizeKey(s){ return s.toLowerCase().replace(/\s+/g,' ').trim(); }
    function translatePlace(name){
      if(!name || typeof name !== 'string') return name;
      const key = normalizeKey(name);
      if(PLACE_UA_MAP.has(key)) return PLACE_UA_MAP.get(key);
      // –Ø–∫—â–æ –≤–∂–µ –º—ñ—Å—Ç–∏—Ç—å —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ª—ñ—Ç–µ—Ä–∏ ‚Äì –∑–∞–ª–∏—à–∞—î–º–æ
      if(/[—ñ—ó—î“ë]/i.test(name)) return name;
      // –õ–µ–≥–∫–∞ –∑–∞–º—ñ–Ω–∞ —Ä–æ—Å. –ª—ñ—Ç–µ—Ä –Ω–∞ —É–∫—Ä. –ø—Ä–∏–±–ª–∏–∑–Ω–æ
      let t = name
        .replace(/—ë/g,'–π–æ').replace(/—ã/g,'–∏').replace(/—ç/g,'–µ')
        .replace(/—ä/g,' º');
      return t;
    }
    // –ë–∞–∑–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–æ—Å–Ω–æ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ)
    function cleanMessage(t){
      if(!t) return t;
      // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
      return t.trim();
    }
    // –¶—ñ–ª—å–æ–≤—ñ –º—ñ—Å—Ç–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—ó —ñ–∫–æ–Ω–∫–∏ FPV –ø—Ä–∏ –∑–∞–≥—Ä–æ–∑—ñ –ë–ü–õ–ê
    const FPV_CITIES = ['—Ö–µ—Ä—Å–æ–Ω','–±—ñ–ª–æ–∑–µ—Ä–∫–∞','–º–∞—Ä–≥–∞–Ω–µ—Ü—å','–Ω—ñ–∫–æ–ø–æ–ª—å'];
    function isFPVThreat(place, text, threatType){
      const combined = (place ? place + ' ' : '') + (text || '');
      const lower = combined.toLowerCase();
      if(!FPV_CITIES.some(c => lower.includes(c))) return false;
      const tt = (threatType||'').toLowerCase();
      const txt = (text||'').toLowerCase();
      // Exclude reconnaissance / observation drone reports
      if(/—Ä–æ–∑–≤—ñ–¥|—Ä–∞–∑–≤–µ–¥|—Å–ø–æ—Å—Ç–µ—Ä–µ–∂/i.test(txt)) return false;
      // Always treat shahed stream as threat
      if (tt === 'shahed') return true;
      const hasFPV = /\bfpv\b/.test(txt);
      const hasGenericUAV = /–±–ø–ª–∞/.test(txt);
      // Attack / strike intent keywords
      const attackCtx = /(—É–¥–∞—Ä|–∞—Ç–∞(–∫|—Ü)|–ø—Ä–∏–ª(—ñ|—ã)—Ç|–º–∞—Å(–æ–≤|–æ–≤–∞)|–∑–∞–≥—Ä–æ–∑|–ø—É—Å–∫|–∑–∞–ø—É—Å–∫|–∑–ª—ñ—Ç|–≤–∏–ª—ñ—Ç|–≤—ã–ª–µ—Ç|–∑–ª–µ—Ç)/.test(txt);
      if (hasFPV) return true;
      if (hasGenericUAV && attackCtx) return true;
      return false;
    }
    // Helper: build semi-circle polygon (returns array of [lat,lng])
    function buildSemiCircle(lat, lng, startBearing, endBearing, radiusKm, segments){
      const pts=[]; const R=6371; const toRad=d=>d*Math.PI/180; const toDeg=r=>r*180/Math.PI;
      const lat1=toRad(lat); const lon1=toRad(lng); const angDist=radiusKm/R;
      let span = (endBearing - startBearing); if (span < 0) span += 360;
      for(let i=0;i<=segments;i++){
        const brg = (startBearing + span*(i/segments)) % 360;
        const br = toRad(brg);
        const lat2 = Math.asin(Math.sin(lat1)*Math.cos(angDist)+Math.cos(lat1)*Math.sin(angDist)*Math.cos(br));
        const lon2 = lon1 + Math.atan2(Math.sin(br)*Math.sin(angDist)*Math.cos(lat1), Math.cos(angDist)-Math.sin(lat1)*Math.sin(lat2));
        pts.push([toDeg(lat2), ((toDeg(lon2)+540)%360)-180]);
      }
      pts.unshift([lat,lng]);
      return pts;
    }

    // Normalize trajectory point (array [lat,lng] or object {lat,lng})
    function normalizeTrajectoryPoint(pt) {
      if (!pt) return null;
      if (Array.isArray(pt) && pt.length >= 2) {
        const lat = parseFloat(pt[0]);
        const lng = parseFloat(pt[1]);
        if (Number.isFinite(lat) && Number.isFinite(lng)) {
          return [lat, lng];
        }
      }
      if (typeof pt === 'object' && pt.lat !== undefined && pt.lng !== undefined) {
        const lat = parseFloat(pt.lat);
        const lng = parseFloat(pt.lng);
        if (Number.isFinite(lat) && Number.isFinite(lng)) {
          return [lat, lng];
        }
      }
      return null;
    }
    
    // === –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –£–ì–†–û–ó–´ ===
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —É–≥—Ä–æ–∑
    function isRegionalThreat(text, place) {
      if (!text) return null;
      
      const textLower = text.toLowerCase();
      
      // –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —É–≥—Ä–æ–∑
      const regionalPatterns = [
        // –î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /–¥–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|–¥–Ω–∏–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'dnipropetrovska',
          regionName: '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [48.464717, 35.046183] // —Ü–µ–Ω—Ç—Ä –æ–±–ª–∞—Å—Ç–∏
        },
        // –•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /—Ö–∞—Ä–∫—ñ–≤—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|—Ö–∞—Ä–∫–æ–≤—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'kharkivska',
          regionName: '–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [49.993499, 36.230383]
        },
        // –ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /–ø–æ–ª—Ç–∞–≤—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|–ø–æ–ª—Ç–∞–≤—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'poltavska',
          regionName: '–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [49.588267, 34.551417]
        },
        // –ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /–∫–∏—ó–≤—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|–∫–∏–µ–≤—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'kyivska',
          regionName: '–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [50.053469, 30.758883]
        },
        // –ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /—á–µ—Ä–∫–∞—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|—á–µ—Ä–∫–∞—Å—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'cherkaska',
          regionName: '–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [49.444433, 32.059767]
        },
        // –ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å
        {
          pattern: /–∫—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞\s+–æ–±–ª–∞—Å—Ç—å|–∫–∏—Ä–æ–≤–æ–≥—Ä–∞–¥—Å–∫–∞—è\s+–æ–±–ª–∞—Å—Ç—å/i,
          region: 'kirovogradska',
          regionName: '–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
          coords: [48.507850, 32.262383]
        }
      ];
      
      for (const regional of regionalPatterns) {
        if (regional.pattern.test(textLower)) {
          return regional;
        }
      }
      
      return null;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –æ–±–ª–∞—Å—Ç–∏
    function createRegionalThreatOverlay(regionalInfo, threatType, text) {
      const regionBounds = getRegionBounds(regionalInfo.region);
      if (!regionBounds) return;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —É–≥—Ä–æ–∑—ã
      let color = '#ff6b6b';
      let icon = '‚ö†Ô∏è';
      let threatName = '–ó–∞–≥—Ä–æ–∑–∞';
      
      if (threatType === 'shahed' || /–±–ø–ª–∞|—à–∞—Ö–µ–¥/i.test(text)) {
        color = '#339af0';
        icon = 'üõ©Ô∏è';
        threatName = '–ó–∞–≥—Ä–æ–∑–∞ –ë–ø–õ–ê';
      } else if (/—Ä–∞–∫–µ—Ç/i.test(text)) {
        color = '#ff8a65';
        icon = 'üöÄ';
        threatName = '–†–∞–∫–µ—Ç–Ω–∞ –∑–∞–≥—Ä–æ–∑–∞';
      } else if (/–∞—Ä—Ç–∏–ª–µ—Ä/i.test(text)) {
        color = '#ffa726';
        icon = 'üí•';
        threatName = '–ê—Ä—Ç–∏–ª–µ—Ä—ñ–π—Å—å–∫–∞ –∑–∞–≥—Ä–æ–∑–∞';
      }
      
      // –°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª–∏–≥–æ–Ω –æ–±–ª–∞—Å—Ç–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–π –∑–∞–ª–∏–≤–∫–æ–π
      const polygon = L.polygon(regionBounds, {
        color: color,
        weight: 2,
        opacity: 0.9,
        fillColor: color,
        fillOpacity: 0.12,
        className: `regional-threat-zone ${regionalInfo.region}`
      });
      
      // –°–æ–∑–¥–∞–µ–º –≤–Ω–µ—à–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–≤–µ—á–µ–Ω–∏—è
      const glowPolygon = L.polygon(regionBounds, {
        color: color,
        weight: 5,
        opacity: 0.4,
        fillOpacity: 0,
        className: `regional-threat-glow ${regionalInfo.region}`
      });
      
      // Leaflet polygons don't have 'add' event or getElement() - styling handled via CSS
      
      // Popup —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
      const threatDetails = text.length > 100 ? text.substring(0, 100) + '...' : text;
      const popupContent = `
        <div style="
          font-size: 1.05rem; 
          line-height: 1.5; 
          max-width: 300px; 
          font-family: 'Inter', system-ui, sans-serif;
        ">
          <div style="
            font-weight: 700; 
            color: ${color}; 
            margin-bottom: 10px; 
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
          ">
            ${icon} ${threatName}
          </div>
          <div style="
            font-weight: 700; 
            margin-bottom: 8px; 
            color: #334155;
            font-size: 1.2rem;
          ">
            üìç ${regionalInfo.regionName}
          </div>
          <div style="
            color: #64748b; 
            font-size: 1rem; 
            line-height: 1.4;
            background: #f8fafc;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid ${color};
          ">
            ${threatDetails}
          </div>
          <div style="
            margin-top: 8px;
            font-size: 0.85rem;
            color: #94a3b8;
            font-style: italic;
          ">
            üïí –†–µ–≥—ñ–æ–Ω–∞–ª—å–Ω–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è ‚Ä¢ ${new Date().toLocaleTimeString('uk-UA')}
          </div>
        </div>
      `;
      
      polygon.bindPopup(popupContent, {
        maxWidth: 320,
        className: 'regional-threat-popup'
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –Ω–∞ –∫–∞—Ä—Ç—É
      glowPolygon.addTo(markerLayer);
      polygon.addTo(markerLayer);
      
      // –°–æ–∑–¥–∞–µ–º floating label –≤ —Ü–µ–Ω—Ç—Ä–µ –æ–±–ª–∞—Å—Ç–∏
      createRegionalFloatingLabel(regionalInfo, threatName, icon, color);
      
      return { polygon, glowPolygon };
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è floating label
    function createRegionalFloatingLabel(regionalInfo, threatName, icon, color) {
      const labelDiv = L.divIcon({
        html: `
          <div class="regional-threat-label" style="
            background: linear-gradient(135deg, ${color}20, ${color}35);
            border: 2px solid ${color};
            border-radius: 16px;
            padding: 10px 16px;
            font-size: 0.8rem;
            font-weight: 700;
            color: ${color};
            white-space: nowrap;
            box-shadow: 
              0 8px 32px ${color}30,
              0 0 0 1px ${color}20,
              inset 0 1px 0 rgba(255,255,255,0.2);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            letter-spacing: 0.5px;
          ">
            ${icon} ${threatName}
          </div>
        `,
        className: '',
        iconSize: [1, 1],
        iconAnchor: [0, 0]
      });
      
      const marker = L.marker(regionalInfo.coords, {
        icon: labelDiv,
        interactive: false,
        zIndexOffset: 1000
      });
      
      marker.addTo(markerLayer);
      return marker;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –æ–±–ª–∞—Å—Ç–µ–π (–±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –ø–æ–ª–∏–≥–æ–Ω—ã)
    function getRegionBounds(region) {
      const regions = {
        dnipropetrovska: [
          [49.27, 33.15], [49.27, 36.73], [49.00, 36.85], [48.50, 36.73],
          [47.95, 36.15], [47.73, 35.50], [47.73, 34.20], [47.90, 33.40],
          [48.20, 33.15], [49.27, 33.15]
        ],
        kharkivska: [
          [50.85, 35.10], [50.85, 38.15], [50.45, 38.15], [49.95, 37.85],
          [49.25, 37.40], [49.05, 36.80], [49.05, 35.80], [49.25, 35.10],
          [50.85, 35.10]
        ],
        poltavska: [
          [50.25, 32.60], [50.25, 35.75], [49.85, 35.75], [49.45, 35.40],
          [48.85, 34.90], [48.85, 33.20], [49.15, 32.60], [50.25, 32.60]
        ],
        kyivska: [
          [51.15, 29.55], [51.15, 31.95], [50.75, 31.95], [50.35, 31.60],
          [49.85, 31.20], [49.85, 30.40], [50.05, 29.55], [51.15, 29.55]
        ],
        cherkaska: [
          [49.95, 30.85], [49.95, 33.15], [49.55, 33.15], [49.15, 32.80],
          [48.85, 32.20], [48.85, 31.40], [49.05, 30.85], [49.95, 30.85]
        ],
        kirovogradska: [
          [49.15, 31.05], [49.15, 33.95], [48.75, 33.95], [48.35, 33.60],
          [47.85, 33.05], [47.85, 31.80], [48.05, 31.05], [49.15, 31.05]
        ]
      };
      
      return regions[region] || null;
    }
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    let isInitialLoad = true;
    
    // –ö–µ—à –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã
    let dataCache = null;
    let cacheTimestamp = 0;
    const CACHE_DURATION = 60000; // 60 —Å–µ–∫—É–Ω–¥ –∫–µ—à (—É–≤–µ–ª–∏—á–µ–Ω–æ —Å 30)
    
    async function updateMarkers() {
      // –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º timeRange - –ø—É—Å—Ç—å —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∏–∑ –∞–¥–º–∏–Ω–∫–∏ (MONITOR_PERIOD_MINUTES)
      const threatType = '';
      const maxTracks = 500;
      const params = new URLSearchParams({ confRange: 0, maxTracks });
  const overlay = document.getElementById('markerLoadingOverlay');
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
  if (overlay && isInitialLoad) {
    overlay.classList.remove('hidden');
  }
  
      let points = []; // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –ø–µ—Ä–µ–¥ try –±–ª–æ–∫–æ–º
      
      try {
        let data;
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
        const now = Date.now();
        if (dataCache && (now - cacheTimestamp) < CACHE_DURATION) {
          data = dataCache;
        } else {
          const res = await fetch('/data?' + params.toString());
          data = await res.json();
          // –ö–µ—à–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
          dataCache = data;
          cacheTimestamp = now;
        }
        
  points = (data.tracks || []).filter(p => {
        if (typeof p.lat !== 'number' || typeof p.lng !== 'number') return false;
        if (isNaN(p.lat) || isNaN(p.lng)) return false;
        if (Math.abs(p.lat) < 1 && Math.abs(p.lng) < 1) return false;
        if (p.lat < 43 || p.lat > 53.5 || p.lng < 21 || p.lng > 41) return false;
        const vague = ['—Å—Ö—ñ–¥','–∑–∞—Ö—ñ–¥','–ø—ñ–≤–Ω—ñ—á','–ø—ñ–≤–¥–µ–Ω—å','–≤–æ—Å—Ç–æ–∫','–∑–∞–ø–∞–¥','—Å–µ–≤–µ—Ä','—é–≥'];
        if (p.place && vague.includes((p.place||'').toLowerCase())) return false;
        return true;
      });
      
      // Expose current points for search suggestions
      window.__lastPoints = points;
      if (threatType) points = points.filter(p => (p.threat_type || '').toLowerCase() === threatType);
      
      // Always hide the overlay after processing one fetch to avoid spinner lock
      if (overlay) { 
        overlay.classList.add('hidden'); 
        if (isInitialLoad) {
          isInitialLoad = false;
        }
      }
      
      // –û–∫—Ä–µ–º–∏–π —à–∞—Ä –¥–ª—è —à–∞—Ö–µ–¥—ñ–≤ (–±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó)
      if (!window.shahedLayer) {
        window.shahedLayer = L.layerGroup().addTo(map);
      } else {
        window.shahedLayer.clearLayers();
      }
      
      if (markerLayer) { 
        markerLayer.clearLayers(); 
      } else { 
        // –ó–≤–∏—á–∞–π–Ω–∞ layer group –±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó
        markerLayer = L.layerGroup().addTo(map);
      }
      markers = [];
      
      // --------- Performance adaptive mode ---------
      const MAX_DIRECT_MARKERS = 650; // threshold where we switch to clustered fast mode
      
      // –†–æ–∑–¥—ñ–ª—è—î–º–æ —à–∞—Ö–µ–¥–∏ —Ç–∞ —ñ–Ω—à—ñ –∑–∞–≥—Ä–æ–∑–∏
      const shahedPoints = points.filter(p => {
        const tt = (p.threat_type || '').toLowerCase();
        return tt === 'shahed' || /—à–∞—Ö–µ–¥/i.test(p.threat_type || '');
      });
      const otherPoints = points.filter(p => {
        const tt = (p.threat_type || '').toLowerCase();
        return tt !== 'shahed' && !/—à–∞—Ö–µ–¥/i.test(p.threat_type || '');
      });
      
      const useFastMode = otherPoints.length > MAX_DIRECT_MARKERS;
      if (useFastMode) {
        const z = map.getZoom();
        // cell size (degrees) shrinks with zoom to gradually reveal more detail
        let cell = 0.55;
        if (z >= 7) cell = 0.32; if (z >= 8) cell = 0.18; if (z >= 9) cell = 0.11; if (z >= 10) cell = 0.06;
        const keyFn = p => Math.floor(p.lat / cell) + '_' + Math.floor(p.lng / cell);
        const buckets = new Map();
        for (const p of otherPoints){
          const k = keyFn(p);
            let b = buckets.get(k);
            if(!b){ b = { items:[], latSum:0, lngSum:0, types: new Map(), latest:0 }; buckets.set(k,b); }
            b.items.push(p); b.latSum += p.lat; b.lngSum += p.lng; 
            const tt=(p.threat_type||'').toLowerCase(); b.types.set(tt, (b.types.get(tt)||0)+1);
            const ts = Date.parse((p.date||'').replace(/-/g,'/')) || 0; if(ts> b.latest) b.latest = ts;
        }
        buckets.forEach(async b => {
          const lat = b.latSum / b.items.length;
          const lng = b.lngSum / b.items.length;
          // choose dominant threat type for icon (fallback default)
          let dominant = 'default'; let maxc=0;
          b.types.forEach((c,t)=>{ if(c>maxc){ maxc=c; dominant=t; } });
          
          // Use optimized async image loading for clusters
          let iconUrl = PLACEHOLDER_ICON; // Start with placeholder
          try {
            iconUrl = await getIconUrl(dominant);
          } catch (error) {
            console.warn('Failed to load cluster icon:', error);
            iconUrl = FALLBACK_ICON;
          }
          
          const count = b.items.length;
          const ageMin = (Date.now()-b.latest)/60000;
          const freshness = ageMin < 8 ? 'fresh' : ageMin < 20 ? 'stale' : 'old';
          
          // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞
          let clusterOpacity = 1.0;
          if (ageMin <= 30) {
            clusterOpacity = 1.0;
          } else if (ageMin <= 120) {
            clusterOpacity = 1.0 - ((ageMin - 30) / 90) * 0.4;
          } else {
            const extraMinutes = Math.min(ageMin - 120, 120);
            clusterOpacity = 0.6 - (extraMinutes / 120) * 0.3;
          }
          clusterOpacity = Math.max(0.3, Math.min(1.0, clusterOpacity));
          
          // Simple cluster without SVG icon
          const html = '<div class="cluster cluster-' + freshness + '" style="opacity:' + clusterOpacity + ';"><b>' + count + '</b></div>';
          const icon = L.divIcon({ html, className:'', iconSize:[36,42], iconAnchor:[18,38] });
          const m = L.marker([lat,lng], {icon});
          // Popup summary
          const typeLines = [...b.types.entries()].sort((a,b)=>b[1]-a[1]).slice(0,6).map(([t,c])=>'<div style="font-size:1rem;">' + (t||'‚Äî') + ': ' + c + '</div>').join('');
          m.bindPopup('<div style="font-size:1rem;line-height:1.4;padding:8px;"><b style="font-size:1.2rem;">' + count + '</b> <span style="font-size:1rem;">–ø–æ–¥—ñ–π</span><br>' + typeLines + '<div style="margin-top:6px;opacity:.6;font-size:.85rem;">–∫–ª–∞—Å—Ç–µ—Ä (–¥–µ—Ç–∞–ª—ñ –ø—Ä–∏ –∑–±—ñ–ª—å—à–µ–Ω–Ω—ñ)</div></div>');
          m.addTo(markerLayer); markers.push(m);
        });
        // Style inject (once)
        if(!document.getElementById('clusterStyles')){
          const st=document.createElement('style'); st.id='clusterStyles'; st.textContent=
            '.cluster{position:relative;display:flex;align-items:center;justify-content:center;background:linear-gradient(145deg,#1e293b,#0f172a);border:2px solid #334155;border-radius:18px;padding:4px 6px 6px;box-shadow:0 4px 12px -3px rgba(0,0,0,.4);} ' +
            '.cluster img{width:26px;height:26px;object-fit:contain;filter:drop-shadow(0 0 4px rgba(0,0,0,.5));margin-right:2px;} ' +
            '.cluster b{font-size:.8rem;font-family:Inter,system-ui,sans-serif;color:#fff;text-shadow:0 1px 2px #000;} ' +
            '.cluster-fresh{background:linear-gradient(160deg,#164e63,#0f2d40);border-color:#155e75;} ' +
            '.cluster-stale{background:linear-gradient(160deg,#3f3f46,#27272a);border-color:#52525b;} ' +
            '.cluster-old{background:linear-gradient(160deg,#1e1b4b,#0f172a);border-color:#312e81;opacity:.72;} ';
          document.head.appendChild(st); }
        // Update event list but skip detailed marker render heavy stuff
        updateEventList(data.events || []);
        try { document.dispatchEvent(new CustomEvent('markersUpdated', {detail: data})); } catch(e){}
        if (overlay && points.length>0) { 
          overlay.classList.add('hidden');
          if (isInitialLoad) {
            isInitialLoad = false; // –û—Ç–º–µ—á–∞–µ–º, —â–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
          }
        }
        // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —à–∞—Ö–µ–¥–∏ –æ–∫—Ä–µ–º–æ –Ω–∞–≤—ñ—Ç—å —É fast mode
        // (–≤–æ–Ω–∏ –Ω–µ –≤—Ö–æ–¥—è—Ç—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–∏)
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç–æ–π –∂–µ –∫–æ–¥ —â–æ –π –Ω–∏–∂—á–µ, –∞–ª–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è shahedPoints
        // –©–æ–± –Ω–µ –¥—É–±–ª—é–≤–∞—Ç–∏ –∫–æ–¥, –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î–º–æ return —Ç—É—Ç, –∞ –ø—Ä–æ–¥–æ–≤–∂—É—î–º–æ –∑ shahedPoints
      }
      
  // Container for border-shelling overlays (semi-circles)
  let borderShellingDrawn = false;
      const pointsToRender = useFastMode ? shahedPoints : points;
      pointsToRender.forEach(async p => {
        
        // === –ü–†–û–í–ï–†–ö–ê –ù–ê –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –£–ì–†–û–ó–´ ===
        const regionalInfo = isRegionalThreat(p.text, p.place);
        if (regionalInfo) {
          createRegionalThreatOverlay(regionalInfo, p.threat_type, p.text);
          return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
        }
        
        let iconUrl = ICONS[p.threat_type] || ICONS.default;
        let useCustomIcon = false;
        
        if (p.marker_icon) {
          iconUrl = (p.marker_icon.startsWith('http') || p.marker_icon.startsWith('/')) ? p.marker_icon : '/static/' + p.marker_icon;
          useCustomIcon = true;
        }
        
        // Override for FPV targeted settlements
        if (!useCustomIcon && isFPVThreat(p.place, p.text, p.threat_type)) {
          iconUrl = ICONS.fpv || iconUrl;
        }
        
        // Use optimized async image loading only if no custom icon
        if (!useCustomIcon) {
          try {
            iconUrl = await getIconUrl(p.threat_type || 'default');
          } catch (error) {
            iconUrl = FALLBACK_ICON;
          }
        }
        // Extract inline count / direction from place label pattern 'Name (N) ‚Üê–ø—ñ–≤–¥–Ω—è'
        if (!p.count && p.place) {
          const m = p.place.match(/\((\d{1,3})\)/);
          if (m) { p.count = parseInt(m[1]); }
        }
        let arrowDir = null;
        const trajectoryStart = normalizeTrajectoryPoint(p.trajectory && p.trajectory.start ? p.trajectory.start : null);
        const trajectoryEnd = normalizeTrajectoryPoint(p.trajectory && p.trajectory.end ? p.trajectory.end : null);
        if (p.place && p.place.includes('‚Üê')) {
          arrowDir = p.place.split('‚Üê').pop().trim();
          markerDebugLog('üéØ –°–¢–†–ï–õ–ö–ê –ù–ê–ô–î–ï–ù–ê! place:', p.place, 'arrowDir:', arrowDir, 'threat_type:', p.threat_type);
        } else {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ trajectory –¥–ª—è –ß–µ—Ä–Ω–æ–≥–æ –º–æ—Ä—è
          if (trajectoryStart && trajectoryEnd) {
            markerDebugLog('üåä –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –∏–∑ –ß–Å–†–ù–û–ì–û –ú–û–†–Ø –Ω–∞–π–¥–µ–Ω–∞:', p.trajectory, 'place:', p.place);
          } else {
            markerDebugLog('‚ùå –°—Ç—Ä–µ–ª–∫–∞ –ù–ï –Ω–∞–π–¥–µ–Ω–∞ –∏ –Ω–µ—Ç trajectory. place:', p.place);
          }
        }
  const threatClass = (p.threat_type||'default').toLowerCase();
  const countBadge = (p.threat_type==='shahed' || /shahed|—à–∞—Ö–µ–¥|–±–ø–ª–∞/i.test(p.threat_type||'')) && p.count && p.count>1 ? '<div class="tm-badge">' + p.count + '√ó</div>' : '';
  // Dynamic scale: keep screen footprint smaller on distant zooms so visual offset feels minimal
  let z = map.getZoom ? map.getZoom() : 6;
  let base = 26; // base size at mid zoom (smaller footprint)
  // scale factor: gentle scaling so markers stay compact on distant zooms
  let factor = z >= 9 ? 1.05 : z >= 7 ? 0.9 : z >= 6 ? 0.8 : z >=5 ? 0.65 : 0.5;
  const w = Math.round(base * factor);
  const h = Math.round(w * 1.05);
  
  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–∞—Ä–∫–µ—Ä–∞
  let opacity = 1.0;
  if (p.date) {
    try {
      const markerDate = new Date(p.date);
      const now = new Date();
      const ageInMinutes = (now - markerDate) / (1000 * 60);
      
      // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏:
      // 0-30 –º–∏–Ω—É—Ç: –ø–æ–ª–Ω–∞—è –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (1.0)
      // 30-120 –º–∏–Ω—É—Ç: –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥–æ 0.6
      // 120+ –º–∏–Ω—É—Ç: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 0.3
      if (ageInMinutes <= 30) {
        opacity = 1.0;
      } else if (ageInMinutes <= 120) {
        // –õ–∏–Ω–µ–π–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –æ—Ç 1.0 –¥–æ 0.6 –∑–∞ 90 –º–∏–Ω—É—Ç
        opacity = 1.0 - ((ageInMinutes - 30) / 90) * 0.4;
      } else {
        // –î–∞–ª—å–Ω–µ–π—à–µ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ –¥–æ 0.3 –∑–∞ —Å–ª–µ–¥—É—é—â–∏–µ 120 –º–∏–Ω—É—Ç
        const extraMinutes = Math.min(ageInMinutes - 120, 120);
        opacity = 0.6 - (extraMinutes / 120) * 0.3;
      }
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
      opacity = Math.max(0.3, Math.min(1.0, opacity));
    } catch (e) {
      console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –º–∞—Ä–∫–µ—Ä–∞:', p.date, e);
      opacity = 1.0;
    }
  }
  
  // Use PNG markers for better compatibility (wrap with rotator div for manual bearing)
  let rotationDeg = 0;
  if (typeof p.rotation === 'number' && isFinite(p.rotation)) {
    rotationDeg = p.rotation;
  } else if (p.rotation !== undefined) {
    const parsedRot = parseFloat(p.rotation);
    rotationDeg = isFinite(parsedRot) ? parsedRot : 0;
  }
  const markerImg = '<img class="plain-marker-img" src="' + iconUrl + '" alt="" loading="lazy">';
  let markerContent = '<div class="marker-rotator" style="width:' + w + 'px;height:' + h + 'px;transform:rotate(' + rotationDeg + 'deg);">' + markerImg + '</div>';
  
  // –ê–ù–ò–ú–ê–¶–ò–Ø –ü–û–õ–Å–¢–ê: –≤—ã—á–∏—Å–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è –®–∞—Ö–µ–¥–∞
  let flightAnimation = '';
  if (arrowDir && (p.threat_type === 'shahed' || /shahed|—à–∞—Ö–µ–¥|–±–ø–ª–∞/i.test(p.threat_type||''))) {
    const dir = arrowDir.toLowerCase();
    let dx=0, dy=0;
    if (dir.includes('–ø—ñ–≤–¥')) dy = -0.35;
    if (dir.includes('–ø—ñ–≤–Ω—ñ—á')) dy = 0.35;
    if (dir.includes('—Å—Ö–æ–¥')) dx = -0.35;
    if (dir.includes('–∑–∞—Ö')) dx = 0.35;
    
    if (dx !== 0 || dy !== 0) {
      // –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –ø–∏–∫—Å–µ–ª—è—Ö –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
      const map_zoom = map.getZoom ? map.getZoom() : 6;
      // –ü—Ä–∏–º–µ—Ä–Ω–æ 111 –∫–º –Ω–∞ –≥—Ä–∞–¥—É—Å —à–∏—Ä–æ—Ç—ã, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø–æ–¥ —Ç–µ–∫—É—â–∏–π –∑—É–º
      const pixels_per_degree = 256 * Math.pow(2, map_zoom) / 360;
      const flight_dx_px = dx * pixels_per_degree;
      const flight_dy_px = -dy * pixels_per_degree; // –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Y (–Ω–∞ –∫–∞—Ä—Ç–µ Y —Ä–∞—Å—Ç—ë—Ç –≤–Ω–∏–∑)
      
      // –°–∫–æ—Ä–æ—Å—Ç—å –®–∞—Ö–µ–¥–∞ ~220 –∫–º/—á = ~61 –º/—Å = ~0.061 –∫–º/—Å
      // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = sqrt(dx¬≤ + dy¬≤) * 111 –∫–º/–≥—Ä–∞–¥—É—Å
      const distance_km = Math.sqrt(dx*dx + dy*dy) * 111;
      // –í—Ä–µ–º—è –ø–æ–ª—ë—Ç–∞ = —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ / —Å–∫–æ—Ä–æ—Å—Ç—å (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
      const flight_time_sec = (distance_km / 0.061); // —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –≤—Ä–µ–º—è
      // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏: –Ω–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥ –¥–∞–∂–µ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
      const animation_duration = Math.max(30, Math.min(flight_time_sec, 120)); // 30-120 —Å–µ–∫—É–Ω–¥
      
      flightAnimation = ` style="--flight-dx: ${-flight_dx_px}px; --flight-dy: ${-flight_dy_px}px; --flight-duration: ${animation_duration}s;"`;
    }
  }
  
  const html = '<div class="tm-wrap shahed-marker-active shahed-flying marker-new"' + flightAnimation + ' style="opacity:' + opacity + ';">' + markerContent + countBadge + '</div>';
  // Anchor to visual center (half width/height) instead of bottom so geographic point stays stable when scaling
  const icon = L.divIcon({ html, className:'', iconSize:[w,h], iconAnchor:[w/2, h/2], popupAnchor:[0,-h/2] });
  const m = L.marker([p.lat, p.lng], { icon, riseOnHover:true });
        // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –¢–†–ê–ï–ö–¢–û–†–ò–Ø: –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—ë—Ç–∞
        if (arrowDir) {
          markerDebugLog('üöÄ –†–ò–°–£–ï–ú –¢–†–ê–ï–ö–¢–û–†–ò–Æ! arrowDir:', arrowDir, 'place:', p.place);
          const dir = arrowDir.toLowerCase();
          let dx=0, dy=0;
          // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
          if (dir.includes('–ø—ñ–≤–¥')) dy = -0.5; // tail origin south of marker => movement northwards
          if (dir.includes('–ø—ñ–≤–Ω—ñ—á')) dy = 0.5;
          if (dir.includes('—Å—Ö–æ–¥')) dx = -0.5; // east origin => movement westwards
          if (dir.includes('–∑–∞—Ö')) dx = 0.5;
          markerDebugLog('üìê –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Å–º–µ—â–µ–Ω–∏—è: dx=', dx, 'dy=', dy, 'dir=', dir);
          if (dx !==0 || dy !==0) {
            markerDebugLog('‚úÖ –°–û–ó–î–ê–Å–ú –õ–ò–ù–ò–Æ! tailStart:', [p.lat+dy, p.lng+dx], 'marker:', [p.lat, p.lng]);
            const tailStart=[p.lat+dy, p.lng+dx];
            // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –∏ –ø—É–ª—å—Å–∞—Ü–∏–µ–π
            const polylineOpacity = opacity * 0.85;
            const trajectory = L.polyline([tailStart,[p.lat,p.lng]], {
              color:'#ef4444', 
              weight:4, 
              opacity:polylineOpacity, 
              dashArray:'10 6',
              className:'trajectory-line animated-trajectory'
            }).addTo(markerLayer);
            markerDebugLog('üé® –õ–ò–ù–ò–Ø –î–û–ë–ê–í–õ–ï–ù–ê –ù–ê –ö–ê–†–¢–£!', trajectory);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ (simple version from map_only)
            const angle = Math.atan2(p.lat - tailStart[0], p.lng - tailStart[1]) * 180 / Math.PI + 90;
            const arrowIcon = L.divIcon({
              html: `<div class="direction-arrow" style="transform: rotate(${angle}deg);"><svg width="40" height="40" viewBox="0 0 40 40"><path d="M 20 5 L 30 20 L 20 17 L 10 20 Z" fill="#ef4444" stroke="#ffffff" stroke-width="1.5" opacity="${polylineOpacity}"/></svg></div>`,
              className: '',
              iconSize: [40, 40],
              iconAnchor: [20, 20]
            });
            L.marker([p.lat, p.lng], {icon: arrowIcon}).addTo(markerLayer);
          }
        }
        
        // Shahed course visualization - re-enabled to show movement vectors
        if (p.course_direction || p.course_target || p.course_source) {
          try {
            addShahedCourseVisualization(p);
          } catch(e) {
            console.warn('Failed to add course visualization:', e);
          }
        }
        
        const placeUA = translatePlace(p.place);
        
        // –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
        const threatColors = {
          shahed: { bg: '#fee2e2', accent: '#dc2626' },
          rocket: { bg: '#fed7aa', accent: '#ea580c' },
          avia: { bg: '#fef3c7', accent: '#d97706' },
          artillery: { bg: '#fef9c3', accent: '#ca8a04' },
          fpv: { bg: '#e9d5ff', accent: '#9333ea' },
          alarm_cancel: { bg: '#d1fae5', accent: '#10b981' },
          default: { bg: '#dbeafe', accent: '#3b82f6' }
        };
        
        const threatType = (p.threat_type || 'default').toLowerCase();
        const colors = threatColors[threatType] || threatColors.default;
        
        // Calculate marker age
        let ageText = '';
        if (p.date) {
          try {
            const markerDate = new Date(p.date);
            const now = new Date();
            const ageMinutes = Math.floor((now - markerDate) / (1000 * 60));
            
            if (ageMinutes < 1) {
              ageText = '—â–æ–π–Ω–æ';
            } else if (ageMinutes < 60) {
              ageText = `${ageMinutes} —Ö–≤ —Ç–æ–º—É`;
            } else {
              const hours = Math.floor(ageMinutes / 60);
              const mins = ageMinutes % 60;
              if (mins > 0) {
                ageText = `${hours} –≥–æ–¥ ${mins} —Ö–≤ —Ç–æ–º—É`;
              } else {
                ageText = `${hours} –≥–æ–¥ —Ç–æ–º—É`;
              }
            }
          } catch (e) {}
        }
        
        const popupHtml = `
          <div style="
            background: white;
            border-left: 3px solid ${colors.accent};
            border-radius: 6px;
            padding: 8px 10px;
            min-width: 160px;
            max-width: 240px;
            font-family: -apple-system, sans-serif;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
          ">
            ${placeUA ? `<div style="
              font-size: 0.9rem;
              font-weight: 600;
              color: #1e293b;
              margin-bottom: 4px;
            ">${placeUA}</div>` : ''}
            
            <div style="
              font-size: 0.8rem;
              color: #64748b;
              line-height: 1.4;
              margin-bottom: 4px;
            ">${cleanMessage(p.text||'')}</div>
            
            <div style="display: flex; align-items: center; gap: 6px; flex-wrap: wrap;">
              ${p.count ? `<span style="
                display: inline-block;
                background: ${colors.bg};
                color: ${colors.accent};
                font-weight: 600;
                font-size: 0.7rem;
                padding: 2px 5px;
                border-radius: 3px;
              ">√ó${p.count}</span>` : ''}
              ${ageText ? `<span style="font-size: 0.7rem; color: #94a3b8;">üïê ${ageText}</span>` : ''}
            </div>
          </div>
        `;
        
        m.bindPopup(popupHtml, { closeButton:false, autoPan:true });
        
        // –®–∞—Ö–µ–¥–∏ –¥–æ–¥–∞—î–º–æ –¥–æ –æ–∫—Ä–µ–º–æ–≥–æ —à–∞—Ä—É –±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü—ñ—ó
        const isShahed = (p.threat_type || '').toLowerCase() === 'shahed' || /—à–∞—Ö–µ–¥/i.test(p.threat_type || '');
        if (isShahed) {
          window.shahedLayer.addLayer(m);
        } else {
          markerLayer.addLayer(m);
        }
        markers.push(m);
        
        // –¢–†–ê–ï–ö–¢–û–†–ò–Ø –î–õ–Ø –ß–ï–†–ù–û–ú–û–†–°–ö–ò–• –ë–ø–õ–ê (–ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞)
        if (trajectoryStart && trajectoryEnd) {
          try {
            const startLat = trajectoryStart[0];
            const startLng = trajectoryStart[1];
            const endLat = trajectoryEnd[0];
            const endLng = trajectoryEnd[1];
            const targetName = p.trajectory.target || '';
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ä–∞
            const trajectoryOpacity = opacity * 0.85;
            
            // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—É–Ω–∫—Ç–∏—Ä–Ω—É—é –ª–∏–Ω–∏—é –æ—Ç —Ç–æ—á–∫–∏ –≤ –º–æ—Ä–µ –¥–æ —Ü–µ–ª–µ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞
            const trajectoryLine = L.polyline(
              [[startLat, startLng], [endLat, endLng]], 
              {
                color: '#ef4444',      // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                weight: 4,             // –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏ (—É–≤–µ–ª–∏—á–µ–Ω–∞)
                opacity: trajectoryOpacity,
                dashArray: '10 6',     // –ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è (10px —á–µ—Ä—Ç–æ—á–∫–∞, 6px –ø—Ä–æ–±–µ–ª)
                className: 'black-sea-trajectory animated-trajectory'
              }
            ).addTo(markerLayer);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–µ–ª–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–æ–Ω—Ü–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ (–æ–∫–æ–ª–æ —Ü–µ–ª–µ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞)
            const angle = Math.atan2(endLat - startLat, endLng - startLng) * 180 / Math.PI + 90;
            const arrowIcon = L.divIcon({
              html: `<div class="trajectory-arrow" style="transform: rotate(${angle}deg);">
                       <svg width="36" height="36" viewBox="0 0 36 36">
                         <defs>
                           <filter id="glow-sea">
                             <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                             <feMerge>
                               <feMergeNode in="coloredBlur"/>
                               <feMergeNode in="SourceGraphic"/>
                             </feMerge>
                           </filter>
                         </defs>
                         <path d="M 18 5 L 27 18 L 18 15 L 9 18 Z" 
                               fill="#ef4444" 
                               stroke="#ffffff" 
                               stroke-width="2" 
                               opacity="${trajectoryOpacity}"
                               filter="url(#glow-sea)"/>
                       </svg>
                     </div>`,
              className: '',
              iconSize: [36, 36],
              iconAnchor: [18, 18]
            });
            const arrowMarker = L.marker([endLat, endLng], {icon: arrowIcon, interactive: false}).addTo(markerLayer);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (targetName) {
              const targetLabelIcon = L.divIcon({
                html: `<div class="trajectory-target-label" style="
                  background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
                  color: white;
                  padding: 5px 10px;
                  border-radius: 6px;
                  font-size: 0.8rem;
                  font-weight: 700;
                  white-space: nowrap;
                  box-shadow: 0 3px 8px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.3) inset;
                  opacity: ${trajectoryOpacity};
                  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
                  letter-spacing: 0.3px;
                ">${targetName}</div>`,
                className: '',
                iconSize: [1, 1],
                iconAnchor: [0, -12]
              });
              L.marker([endLat, endLng], {icon: targetLabelIcon, interactive: false}).addTo(markerLayer);
            }
          } catch (e) {
            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –ë–ø–õ–ê:', e);
          }
        }

        // Red semi-circle (sector) for border shelling alerts (visualizing incoming danger from external border)
        if (p.border_shelling && !borderShellingDrawn) {
          borderShellingDrawn = true; // only one large overlay per update to avoid clutter
          try {
            // Draw a semi-circle (180¬∞) oriented toward likely hostile border (east / north-east for –•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ / –°—É–º—Å—å–∫–∞, adjust by longitude)
            const centerLat = p.lat; const centerLng = p.lng;
            const spanKm = 120; // radius
            const segments = 80; // smoothness
            // Bearing range depending on oblast heuristic
            let startBearing = 315; // NW
            let endBearing = 135;  // SE
            if (centerLng > 35) { startBearing = 290; endBearing = 110; }
            const pts = [];
            const R = 6371; // km
            const toRad = d=>d*Math.PI/180; const toDeg = r=>r*180/Math.PI;
            for(let i=0;i<=segments;i++){
              const brg = startBearing + (endBearing-startBearing)* (i/segments);
              const d = spanKm / R; // angular distance
              const br = toRad(brg);
              const lat1 = toRad(centerLat);
              const lon1 = toRad(centerLng);
              const lat2 = Math.asin(Math.sin(lat1)*Math.cos(d)+Math.cos(lat1)*Math.sin(d)*Math.cos(br));
              const lon2 = lon1 + Math.atan2(Math.sin(br)*Math.sin(d)*Math.cos(lat1), Math.cos(d)-Math.sin(lat1)*Math.sin(lat2));
              pts.push([toDeg(lat2), ((toDeg(lon2)+540)%360)-180]);
            }
            pts.unshift([centerLat, centerLng]);
            const poly = L.polygon(pts, {color:'#b91c1c', weight:1, fillColor:'#dc2626', fillOpacity:0.18, stroke:true});
            poly.addTo(markerLayer);
          } catch(e){}
        }
        // KAB guided bomb threat zone (semi-circle) for raketa markers whose text mentions '–∫–∞–±'
        if (!p.border_shelling && p.threat_type && p.threat_type.toLowerCase()==='raketa' && /–∫–∞–±/i.test(p.text||'')) {
          try {
            const centerLat = p.lat; const centerLng = p.lng;
            // West-facing semi-circle (threat from east -> projecting toward Ukraine)
            const startBearing = 180, endBearing = 360;
            const OUTER = 10; // km outer radius (reduced from 50)
            const segments = 96;
            // Ensure SVG gradients exist once
            (function ensureKabGrad(){
              const mapPane = document.querySelector('.leaflet-overlay-pane svg');
              if(!mapPane) return;
              if(mapPane.querySelector('#kabGradOuter')) return;
              const defs = mapPane.querySelector('defs') || (function(){ const d=document.createElementNS('http://www.w3.org/2000/svg','defs'); mapPane.insertBefore(d,mapPane.firstChild); return d; })();
              const gOuter = document.createElementNS('http://www.w3.org/2000/svg','radialGradient');
              gOuter.id='kabGradOuter'; gOuter.setAttribute('fx','35%'); gOuter.setAttribute('fy','30%');
              [['0%','#ff7b6f'],['65%','rgba(255,59,48,0.55)'],['100%','rgba(255,59,48,0)']].forEach(([o,c])=>{ const stop=document.createElementNS('http://www.w3.org/2000/svg','stop'); stop.setAttribute('offset',o); stop.setAttribute('stop-color',c); defs.appendChild(gOuter); gOuter.appendChild(stop); });
              const gMid = document.createElementNS('http://www.w3.org/2000/svg','radialGradient');
              gMid.id='kabGradMid'; gMid.setAttribute('fx','40%'); gMid.setAttribute('fy','35%');
              [['0%','#ffb4ab'],['60%','rgba(255,107,94,.65)'],['100%','rgba(255,107,94,0)']].forEach(([o,c])=>{ const stop=document.createElementNS('http://www.w3.org/2000/svg','stop'); stop.setAttribute('offset',o); stop.setAttribute('stop-color',c); defs.appendChild(gMid); gMid.appendChild(stop); });
            })();
            const layerDefs = [
              {r:OUTER, cls:'kab-zone-outer'},
              {r:OUTER*0.66, cls:'kab-zone-mid'},
              {r:OUTER*0.38, cls:'kab-zone-inner'}
            ];
            layerDefs.forEach(ld=>{
              const pts = buildSemiCircle(centerLat, centerLng, startBearing, endBearing, ld.r, segments);
              const poly = L.polygon(pts, {className:ld.cls, color:'#ff3b30', weight:0.6, fillOpacity:0.22, stroke:true}).addTo(markerLayer);
            });
            // Scanning arc (outline only)
            const scanPts = buildSemiCircle(centerLat, centerLng, startBearing, endBearing, OUTER*0.92, segments);
            const scan = L.polygon(scanPts, {className:'kab-zone-scan', color:'#ffe0dc', weight:1, fill:false});
            scan.addTo(markerLayer);
            // –û—Ç–∫–ª—é—á–∏–ª–∏ KAB rotor –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            // Center glow & label using a divIcon
            const centerDiv = L.divIcon({ html:`<div class='kab-center-glow'></div>`, className:'', iconSize:[36,36] });
            L.marker([centerLat, centerLng], {icon:centerDiv, interactive:false}).addTo(markerLayer);
            // Label placed at midpoint of arc (bearing 270¬∞)
            const midBearing = 270 * Math.PI/180; const R=6371; const d= (OUTER*0.62)/R; const toRad=x=>x*Math.PI/180; const toDeg=r=>r*180/Math.PI;
            const lat1=toRad(centerLat); const lon1=toRad(centerLng);
            const lat2 = Math.asin(Math.sin(lat1)*Math.cos(d)+Math.cos(lat1)*Math.sin(d)*Math.cos(midBearing));
            const lon2 = lon1 + Math.atan2(Math.sin(midBearing)*Math.sin(d)*Math.cos(lat1), Math.cos(d)-Math.sin(lat1)*Math.sin(lat2));
            const labelDiv = L.divIcon({ html:`<div class='kab-label'>–ö–ê–ë<br><span style='font-weight:400;opacity:.8'>~${OUTER}–∫–º</span></div>`, className:'', iconSize:[1,1] });
            L.marker([toDeg(lat2), ((toDeg(lon2)+540)%360)-180], {icon:labelDiv, interactive:false}).addTo(markerLayer);
          } catch(e){}
        }
      });
      
      updateEventList(data.events || []);
      // Notify listeners (banner heuristics etc.)
      try { document.dispatchEvent(new CustomEvent('markersUpdated', {detail: data})); } catch(e){}
      
      // Draw trajectory lines between waypoints for multi-region threats
      try {
        const trajectoryMarkers = points.filter(p => p.source_match === 'trajectory_phrase');
        if (trajectoryMarkers.length >= 2) {
          // Group by message ID (extract from marker ID like "59633_t1", "59633_t2")
          const trajectoryGroups = new Map();
          trajectoryMarkers.forEach(p => {
            const match = p.id.match(/^(\d+)_t(\d+)$/);
            if (match) {
              const msgId = match[1];
              const seqNum = parseInt(match[2]);
              if (!trajectoryGroups.has(msgId)) {
                trajectoryGroups.set(msgId, []);
              }
              trajectoryGroups.get(msgId).push({marker: p, seq: seqNum});
            }
          });
          
          // Draw lines for each trajectory group
          trajectoryGroups.forEach((group, msgId) => {
            // Sort by sequence number
            group.sort((a, b) => a.seq - b.seq);
            if (group.length >= 2) {
              // Draw polyline connecting all waypoints
              const waypoints = group.map(item => [item.marker.lat, item.marker.lng]);
              const trajectoryLine = L.polyline(waypoints, {
                color: '#00d4ff',
                weight: 4,
                opacity: 0.8,
                dashArray: '10 6',
                className: 'multi-region-trajectory'
              }).addTo(markerLayer);
              
              // Add arrows between each pair of waypoints
              for (let i = 0; i < group.length - 1; i++) {
                const start = group[i].marker;
                const end = group[i + 1].marker;
                const angle = Math.atan2(end.lat - start.lat, end.lng - start.lng) * 180 / Math.PI + 90;
                const midLat = (start.lat + end.lat) / 2;
                const midLng = (start.lng + end.lng) / 2;
                
                const arrowIcon = L.divIcon({
                  html: `<div class="trajectory-arrow" style="transform: rotate(${angle}deg);"><svg width="36" height="36" viewBox="0 0 36 36"><path d="M 18 5 L 27 18 L 18 15 L 9 18 Z" fill="#00d4ff" stroke="#ffffff" stroke-width="2" opacity="0.9"/></svg></div>`,
                  className: '',
                  iconSize: [36, 36],
                  iconAnchor: [18, 18]
                });
                L.marker([midLat, midLng], {icon: arrowIcon, interactive: false}).addTo(markerLayer);
              }
            }
          });
        }
      } catch(e) {
        console.warn('Failed to draw trajectory lines:', e);
      }
      
      if (overlay) { 
        overlay.classList.add('hidden'); // –≤—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞—Ç—å —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        if (isInitialLoad) {
          console.log('updateMarkers: —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (–æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º)');
          isInitialLoad = false; // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        }
      }
      console.log('updateMarkers: –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –°–æ–∑–¥–∞–Ω–æ –º–∞—Ä–∫–µ—Ä–æ–≤:', markers.length, 'Overlay —Å–∫—Ä—ã—Ç');
      
      } catch (error) {
        console.error('updateMarkers: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        const overlay = document.getElementById('markerLoadingOverlay');
        if (overlay) { 
          overlay.classList.add('hidden');
          if (isInitialLoad) {
            console.log('updateMarkers: —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ');
            isInitialLoad = false; // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
          }
        }
        return;
      }
    }
    // Removed hookZoomRedraw for FPS optimization - markers scale automatically via CSS
    // Create a curved arc (quadratic bezier approximation) and fading tail
    function addTrajectoryArc(p, dx, dy){
      const isDrone = /(shahed|fpv)/i.test(p.threat_type||'');
      const scale = isDrone ? 1.4 : 2.0; // longer for missiles
      const latEnd = p.lat, lngEnd = p.lng;
      const latStart = latEnd + dy*scale;
      const lngStart = lngEnd + dx*scale;
      // Perp vector for curvature
      let perpX = -dy, perpY = dx;
      const norm = Math.hypot(perpX, perpY)||1;
      perpX/=norm; perpY/=norm;
      const curveFactor = 0.35 * (isDrone?0.8:1); // subtler for drones
      const controlLat = (latStart+latEnd)/2 + perpY*curveFactor;
      const controlLng = (lngStart+lngEnd)/2 + perpX*curveFactor;
      const steps = 24;
      const pts = [];
      for(let i=0;i<=steps;i++){
        const t = i/steps; // quadratic bezier
        const oneMinus = 1-t;
        const lat = oneMinus*oneMinus*latStart + 2*oneMinus*t*controlLat + t*t*latEnd;
        const lng = oneMinus*oneMinus*lngStart + 2*oneMinus*t*controlLng + t*t*lngEnd;
        pts.push([lat,lng]);
      }
      // Animated dashed arc (continuous)
      L.polyline(pts, {color: isDrone? '#00b3ff':'#ff784e', weight:2.2, opacity:0.8, className:'traj-arc'+(isDrone?' drone':'')}).addTo(markerLayer);
      // Fading thicker tail (static path that fades out)
      L.polyline(pts, {color: isDrone? '#41c9ff':'#ff9d7b', weight:3.4, opacity:0.5, className:'traj-tail'+(isDrone?' drone':'')}).addTo(markerLayer);
    }
    
    // --- Shahed course visualization ---
    function addShahedCourseVisualization(p) {
      const { course_source, course_target, course_direction, course_type, trajectory } = p;
      
      // Priority 1: Use explicit trajectory coordinates if available
      if (trajectory && trajectory.start && trajectory.end) {
        const [startLat, startLng] = trajectory.start;
        const [endLat, endLng] = trajectory.end;
        
        // Draw trajectory line
        const trajectoryLine = L.polyline([
          [startLat, startLng],
          [endLat, endLng]
        ], {
          color: '#00d4ff',
          weight: 4,
          opacity: 0.85,
          dashArray: '10 6',
          className: 'multi-region-trajectory'
        }).addTo(markerLayer);
        
        // Add direction arrow
        const angle = Math.atan2(endLat - startLat, endLng - startLng) * 180 / Math.PI + 90;
        const arrowIcon = L.divIcon({
          html: `<div class="trajectory-arrow" style="transform: rotate(${angle}deg);">
                   <svg width="36" height="36" viewBox="0 0 36 36">
                     <path d="M 18 5 L 27 18 L 18 15 L 9 18 Z" 
                           fill="#00d4ff" 
                           stroke="#ffffff" 
                           stroke-width="2" 
                           opacity="0.9"/>
                   </svg>
                 </div>`,
          className: '',
          iconSize: [36, 36],
          iconAnchor: [18, 18]
        });
        L.marker([endLat, endLng], {icon: arrowIcon, interactive: false}).addTo(markerLayer);
        
        // Add source/target labels if available
        if (trajectory.source) {
          const sourceLabel = L.divIcon({
            html: `<div style="background:rgba(0,212,255,0.2);border:2px solid #00d4ff;padding:4px 8px;border-radius:8px;font-size:0.7rem;font-weight:700;color:#00d4ff;white-space:nowrap;">${trajectory.source}</div>`,
            className: '',
            iconSize: [1, 1],
            iconAnchor: [0, 0]
          });
          L.marker([startLat, startLng], {icon: sourceLabel, interactive: false}).addTo(markerLayer);
        }
        if (trajectory.target) {
          const targetLabel = L.divIcon({
            html: `<div style="background:rgba(0,212,255,0.2);border:2px solid #00d4ff;padding:4px 8px;border-radius:8px;font-size:0.7rem;font-weight:700;color:#00d4ff;white-space:nowrap;">‚Üí ${trajectory.target}</div>`,
            className: '',
            iconSize: [1, 1],
            iconAnchor: [0, 0]
          });
          L.marker([endLat, endLng], {icon: targetLabel, interactive: false}).addTo(markerLayer);
        }
        return;
      }
      
      // Priority 2: If we have specific source and target cities, try to draw a path between them
      if (course_source && course_target) {
        // This would require city coordinates lookup on frontend
        // For now, we'll use the direction information
        addCourseDirectionIndicator(p, course_direction || '–Ω–∞ ' + course_target);
        return;
      }
      
      // If we have course direction, show it
      if (course_direction) {
        addCourseDirectionIndicator(p, course_direction);
        return;
      }
      
      // If we have target city, show direction arrow pointing roughly toward it
      if (course_target) {
        addCourseDirectionIndicator(p, '–Ω–∞ ' + course_target);
        return;
      }
    }
    
    // --- Course direction indicator for Shahed threats ---
    function addCourseDirectionIndicator(p, directionText) {
      const lat = p.lat, lng = p.lng;
      let dx = 0, dy = 0;
      
      // Parse direction from text
      const dir = directionText.toLowerCase();
      
      // Extract city name if format is "–Ω–∞ [city]"
      const cityMatch = dir.match(/–Ω–∞\s+([–∞-—è—ñ—ó—î“ëa-z\s\-']+)/);
      if (cityMatch) {
        const cityName = cityMatch[1].trim();
        
        // Simple heuristic direction mapping based on well-known cities
        const cityDirections = {
          '–∫–∏—ó–≤': {dx: 0.4, dy: 0.6},
          '—Ö–∞—Ä–∫—ñ–≤': {dx: 0.7, dy: 0.2},
          '–¥–Ω—ñ–ø—Ä–æ': {dx: 0.5, dy: -0.1},
          '–æ–¥–µ—Å–∞': {dx: -0.3, dy: -0.5},
          '–ª—å–≤—ñ–≤': {dx: -0.8, dy: 0.3},
          '—á–µ—Ä–Ω—ñ–≥—ñ–≤': {dx: 0.2, dy: 0.8},
          '—Å—É–º–∏': {dx: 0.6, dy: 0.5},
          '–ø–æ–ª—Ç–∞–≤–∞': {dx: 0.5, dy: 0.3},
          '–∫—Ä–µ–º–µ–Ω—á—É–∫': {dx: 0.3, dy: 0.1},
          '—á–µ—Ä–∫–∞—Å–∏': {dx: 0.2, dy: 0.2}
        };
        
        // Find matching city
        for (const [city, coords] of Object.entries(cityDirections)) {
          if (cityName.includes(city)) {
            dx = coords.dx;
            dy = coords.dy;
            break;
          }
        }
      }
      
      // Fallback to cardinal directions if no city match
      if (dx === 0 && dy === 0) {
        if (dir.includes('–ø—ñ–≤–Ω—ñ—á')) dy = 0.5;
        if (dir.includes('–ø—ñ–≤–¥–µ–Ω—å') || dir.includes('–ø—ñ–≤–¥–µ–Ω')) dy = -0.5;
        if (dir.includes('—Å—Ö—ñ–¥')) dx = 0.5;
        if (dir.includes('–∑–∞—Ö—ñ–¥')) dx = -0.5;
        
        // Compound directions
        if (dir.includes('–ø—ñ–≤–Ω—ñ—á–Ω–æ-—Å—Ö—ñ–¥') || dir.includes('–ø—ñ–≤–Ω—ñ—á–Ω–∏–π —Å—Ö—ñ–¥')) {
          dx = 0.35; dy = 0.35;
        } else if (dir.includes('–ø—ñ–≤–Ω—ñ—á–Ω–æ-–∑–∞—Ö—ñ–¥') || dir.includes('–ø—ñ–≤–Ω—ñ—á–Ω–∏–π –∑–∞—Ö—ñ–¥')) {
          dx = -0.35; dy = 0.35;
        } else if (dir.includes('–ø—ñ–≤–¥–µ–Ω–Ω–æ-—Å—Ö—ñ–¥') || dir.includes('–ø—ñ–≤–¥–µ–Ω–Ω–∏–π —Å—Ö—ñ–¥')) {
          dx = 0.35; dy = -0.35;
        } else if (dir.includes('po≈Çudniowo-zach√≥d') || dir.includes('–ø—ñ–≤–¥–µ–Ω–Ω–∏–π –∑–∞—Ö—ñ–¥')) {
          dx = -0.35; dy = -0.35;
        }
      }
      
      // Create course line if we have direction
      if (dx !== 0 || dy !== 0) {
        const startLat = lat - dy * 0.3;
        const startLng = lng - dx * 0.3;
        const endLat = lat + dy * 0.8;
        const endLng = lng + dx * 0.8;
        
        // Course line
        const courseLine = L.polyline([
          [startLat, startLng],
          [lat, lng],
          [endLat, endLng]
        ], {
          color: '#00d4ff',
          weight: 3,
          opacity: 0.8,
          dashArray: '8 4',
          className: 'shahed-course-line'
        }).addTo(markerLayer);
        
        // Direction arrow at the end
        const arrowSize = 0.1;
        const arrowPoints = [
          [endLat, endLng],
          [endLat - dy * arrowSize + dx * arrowSize * 0.5, endLng - dx * arrowSize - dy * arrowSize * 0.5],
          [endLat - dy * arrowSize - dx * arrowSize * 0.5, endLng - dx * arrowSize + dy * arrowSize * 0.5]
        ];
        
        L.polyline(arrowPoints, {
          color: '#00d4ff',
          weight: 3,
          opacity: 0.9,
          className: 'shahed-course-arrow'
        }).addTo(markerLayer);
        
        // Add course info to popup if it exists
        setTimeout(() => {
          const courseInfo = `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333;">
            <strong>üéØ –ö—É—Ä—Å:</strong> ${directionText}
          </div>`;
          
          // Try to add to existing popup content
          if (p._popup && p._popup.getContent) {
            const existingContent = p._popup.getContent();
            p._popup.setContent(existingContent + courseInfo);
          }
        }, 100);
      }
    }
    // --- KAB rotating scan line (single per map instance concurrently) ---
    function addKabRotor(lat, lng, radiusKm){
      // Access overlay pane SVG
      const pane = document.querySelector('.leaflet-overlay-pane svg');
      if(!pane) return;
      // Gradient for tail if not present
      let defs = pane.querySelector('defs');
      if(!defs){ defs=document.createElementNS('http://www.w3.org/2000/svg','defs'); pane.insertBefore(defs,pane.firstChild); }
      if(!pane.querySelector('#kabRotorGrad')){
        const lg=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
        lg.id='kabRotorGrad'; lg.setAttribute('x1','0%'); lg.setAttribute('y1','50%'); lg.setAttribute('x2','100%'); lg.setAttribute('y2','50%');
        [['0%','rgba(255,224,220,0)'],['35%','rgba(255,224,220,0.05)'],['65%','rgba(255,150,130,0.55)'],['100%','rgba(255,120,100,0.95)']].forEach(([o,c])=>{ const st=document.createElementNS('http://www.w3.org/2000/svg','stop'); st.setAttribute('offset',o); st.setAttribute('stop-color',c); lg.appendChild(st); });
        defs.appendChild(lg);
      }
      // Build a group with a short line from center to arc
      const g=document.createElementNS('http://www.w3.org/2000/svg','g');
      g.setAttribute('class','kab-rotor-group');
      // Convert lat/lng to projected points using Leaflet internal projection
      const mapPointCenter = map.latLngToLayerPoint([lat,lng]);
      // pick an initial angle (random for slight variation)
      const angle = Math.random()*Math.PI*2;
      const edgeLatLng = destinationPoint(lat,lng,angle,radiusKm);
      const edgePoint = map.latLngToLayerPoint(edgeLatLng);
      const line=document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1',mapPointCenter.x); line.setAttribute('y1',mapPointCenter.y);
      line.setAttribute('x2',edgePoint.x); line.setAttribute('y2',edgePoint.y);
      line.setAttribute('class','kab-rotor-line');
      // Tail (shorter) offset slightly behind main line
      const tail=document.createElementNS('http://www.w3.org/2000/svg','line');
      tail.setAttribute('x1',mapPointCenter.x); tail.setAttribute('y1',mapPointCenter.y);
      tail.setAttribute('x2', (mapPointCenter.x+edgePoint.x)/2); tail.setAttribute('y2',(mapPointCenter.y+edgePoint.y)/2);
      tail.setAttribute('class','kab-rotor-tail');
      g.appendChild(tail); g.appendChild(line); pane.appendChild(g);
      // Recenter transform origin to center (SVG group rotates around 0,0 with applied translate)
      g.style.transformOrigin = `${mapPointCenter.x}px ${mapPointCenter.y}px`;
      // Helper to update geometry on zoom/pan
      function refresh(){
        const centerP = map.latLngToLayerPoint([lat,lng]);
        const edgeLatLng2 = destinationPoint(lat,lng,angle, radiusKm);
        const edgeP = map.latLngToLayerPoint(edgeLatLng2);
        line.setAttribute('x1',centerP.x); line.setAttribute('y1',centerP.y);
        line.setAttribute('x2',edgeP.x); line.setAttribute('y2',edgeP.y);
        tail.setAttribute('x1',centerP.x); tail.setAttribute('y1',centerP.y);
        tail.setAttribute('x2',(centerP.x+edgeP.x)/2); tail.setAttribute('y2',(centerP.y+edgeP.y)/2);
        g.style.transformOrigin = `${centerP.x}px ${centerP.y}px`;
      }
      map.on('zoom move', refresh);
      // Cleanup when layer group cleared
      if(markerLayer){ markerLayer.on('remove', ()=>{ try{ g.remove(); }catch(e){} map.off('zoom',refresh); map.off('move',refresh); }); }
    }
    function destinationPoint(lat,lng,bearingRad,distKm){
      const R=6371; const Œ¥=distKm/R; const œÜ1=lat*Math.PI/180; const Œª1=lng*Math.PI/180; const Œ∏=bearingRad; const sinœÜ1=Math.sin(œÜ1), cosœÜ1=Math.cos(œÜ1), sinŒ¥=Math.sin(Œ¥), cosŒ¥=Math.cos(Œ¥); const sinœÜ2 = sinœÜ1*cosŒ¥ + cosœÜ1*sinŒ¥*Math.cos(Œ∏); const œÜ2 = Math.asin(sinœÜ2); const y = Math.sin(Œ∏)*sinŒ¥*cosœÜ1; const x = cosŒ¥ - sinœÜ1*sinœÜ2; const Œª2 = Œª1 + Math.atan2(y,x); return [ (œÜ2*180/Math.PI), ((Œª2*180/Math.PI)+540)%360-180 ]; }
    function updateEventList(points) {
      const el = document.getElementById('eventList');
      if (!el) return;
      if (!points || !points.length) {
        el.innerHTML = '<div style="color:#94a3b8;padding:2rem;text-align:center;font-size:1.1rem;">üì≠ –ü–æ–¥—ñ–π –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
        return;
      }
      
      // Gradient colors for different event types
      const gradients = {
        'shahed': 'linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05))',
        'rocket': 'linear-gradient(135deg, rgba(251, 146, 60, 0.15), rgba(251, 146, 60, 0.05))',
        'avia': 'linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05))',
        'artillery': 'linear-gradient(135deg, rgba(234, 179, 8, 0.15), rgba(234, 179, 8, 0.05))',
        'fpv': 'linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(168, 85, 247, 0.05))',
        'alarm_cancel': 'linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05))',
        'default': 'linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05))'
      };
      
      const borderColors = {
        'shahed': 'rgba(239, 68, 68, 0.3)',
        'rocket': 'rgba(251, 146, 60, 0.3)',
        'avia': 'rgba(245, 158, 11, 0.3)',
        'artillery': 'rgba(234, 179, 8, 0.3)',
        'fpv': 'rgba(168, 85, 247, 0.3)',
        'alarm_cancel': 'rgba(16, 185, 129, 0.3)',
        'default': 'rgba(59, 130, 246, 0.3)'
      };
      
      el.innerHTML = points.slice(0, 20).map(ev => {
        let iconUrl = ICONS[ev.threat_type] || ICONS.default;
        if (ev.marker_icon) {
          if (ev.marker_icon.startsWith('http') || ev.marker_icon.startsWith('/')) {
            iconUrl = ev.marker_icon;
          } else {
            iconUrl = '/static/' + ev.marker_icon;
          }
        }
        if (isFPVThreat(ev.place, ev.text, ev.threat_type)) {
          iconUrl = ICONS.fpv || iconUrl;
        }
        
        const isCancel = ev.threat_type === 'alarm_cancel';
        const placeLine = (ev.place && !isCancel) ? `<b style="color: #60a5fa;">${translatePlace(ev.place)}</b><br>` : '';
        // Use emoji icon instead of SVG
        const iconEmoji = ev.threat_type === 'shahed' ? 'üõ∏' : ev.threat_type === 'rocket' ? 'üöÄ' : ev.threat_type === 'avia' ? '‚úàÔ∏è' : ev.threat_type === 'artillery' ? 'üí•' : '‚ö†Ô∏è';
        const gradient = gradients[ev.threat_type] || gradients.default;
        const borderColor = borderColors[ev.threat_type] || borderColors.default;
        
        return `<div class='event' style="background: ${gradient}; padding: 1.5rem; border-radius: 1rem; border: 2px solid ${borderColor}; position: relative; overflow: hidden; transition: all 0.4s; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
          <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: radial-gradient(circle, ${borderColor.replace('0.3', '0.15')}, transparent); border-radius: 50%; transform: translate(30%, -30%);"></div>
          <div style="display: flex; gap: 1.25rem; align-items: flex-start; position: relative; z-index: 1;">
            <div class='event-icon' style="flex-shrink: 0; width: 3rem; height: 3rem; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.1); border-radius: 0.75rem; padding: 0.5rem; font-size: 1.5rem;">
              ${iconEmoji}
            </div>
            <div class='event-info' style="flex: 1; color: #cbd5e1; font-size: 1.05rem; line-height: 1.6;">
              ${placeLine}
              ${cleanMessage(ev.text||'')}
              <div class='event-time' style="margin-top: 0.75rem; color: #94a3b8; font-size: 0.9rem; font-weight: 500;">‚è∞ ${ev.date || ''}</div>
            </div>
          </div>
        </div>`;
      }).join('');
    }
    
    // --- Darken all non-Ukraine territory (dynamic mask loading precise border if available) ---
    let worldMaskLayer = null;
    async function initWorldMask(){
      const worldRing = [ [85,-180],[85,180],[-85,180],[-85,-180] ];
      // Fallback simplified Ukraine ring (used until precise GeoJSON loads)
      const fallbackRing = [
        [52.37,23.60],[51.90,23.60],[51.90,24.00],[51.50,24.50],[51.90,25.30],
        [51.90,26.00],[51.60,26.60],[51.50,27.50],[51.60,28.20],[51.30,29.20],
        [51.60,30.60],[52.30,31.80],[52.10,32.70],[52.40,34.40],[52.30,35.90],
        [52.00,37.40],[51.20,38.20],[50.30,39.70],[49.10,40.10],[48.30,39.70],
        [47.10,38.50],[46.00,38.20],[45.35,37.40],[45.40,36.60],[45.20,34.90],
        [45.35,33.30],[46.07,30.95],[46.58,30.06],[47.80,29.48],[48.37,28.05],
        [48.47,27.53],[48.27,26.86],[47.74,26.63],[47.85,24.96],[48.15,23.53],
        [48.62,22.57],[49.90,22.09],[51.94,22.93],[52.37,23.60]
      ];
      
      function drawMask(rings){
        if(worldMaskLayer){ 
          map.removeLayer(worldMaskLayer); 
          worldMaskLayer = null; 
        }
        
        // –°—Ç–≤–æ—Ä—é—î–º–æ polygon –∑ –¥—ñ—Ä–∫–∞–º–∏ (world - ukraine = mask)
        worldMaskLayer = L.polygon([worldRing, ...rings], {
          stroke: false,
          fill: true,
          fillColor: '#1a2332',
          fillOpacity: 1.0,
          interactive: false,
          pane: 'overlayPane'
        }).addTo(map);
        
        // –ü–µ—Ä–µ–º—ñ—â—É—î–º–æ –Ω–∞ –∑–∞–¥–Ω—ñ–π –ø–ª–∞–Ω
        if (worldMaskLayer._path) {
          worldMaskLayer._path.style.pointerEvents = 'none';
        }
      }
      
      // Try precise GeoJSON (place file at /static/ukraine_border.geojson)
      try {
        const resp = await fetch('/static/geoBoundaries-UKR-ADM0_simplified.geojson');
        if(resp.ok){
          const gj = await resp.json();
          // Expect first feature Polygon or MultiPolygon in lon/lat
          const feats = (gj.features||[]);
          if(feats.length){
            const geom = feats[0].geometry;
            let rings=[];
            if(geom.type==='Polygon'){
              // –ë–µ—Ä—ë–º –≤—Å–µ –∫–æ–ª—å—Ü–∞ –ø–æ–ª–∏–≥–æ–Ω–∞
              rings = geom.coordinates.map(r=> r.map(([lng,lat])=>[lat,lng]));
            } else if(geom.type==='MultiPolygon'){
              // –î–ª—è MultiPolygon –±–µ—Ä—ë–º –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–æ–ª—å—Ü–∞
              rings = geom.coordinates.map(poly=> poly[0].map(([lng,lat])=>[lat,lng]));
            }
            if(rings.length){
              // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –∫–æ–ª—å—Ü–∞ –¥–ª—è —Ç–æ—á–Ω–æ–π –≥—Ä–∞–Ω–∏—Ü—ã
              drawMask(rings);
            }
          }
        } else {
          // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ—á–Ω—É—é –≥—Ä–∞–Ω–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
          console.warn('Failed to load precise border, using fallback');
          drawMask([fallbackRing]);
        }
      } catch(e){ 
        console.warn('Precise border load failed, using fallback ring', e);
        drawMask([fallbackRing]);
      }
    }
    
    async function initMap() {
      const isDarkTheme = localStorage.getItem('mapTheme') === 'dark';
      
      console.log('Initializing Leaflet with OpenStreetMap');
      
      try {
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Leaflet –∑ OpenStreetMap
        map = L.map('map', {
          center: [48.3794, 31.1656], // lat, lng
          zoom: 6,
          zoomControl: false,
          attributionControl: true
        });
        
        // –î–æ–¥–∞—î–º–æ OpenStreetMap tile layer
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors',
          maxZoom: 19,
          className: isDarkTheme ? 'dark-tiles' : ''
        }).addTo(map);
        
        // –î–æ–¥–∞—î–º–æ zoom –∫–æ–Ω—Ç—Ä–æ–ª
        L.control.zoom({
          position: 'topright',
          zoomInTitle: '–ó–±—ñ–ª—å—à–∏—Ç–∏',
          zoomOutTitle: '–ó–º–µ–Ω—à–∏—Ç–∏'
        }).addTo(map);
        
        // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        map.on('tileerror', (e) => {
          console.error('Leaflet tile error:', e);
        });
        
        // –õ–æ–≥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        map.whenReady(() => {
          console.log('Leaflet loaded successfully');
          // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –º–∞—Å–∫—É —Å–≤—ñ—Ç—É
          setTimeout(() => {
            if (typeof initWorldMask === 'function') {
              initWorldMask();
            }
          }, 100);
        });
        
      } catch (error) {
        console.error('Failed to initialize MapLibre GL:', error);
        // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
        const mapContainer = document.getElementById('map');
        if (mapContainer) {
          mapContainer.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #0f172a; color: #e2e8f0; font-family: Inter, sans-serif;">
              <div style="text-align: center; padding: 2rem;">
                <h2 style="color: #ef4444; margin-bottom: 1rem;">‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏</h2>
                <p style="margin-bottom: 1rem;">–ù–µ –≤–¥–∞–ª–æ—Å—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ MapLibre GL</p>
                <button onclick="location.reload()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; cursor: pointer; font-size: 1rem;">
                  üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É
                </button>
              </div>
            </div>
          `;
        }
        return;
      }
      
      // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø—Ä–∏–º—É—Å–æ–≤–æ–≥–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏ –Ω–∞ –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö —à–∞—Ä–∞—Ö
      const forceUkrainianLabels = () => {
        try {
          const style = map.getStyle();
          if (!style || !style.layers) return;
          
          style.layers.forEach(layer => {
            if (layer.type === 'symbol' && layer.layout && layer.layout['text-field']) {
              // –ó–º—ñ–Ω—é—î–º–æ text-field –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è name:uk
            const textField = layer.layout['text-field'];
            
            if (typeof textField === 'string') {
              // –ó–∞–º—ñ–Ω—é—î–º–æ –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞–∑–≤ –Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫—É
              let newField = textField;
              newField = newField.replace(/\{name:latin\}/g, '{name:uk}');
              newField = newField.replace(/\{name:en\}/g, '{name:uk}');
              newField = newField.replace(/\{name_en\}/g, '{name:uk}');
              newField = newField.replace(/\{name_int\}/g, '{name:uk}');
              newField = newField.replace(/\{name\}/g, '{name:uk}');
              if (newField !== textField) {
                map.setLayoutProperty(layer.id, 'text-field', newField);
              }
            } else if (Array.isArray(textField)) {
              // –î–ª—è expressions –∑–∞–º—ñ–Ω—é—î–º–æ –≤—Å—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –Ω–∞ "name:uk"
              let jsonStr = JSON.stringify(textField);
              jsonStr = jsonStr.replace(/"name:latin"/g, '"name:uk"');
              jsonStr = jsonStr.replace(/"name:en"/g, '"name:uk"');
              jsonStr = jsonStr.replace(/"name_en"/g, '"name:uk"');
              jsonStr = jsonStr.replace(/"name_int"/g, '"name:uk"');
              jsonStr = jsonStr.replace(/"name"/g, '"name:uk"');
              const newField = JSON.parse(jsonStr);
              map.setLayoutProperty(layer.id, 'text-field', newField);
            }
          }
        });
        } catch (e) {
          console.warn('Error setting Ukrainian labels:', e);
        }
      };
      
      // OSM tiles don't need label forcing
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–µ–º–∏
      window.currentMapStyle = isDarkTheme ? 'dark' : 'light';
      
      window.switchMapTheme = () => {
        const newTheme = window.currentMapStyle === 'light' ? 'dark' : 'light';
        window.currentMapStyle = newTheme;
        localStorage.setItem('mapTheme', newTheme);
        
        // –î–ª—è Leaflet –ø—Ä–æ—Å—Ç–æ –∑–º—ñ–Ω—é—î–º–æ CSS —Ñ—ñ–ª—å—Ç—Ä –¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏
        const tileLayer = map._layers[Object.keys(map._layers)[0]];
        if (tileLayer && tileLayer._container) {
          if (newTheme === 'dark') {
            tileLayer._container.classList.add('dark-tiles');
          } else {
            tileLayer._container.classList.remove('dark-tiles');
          }
        }
        
        // –û–Ω–æ–≤–ª—é—î–º–æ –º–∞—Ä–∫–µ—Ä–∏
        setTimeout(() => {
          requestMarkerUpdate({ force: true });
          // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –º–∞—Å–∫—É —Å–≤—ñ—Ç—É
          if (typeof initWorldMask === 'function') {
            initWorldMask();
          }
        }, 100);
        
        updateMapThemeIcon(newTheme === 'dark');
      };
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–µ–π —Ç–µ–º–æ–π
      updateMapThemeIcon(isDarkTheme);
      
      // Map is ready for use - using native Leaflet (no emulator needed)
      
      // –î–æ–¥–∞—î–º–æ CSS –¥–ª—è Leaflet –º–∞—Ä–∫–µ—Ä—ñ–≤
      const markerStyle = document.createElement('style');
      markerStyle.textContent = `
        .custom-div-icon {
          background: transparent;
          border: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è popup */
        .leaflet-popup-content-wrapper,
        .leaflet-popup-content {
          background: transparent !important;
          padding: 0 !important;
          box-shadow: none !important;
          border: none !important;
          border-radius: 0 !important;
          max-width: 380px !important;
        }
        
        .leaflet-popup-tip {
          display: none !important;
        }
        
        .leaflet-popup-close-button {
          display: none !important;
        }
        
        /* –¢–µ–º–Ω–∞ —Ç–µ–º–∞ –¥–ª—è —Ç–∞–π–ª—ñ–≤ */
        .dark-tiles {
          filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%);
        }
      `;
      document.head.appendChild(markerStyle);
      
      // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –º–µ—Å—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
      // --- Place search wiring ---
      const psWrap = document.getElementById('placeSearch');
      const psInput = document.getElementById('placeSearchInput');
      const psBtn = document.getElementById('placeSearchBtn');
      const psSuggest = document.getElementById('placeSearchSuggest');
      let psHistory = JSON.parse(localStorage.getItem('ps_history')||'[]');
      let psActiveIndex = -1; // keyboard navigation index
      const psCache = {}; // prefix -> matches cache
      function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }
      function persistHistory(){ localStorage.setItem('ps_history', JSON.stringify(psHistory.slice(0,25))); }
      function showSuggest(list){
        if(!psSuggest) return;
        if(!list || !list.length){ psSuggest.innerHTML = '<div class="ps-empty">–ù–µ–º–∞—î –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤</div>'; psSuggest.style.display='block'; return; }
        psSuggest.innerHTML = list.map((n,i)=>`<div class='ps-item${i===psActiveIndex?' active':''}' data-name='${n}'>${n}<span style='opacity:.45;'>‚åñ</span></div>`).join('');
        psSuggest.style.display='block';
      }
      function hideSuggest(){ if(psSuggest) psSuggest.style.display='none'; }
      function addHistory(name){ name = name.trim(); if(!name) return; psHistory = [name, ...psHistory.filter(n=>n!==name)]; persistHistory(); }
      function highlightNext(delta){
        if(!psSuggest || psSuggest.style.display!=='block') return;
        const items = [...psSuggest.querySelectorAll('.ps-item')];
        if(!items.length) return;
        psActiveIndex = (psActiveIndex + delta + items.length) % items.length;
        items.forEach((el,i)=> el.classList.toggle('active', i===psActiveIndex));
      }
      async function locate(query){
        if(!query) return;
        psWrap?.classList.add('loading');
        try {
          const r = await fetch(`/locate?q=${encodeURIComponent(query)}`);
          const j = await r.json();
          if(j.status==='ok'){
            addHistory(j.name);
            map.setView([j.lat,j.lng], Math.max(map.getZoom(), 9), { animate:true });
            // flash circle
            const circle = L.circle([j.lat,j.lng], { radius: 9000, color:'#3b82f6', weight:2, fillColor:'#2563eb', fillOpacity:0.15 });
            circle.addTo(map);
            setTimeout(()=>{ circle.setStyle({opacity:0, fillOpacity:0}); setTimeout(()=>{ try{map.removeLayer(circle);}catch(e){} }, 650); }, 1600);
          } else if(j.status==='suggest' && Array.isArray(j.matches)) {
            showSuggest(j.matches.map(n=> n));
          } else {
            // show not found suggestion with history fallback
            showSuggest(psHistory.slice(0,6));
          }
        } catch(e){ showSuggest(psHistory.slice(0,6)); }
        finally { psWrap?.classList.remove('loading'); }
      }
      async function fetchBackendSuggest(prefix){
        const p = prefix.toLowerCase();
        if(psCache[p]) return psCache[p];
        try {
          const r = await fetch(`/locate?q=${encodeURIComponent(p)}`);
          const j = await r.json();
          if(j.status==='suggest'){
            psCache[p] = j.matches || [];
            return psCache[p];
          }
        } catch(e){}
        psCache[p] = [];
        return [];
      }
      if(psBtn){ psBtn.addEventListener('click', ()=> locate(psInput.value.trim())); }
      if(psInput){
        psInput.addEventListener('keydown', e=>{
          if(e.key==='ArrowDown'){ highlightNext(1); e.preventDefault(); }
          else if(e.key==='ArrowUp'){ highlightNext(-1); e.preventDefault(); }
          else if(e.key==='Enter'){
            e.preventDefault();
            const active = psSuggest && psSuggest.querySelector('.ps-item.active');
            if(active){ const name = active.getAttribute('data-name'); psInput.value = name; hideSuggest(); locate(name); }
            else { locate(psInput.value.trim()); hideSuggest(); }
          } else if(e.key==='Escape'){ hideSuggest(); }
        });
        psInput.addEventListener('input', debounce(async ()=>{
          const vRaw = psInput.value.trim();
          const v = vRaw.toLowerCase();
          psActiveIndex = -1;
          if(!v){ hideSuggest(); return; }
          // Local fuzzy from markers + history
          const set = new Set();
          for(const m of (window.__lastPoints||[])){
            const place = (m.place||'').trim(); if(!place) continue; const norm = place.toLowerCase();
            if(norm.includes(v)) set.add(place);
            if(set.size>=25) break;
          }
          psHistory.filter(h=>h.toLowerCase().includes(v)).forEach(h=> set.add(h));
          let list = [...set];
          // Backend suggestions (prefix) merge - always query backend for comprehensive search
          if(v.length>=1){
            const backend = await fetchBackendSuggest(v);
            for(const name of backend){ if(!list.includes(name)) list.push(name); if(list.length>=40) break; }
          }
          if(list.length){ showSuggest(list.slice(0,30)); } else hideSuggest();
        }, 180));
      }
      if(psSuggest){
        psSuggest.addEventListener('click', e=>{
          const div = e.target.closest('.ps-item'); if(!div) return; const name = div.getAttribute('data-name');
          psInput.value = name; hideSuggest(); locate(name);
        });
      }
      document.addEventListener('click', e=>{ if(!psWrap.contains(e.target)) hideSuggest(); });
      
      // ---- Presence (active users) ----
      const uid = localStorage.getItem('presence_id') || (self.crypto?.randomUUID ? crypto.randomUUID() : (Date.now()+""+Math.random()).replace(/\D/g,''));
      localStorage.setItem('presence_id', uid);

      const totalTargets = document.querySelectorAll('[data-role="live-total"]');
      const webTargets = document.querySelectorAll('[data-role="live-web"]');
      const appTargets = document.querySelectorAll('[data-role="live-apps"]');
      const androidTargets = document.querySelectorAll('[data-role="live-android"]');
      const iosTargets = document.querySelectorAll('[data-role="live-ios"]');

      const formatNumber = (value) => Number(value || 0).toLocaleString('uk-UA');
      const animateUpdate = (node) => {
        node.classList.add('updating');
        setTimeout(() => node.classList.remove('updating'), 600);
      };

      const updateNodes = (nodes, value, formatter = formatNumber) => {
        nodes.forEach(node => {
          const nextValue = formatter(value);
          if (node.textContent === nextValue) return;
          animateUpdate(node);
          node.textContent = nextValue;
        });
      };
      async function pingPresence(){
        console.log('pingPresence: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ /presence...');
        try {
          const r = await fetch('/presence', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
              id:uid, 
              platform:'web',
              nickname: window.neptunNickname || null
            })
          });
          console.log('pingPresence: –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç, —Å—Ç–∞—Ç—É—Å:', r.status);
          const j = await r.json();
          console.log('pingPresence: –¥–∞–Ω–Ω—ã–µ:', j);
          if(j.status === 'blocked'){
            // Show overlay and stop further updates
            const ov = document.createElement('div');
            ov.style.cssText='position:fixed;inset:0;background:#0a0f1f;display:flex;align-items:center;justify-content:center;z-index:9999;font-family:Inter,sans-serif;color:#fff;padding:2rem;text-align:center;';
            ov.innerHTML='<div style="max-width:480px;">–í–∞—à –¥–æ—Å—Ç—É–ø —Ç–∏–º—á–∞—Å–æ–≤–æ –æ–±–º–µ–∂–µ–Ω–æ.</div>';
            document.body.appendChild(ov);
            return;
          }
          let visitors = (j && typeof j.visitors !== 'undefined') ? j.visitors : undefined;
          if (typeof visitors === 'undefined' || visitors === null) {
            try {
              const hr = await fetch('/health');
              if (hr.ok) {
                const hj = await hr.json();
                if (typeof hj.visitors !== 'undefined') visitors = hj.visitors;
              }
            } catch(e) { /* ignore */ }
          }
          if(typeof visitors !== 'undefined'){
            const platforms = j.platforms || {};
            const androidCount = platforms.android ?? 0;
            const iosCount = platforms.ios ?? 0;
            const webCount = platforms.web ?? 0;
            const appsCount = (typeof j.apps === 'number') ? j.apps : (androidCount + iosCount);

            updateNodes(totalTargets, visitors);
            updateNodes(webTargets, webCount);
            updateNodes(appTargets, appsCount);
            updateNodes(androidTargets, androidCount);
            updateNodes(iosTargets, iosCount);
          }
        } catch(e){
          console.error('pingPresence: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö:', e);
        }
      }
      pingPresence();
  setInterval(pingPresence, 120000); // Increased from 30s to 120s for FPS optimization

  // Check for force reload flag from admin
  async function checkForceReload() {
    try {
      const response = await fetch('/api/force-reload-status');
      const data = await response.json();
      if (data.reload) {
        console.log('üîÑ Admin triggered force reload - reloading page...');
        // Small delay to allow logs
        setTimeout(() => {
          window.location.reload(true);
        }, 500);
      }
    } catch(e) {
      // Silent fail - don't spam console
    }
  }
  // Check every 30 seconds
  setInterval(checkForceReload, 120000);

      // --- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ alerts.in.ua ---
      let airAlarmLayer = null;
      let ukrBorderLayer = null;
  let raionAlarmLayer = null;
      async function fetchAirAlarms(){
        // External API currently unavailable due to CORS restrictions
        console.log('Air alarm API disabled (CORS/availability issues)');
        return {};
      }
      async function showAirAlarmsOnMap(){
        const regions = await fetchAirAlarms();
        
        // Skip external geo data due to CORS/404 issues
        if (Object.keys(regions).length === 0) {
          console.log('Air alarm visualization disabled (no data available)');
          return;
        }
        
        try {
          const geoRes = await fetch('https://alerts.com.ua/static/geo/ukraine_regions.json');
          const geo = await geoRes.json();
          
          if (airAlarmLayer) { airAlarmLayer.remove(); }
          airAlarmLayer = L.geoJSON(geo, {
           
            style: feature => {
              let code = feature.properties.id || feature.properties.ISO_3166_2;
              if (code) code = code.toUpperCase();
              let alarm = false;
              if (code && regions[code]) alarm = regions[code].alert;
              if (!alarm && code && regions[code.toLowerCase()]) alarm = regions[code.toLowerCase()].alert;
              return {
                color: alarm ? '#d93025' : '#c9d0d6',
              weight: alarm ? 2 : 1,
              fillColor: alarm ? '#ffd54f' : '#f1f3f6',
              fillOpacity: alarm ? 0.5 : 0.15
            };
          }
        }).addTo(map);
        // Draw a clear national border outline (union of all regions)
        try {
          if (turf && geo && geo.features && geo.features.length){
            let unionGeom = null;
            for(const f of geo.features){
              unionGeom = unionGeom ? turf.union(unionGeom, f) : f;
            }
            if (ukrBorderLayer) { ukrBorderLayer.remove(); }
            if (unionGeom){
              // Outer glow effect: two strokes
              const outer = L.geoJSON(unionGeom, { style:{ color:'rgba(17,24,39,0.55)', weight:8, opacity:0.7, fill:false } });
              const inner = L.geoJSON(unionGeom, { style:{ color:'#111827', weight:3, opacity:0.95, fill:false } });
              ukrBorderLayer = L.layerGroup([outer, inner]).addTo(map);
              ukrBorderLayer.bringToFront();
            }
          }
        } catch(e){}
        } catch(geoError) {
          console.warn('Air alarm geo data unavailable:', geoError.message);
        }
      }
      // Air alarm overlay disabled due to CORS/API availability issues
      // showAirAlarmsOnMap();
      // setInterval(showAirAlarmsOnMap, 20000);

      // ---- Dynamic raion alarm overlay (district-level) ----
      async function fetchRaionAlarms(){
        try { const r = await fetch('/raion_alarms'); return (await r.json()).alarms || []; } catch(e){ return []; }
      }
      async function updateRaionAlarms(){
        const alarms = await fetchRaionAlarms();
        if (raionAlarmLayer){ raionAlarmLayer.remove(); raionAlarmLayer = null; }
        if(!alarms.length) return;
        // Build circle-ish polygons (approx) or simple circles since we lack exact raion geometry right now
        const feats = alarms.map(a=>({
          type:'Feature', properties:{ raion:a.raion, place:a.place, since:a.since },
          geometry:{ type:'Point', coordinates:[a.lng, a.lat] }
        }));
        raionAlarmLayer = L.layerGroup();
        feats.forEach(f=>{
          const lat = f.geometry.coordinates[1];
          const lng = f.geometry.coordinates[0];
          // Represent district area with a translucent red circle (radius ~20km) placeholder
            const circle = L.circle([lat,lng], { radius: 20000, color:'#b91c1c', weight:1, fillColor:'#dc2626', fillOpacity:0.2 });
            circle.addTo(raionAlarmLayer);
            circle.bindPopup(`<div style="font-size:1.1rem;padding:6px;line-height:1.4;"><b style="font-size:1.3rem;">${f.properties.place}</b><br><span style="font-size:1rem;">–ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞ (—Ä–∞–π–æ–Ω)</span></div>`);
            // Add animated hatch overlay using a custom divIcon centered
            const Hatch = L.Marker.extend({ options:{ } });
            const hatchSize = 20000; // we adapt via CSS scale after projection
            const hatch = L.marker([lat,lng], { interactive:false, icon: L.divIcon({className:'', html:`<div class='raion-alarm-anim' style='width:300px;height:300px;transform:translate(-50%,-50%);'></div>`}) });
            hatch.addTo(raionAlarmLayer);
            // Adjust size on zoom (approximate meters to pixels)
            function rescale(){
              const pCenter = map.latLngToLayerPoint([lat,lng]);
              const pEdge = map.latLngToLayerPoint([lat + (20000/111320), lng]); // rough lat meter conversion
              const pxRadius = Math.abs(pEdge.y - pCenter.y);
              const el = hatch.getElement()?.querySelector('.raion-alarm-anim');
              if(el){ const d = pxRadius*2; el.style.width=d+'px'; el.style.height=d+'px'; }
            }
            map.on('zoom', rescale); map.on('move', rescale);
            setTimeout(rescale,50);
        });
        raionAlarmLayer.addTo(map);
      }
      updateRaionAlarms();
      setInterval(updateRaionAlarms, 180000); // Increased from 60s to 180s for FPS optimization

      await runMarkerUpdate();
      try {
    const es = new EventSource('/stream');
    const uid2 = localStorage.getItem('presence_id');
    es.onmessage = ev => {
          try {
            const p = JSON.parse(ev.data);
      // Removed requestMarkerUpdate() for FPS optimization - periodic updates are enough
      if (p.control && p.control.type === 'block' && p.control.id && uid2 && p.control.id === uid2) {
               // show block overlay instantly
               const ov = document.createElement('div');
               ov.style.cssText='position:fixed;inset:0;background:#0a0f1f;display:flex;align-items:center;justify-content:center;z-index:9999;font-family:Inter,sans-serif;color:#fff;padding:2rem;text-align:center;';
               ov.innerHTML='<div style="max-width:480px;">–í–∞—à –¥–æ—Å—Ç—É–ø —Ç–∏–º—á–∞—Å–æ–≤–æ –æ–±–º–µ–∂–µ–Ω–æ.</div>';
               document.body.appendChild(ov);
               try { es.close(); } catch(e){}
            }
          } catch(e){}
        };
      } catch(e) {}
      setInterval(()=>requestMarkerUpdate({ force:true }), 30000); // 30s forced update
      // --- Re-cluster markers on zoom (no full data reload) ---
      (function(){
        let zoomRedrawTimer=null; let lastZoom=map.getZoom();
        function onZoomEnd(){
          const z = map.getZoom();
          if(z===lastZoom) return;
          lastZoom = z;
          if(zoomRedrawTimer){ clearTimeout(zoomRedrawTimer); }
          // Only re-cluster existing markers, don't fetch new data
          zoomRedrawTimer = setTimeout(()=>{ 
            try { 
              if(markerLayer && markerLayer.refreshClusters) markerLayer.refreshClusters(); 
            } catch(e){} 
          }, 150);
        }
        map.on('zoomend', onZoomEnd);
      })();
    }
    
  function openWarn(){const o=document.getElementById('warnModal'); if(o) o.style.display='flex';}
  function closeWarn(){const o=document.getElementById('warnModal'); if(o) o.style.display='none';}
  function ackWarn(){ closeWarn(); }
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  function updateTimePeriod() {
    const input = document.getElementById('timePeriodInput');
    const newValue = parseInt(input.value);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (isNaN(newValue) || newValue < 5 || newValue > 360) {
      input.value = 40; // –≤–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é
      return;
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º URL —Å –Ω–æ–≤—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
    const url = new URL(window.location);
    url.searchParams.set('timeRange', newValue);
    window.history.replaceState({}, '', url);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
    console.log('Updating time period to:', newValue, 'minutes');
    requestMarkerUpdate({ force:true });
  }

  let resizeTimeout;
  function toggleMapExpand(){
    const body = document.body;
    const btn = document.getElementById('expandBtn');
    const icon = document.getElementById('expandIcon');
    const mapCard = document.querySelector('.map-card');
    const wasExpanded = body.classList.contains('map-expanded');
    
    // Clear any pending resize to avoid double-processing
    if(resizeTimeout) clearTimeout(resizeTimeout);
    
    if(wasExpanded){
      body.classList.remove('map-expanded');
      if(btn){ btn.title='–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É'; btn.setAttribute('aria-label','–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É'); }
      if(icon){ icon.textContent='fullscreen'; }
      if(mapCard){ mapCard.style.height=''; }
      // Debounced resize
      resizeTimeout = setTimeout(()=>{ if(map){ map.invalidateSize(); } },300);
    } else {
      body.classList.add('map-expanded');
      if(btn){ btn.title='–ó–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É'; btn.setAttribute('aria-label','–ó–≥–æ—Ä–Ω—É—Ç–∏ –∫–∞—Ä—Ç—É'); }
      if(icon){ icon.textContent='fullscreen_exit'; }
      if(mapCard){ mapCard.style.height= window.innerHeight + 'px'; }
      // Debounced resize - removed setView to reduce lag
      resizeTimeout = setTimeout(()=>{ if(map){ map.invalidateSize(); } },300);
    }
  }
  
  // City boundaries toggle functionality
  let regionBoundariesVisible = false;
  let regionBoundariesLayer = null;
  
  function toggleRegionBoundaries() {
    const btn = document.getElementById('regionBoundariesBtn');
    
    // BANDWIDTH OPTIMIZATION: Region boundaries disabled to save 19MB
    console.warn('–ì—Ä–∞–Ω–∏—Ü—ñ —Ä–µ–≥—ñ–æ–Ω—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó —Ç—Ä–∞—Ñ—ñ–∫—É');
    if (btn) btn.style.opacity = '0.5';
    return;
    
    // –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ –æ–±–ª–∞—Å—Ç–µ–π —É–¥–∞–ª–µ–Ω–∞
  }
  
  // Text size toggle functionality
  let largeTextEnabled = false;
  
  function toggleTextSize() {
    // –§—É–Ω–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–º —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ —É–¥–∞–ª–µ–Ω–∞
  }
  
  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∫–æ–Ω–∫–∏ –∫–Ω–æ–ø–∫–∏ —Ç–µ–º—ã (–≥–ª–æ–±–∞–ª—å–Ω–∞—è)
  function updateMapThemeIcon(isDark) {
    const icon = document.getElementById('mapThemeIcon');
    if (icon) {
      icon.textContent = isDark ? 'light_mode' : 'dark_mode';
    }
  }
  
  // Map theme toggle functionality
  function toggleMapTheme() {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è MapLibre GL
    if (typeof window.switchMapTheme === 'function') {
      window.switchMapTheme();
    } else {
      console.error('switchMapTheme function not available');
    }
  }
  

  
  function updateMarkerStyles(isDark) {
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞—Ä—Ç—ã
    const mapContainer = document.getElementById('map');
    if (mapContainer) {
      if (isDark) {
        mapContainer.classList.add('map-dark-theme');
      } else {
        mapContainer.classList.remove('map-dark-theme');
      }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    if (window.markers) {
      window.markers.forEach(marker => {
        if (marker._icon) {
          if (isDark) {
            marker._icon.style.filter = 'drop-shadow(0 0 4px rgba(255,255,255,0.8)) brightness(1.1)';
          } else {
            marker._icon.style.filter = 'drop-shadow(0 0 2px rgba(0,0,0,0.3))';
          }
        }
      });
    }
  }
  
  // Adjust fullscreen height on orientation / resize for mobile
  window.addEventListener('orientationchange', ()=>{ if(document.body.classList.contains('map-expanded')){ const mapCard=document.querySelector('.map-card'); if(mapCard){ mapCard.style.height=window.innerHeight+'px'; if(map){ map.invalidateSize(); } } } });
  window.addEventListener('resize', ()=>{ if(document.body.classList.contains('map-expanded')){ const mapCard=document.querySelector('.map-card'); if(mapCard){ mapCard.style.height=window.innerHeight+'px'; if(map){ map.invalidateSize(); } } } });
  window.onload = () => { 
    // Start optimized icon preloading
    preloadCriticalIcons(); 
    
    // Initialize time period input from URL
    const urlParams = new URLSearchParams(window.location.search);
    const timeRange = parseInt(urlParams.get('timeRange')) || 40;
    const timePeriodInput = document.getElementById('timePeriodInput');
    if (timePeriodInput) {
      timePeriodInput.value = timeRange;
    }
    
    // Initialize map
    initMap(); 
    
    // Show disclaimer
    openWarn(); 
    
    // Start deployment monitoring
    startDeploymentMonitoring();
    
    // Start background preloading after initial load
    preloadRemainingIcons();
  };
  
  // Deployment monitoring system
  let deploymentMonitoringActive = false;
  let deploymentCheckInterval = null;
  let consecutiveFailures = 0;
  
  function startDeploymentMonitoring() {
    // Check server health every 10 seconds
    deploymentCheckInterval = setInterval(checkServerHealth, 180000); // Increased from 60s to 180s for FPS optimization
    deploymentMonitoringActive = true;
    console.log('Deployment monitoring started');
  }
  
  async function checkServerHealth() {
    if (!deploymentMonitoringActive) return;
    
    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
      
      const response = await fetch('/health', {
        method: 'GET',
        signal: controller.signal,
        cache: 'no-cache'
      });
      
      clearTimeout(timeoutId);
      
      if (response.ok) {
        // Server is healthy
        if (consecutiveFailures >= 2) {
          // Server is back online after deployment
          // –ù–µ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ä–∞–∑—É - –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–æ–∫
          hideDeploymentOverlay();
          console.log('Server is back online, transitioning to marker loading');
        }
        consecutiveFailures = 0;
      } else {
        handleServerUnavailable();
      }
    } catch (error) {
      handleServerUnavailable();
    }
  }
  
  function handleServerUnavailable() {
    consecutiveFailures++;
    console.log(`Server check failed (${consecutiveFailures} consecutive failures)`);
    
  if (consecutiveFailures >= 5) {
      // Server appears to be down (likely deploying)
      showDeploymentOverlay();
    }
  }
  
  function showDeploymentOverlay() {
    const overlay = document.getElementById('markerLoadingOverlay');
    const title = overlay?.querySelector('h3');
    const description = overlay?.querySelector('p');
    
    if (overlay && title && description) {
      title.textContent = '–û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏‚Ä¶';
      description.textContent = '–í—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –¥–µ–ø–ª–æ–π –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó NEPTUN. –¶–µ –∑–∞–π–º–µ 1-2 —Ö–≤–∏–ª–∏–Ω–∏. –ü—ñ—Å–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º—ñ—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑\'—è–≤–ª—è—Ç—å—Å—è –Ω–∞ –º–∞–ø—ñ.';
      overlay.classList.remove('hidden');
      console.log('Showing deployment overlay during server update');
    }
  }
  
  function hideDeploymentOverlay() {
    const overlay = document.getElementById('markerLoadingOverlay');
    const title = overlay?.querySelector('h3');
    const description = overlay?.querySelector('p');
    
    if (overlay && title && description) {
      // –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –º–µ—Ç–æ–∫
      title.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ—Ç–æ–∫‚Ä¶';
      description.textContent = '–°–µ—Ä–≤–µ—Ä –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ. –ó–∞—Ä–∞–∑ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –º—ñ—Ç–∫–∏ –Ω–∞ –º–∞–ø—É.';
      
      consecutiveFailures = 0;
      console.log('Server restored, now waiting for markers to load');
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–µ—Ç–æ–∫
      if (typeof updateMarkers === 'function') {
        isInitialLoad = true; // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
        runMarkerUpdate().then(() => {
          // –≠–∫—Ä–∞–Ω –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç –≤ updateMarkers –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–æ–∫
          console.log('Markers loaded after server restoration');
        }).catch(error => {
          console.error('Failed to load markers after server restoration:', error);
          // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–∫ –Ω–µ —É–¥–∞–ª–∞—Å—å, —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω
          overlay.classList.add('hidden');
        });
      } else {
        // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω
        overlay.classList.add('hidden');
      }
    }
  }
  
  // Stop monitoring when page is being unloaded
  window.addEventListener('beforeunload', () => {
    deploymentMonitoringActive = false;
    if (deploymentCheckInterval) {
      clearInterval(deploymentCheckInterval);
    }
  });
    // Smart Mass Attack Banner Logic (wrapped inside same script tag)
    (function(){
      const banner = document.getElementById('massAttackBanner');
      const closeBtn = document.getElementById('maClose');
      const textEl = document.getElementById('maDynamicText');
      const heurEl = document.getElementById('maHeuristics');
      if(!banner) return;

      const LS_KEY = 'maBannerDismissedAt';
      const DISMISS_COOLDOWN_MIN = 90; // minutes user dismissal persists
      const MAX_AGE_MIN = 180; // hide banner if last triggering event older

      function minutesAgo(ts){
        return (Date.now() - ts) / 60000;
      }

      function isDismissedRecent(){
        try{ const raw = localStorage.getItem(LS_KEY); if(!raw) return false; const t = parseInt(raw,10); return minutesAgo(t) < DISMISS_COOLDOWN_MIN; }catch(e){ return false; }
      }

      function markDismissed(){
        try{ localStorage.setItem(LS_KEY, Date.now().toString()); }catch(e){}
      }

      const heuristics = [];
      let freshestTrigger = 0;

      function qualifies(evt){
        if(!evt || !evt.type || !evt.text) return false;
        // Only consider missile / drone / pusk related events
        const t = (evt.type||'').toLowerCase();
        if(!(t.includes('shahed') || t.includes('raketa') || t.includes('pusk'))) return false;
        const tx = (evt.text||'').toLowerCase();
        // Heuristic keywords
        const kw = [ '–º–∞—Å', '–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω', '–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω', '—Ö–≤–∏–ª—è', '–∑–∞–ª–ø', '–≤–µ–ª–∏–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å', '–≤–µ–ª–∏–∫–∞ –∫-—Å—Ç—å', '–∑–∞–≥–∞–ª—å–Ω–∏–π —Å—Ç–∞—Ä—Ç', '–º–∞—Å—à—Ç–∞–±' ];
        if(kw.some(k=> tx.includes(k))){ heuristics.push('–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞'); return true; }
        // Multi-launch density: count punctuation separators and numbers
        const numLaunch = (tx.match(/(\b\d{1,3}\b\s*(–ø—É—Å–∫|–∑–ª–µ—Ç|–∑–∞–ø—É—Å–∫))/g)||[]).length;
        if(numLaunch >= 3){ heuristics.push('—á–∏—Å–ª–æ –ø—É—Å–∫—ñ–≤ ‚â•3'); return true; }
        return false;
      }

      function updateHeuristics(){
        heurEl.innerHTML='';
        [...new Set(heuristics)].forEach(h=>{
          const span = document.createElement('span'); span.textContent = h; heurEl.appendChild(span);
        });
        if(freshestTrigger){
          const age = Math.round(minutesAgo(freshestTrigger));
          const span = document.createElement('span'); span.textContent = '–æ–Ω–æ–≤–ª–µ–Ω–æ ' + age + ' —Ö–≤ —Ç–æ–º—É'; heurEl.appendChild(span);
        }
      }

      function showBanner(dynamicLine){
        if(isDismissedRecent()) return;
        if(dynamicLine){ textEl.textContent = dynamicLine; }
        updateHeuristics();
        banner.classList.remove('hidden');
      }

      closeBtn.addEventListener('click', ()=>{ banner.classList.add('hidden'); markDismissed(); });

      // Integrate with existing SSE stream of events if available
      function initSSE(){
        try {
          const es = new EventSource('/stream');
          es.onmessage = (e)=>{
            try{
              const data = JSON.parse(e.data);
              if(!data || !data.event) return;
              const evt = data.event;
              if(evt.timestamp){ freshestTrigger = Math.max(freshestTrigger, evt.timestamp*1000); }
              if(evt.timestamp && minutesAgo(evt.timestamp*1000) > MAX_AGE_MIN) return; // too old
              if(qualifies(evt)){
                const line = (evt.text||'').split('\n').find(l=>/(–º–∞—Å|–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω|–º–∞—Å–æ–≤|–≤–µ–ª–∏–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å|—Ö–≤–∏–ª—è|–∑–∞–ª–ø)/i.test(l)) || textEl.textContent;
                freshestTrigger = Date.now();
                showBanner(line);
              }
            }catch(err){ /* ignore */ }
          };
        }catch(e){ /* SSE not essential */ }
      }

      // On load also scan existing DOM list items (historical) for triggers
      function scanInitial(){
        const items = document.querySelectorAll('#eventList .event-info');
        let foundLine = null;
        items.forEach(li=>{
          const txt = li.textContent||'';
          if(/(–º–∞—Å|–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω|–º–∞—Å–æ–≤|–≤–µ–ª–∏–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å|—Ö–≤–∏–ª—è|–∑–∞–ª–ø)/i.test(txt)){
            heuristics.push('–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞');
            if(!foundLine) foundLine = txt.trim().slice(0,220);
          }
        });
        if(foundLine){ freshestTrigger = Date.now(); showBanner(foundLine); }
      }

      function evaluateDataset(ds){
        if(!ds) return;
        const events = ds.events||[];
        for(const ev of events){
          const t = (ev.text||'');
            if(/(–º–∞—Å|–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω|–º–∞—Å–æ–≤|–≤–µ–ª–∏–∫–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å|—Ö–≤–∏–ª—è|–∑–∞–ª–ø)/i.test(t)){
              heuristics.push('–∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞');
              freshestTrigger = Date.now();
              return showBanner(t.split('\n')[0].slice(0,220));
            }
        }
        const tracks = ds.tracks||[];
        const missiles = tracks.filter(x=>/(raketa|pusk)/i.test(x.threat_type||'')) .length;
        const drones = tracks.filter(x=>/(shahed|fpv)/i.test(x.threat_type||'')) .length;
        // If both missile and drone counts exceed thresholds, treat as combo risk
        if(missiles >= 3 && drones >= 5){
          heuristics.push('–∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–æ (—Ä–∞—Ö—É–Ω–æ–∫)');
          freshestTrigger = Date.now();
          showBanner(`–û–∑–Ω–∞–∫–∏ –∫–æ–º–±—ñ–Ω–æ–≤–∞–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ: —Ä–∞–∫–µ—Ç–∏ ~${missiles}, –ë–ü–õ–ê ~${drones}`);
        }
      }

      document.addEventListener('markersUpdated', e=>{
        if(isDismissedRecent()) return;
        evaluateDataset(e.detail);
      });

      if(!isDismissedRecent()){
        scanInitial();
        initSSE();
      }
    })();
  </script>
  <!-- Google Maps script removed after migration to Leaflet / OpenStreetMap -->
  <script>
    // Air alarm polygons (requires separately hosted adm1/adm2 geojson files placed under /static)
    (function(){
      let activeOblasts=new Set(); let activeRaions=new Set();
      async function refreshAlarms(){
        try{ const r=await fetch('/active_alarms'); if(!r.ok) return; const d=await r.json();
          activeOblasts=new Set(d.oblasts.map(o=>o.name)); activeRaions=new Set(d.raions.map(o=>o.name));
          if(window.adm1Layer){ window.adm1Layer.setStyle(styleAdm1); }
          if(window.adm2Layer){ window.adm2Layer.setStyle(styleAdm2); }
        }catch(e){}
      }
      // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã
      function styleAdm1(f){ 
        const n=((f.properties?.ADM1_UA||f.properties?.ADM1_UK||'')+'').toLowerCase(); 
        const hit=[...activeOblasts].some(o=>n.includes(o.split(' ')[0])); 
        return {
          color: hit ? '#ef4444' : 'rgba(148, 163, 184, 0.4)',
          weight: hit ? 2.5 : 1,
          fillOpacity: hit ? 0.3 : 0.04,
          fillColor: hit ? '#dc2626' : '#1e293b',
          smoothFactor: 1.0,
          lineCap: 'round',
          lineJoin: 'round',
          className: hit ? 'region-active' : 'region-normal'
        }; 
      }
      
      function styleAdm2(f){ 
        const n=(f.properties?.ADM2_UA||'').toLowerCase(); 
        const hit=[...activeRaions].some(r=>n.startsWith(r.split(' ')[0])); 
        return {
          color: hit ? '#f87171' : 'rgba(100, 116, 139, 0.25)',
          weight: hit ? 1.5 : 0.6,
          fillOpacity: hit ? 0.25 : 0,
          fillColor: hit ? '#fca5a5' : '#000',
          smoothFactor: 1.0,
          lineCap: 'round',
          lineJoin: 'round'
        }; 
      }
      
      // Optional loaders (comment out if not ready)
  async function loadAdm1(){ try{ const r=await fetch('/static/adm1.json?v=' + Date.now()); if(!r.ok) return; const gj=await r.json(); window.adm1Layer = L.geoJSON(gj,{style:styleAdm1,interactive:false,smoothFactor:1.0}).addTo(map); }catch(e){} }
      async function loadAdm2(){ try{ const r=await fetch('/static/adm2.json'); if(!r.ok) return; const gj=await r.json(); window.adm2Layer = L.geoJSON(gj,{style:styleAdm2,interactive:false,smoothFactor:1.0}).addTo(map); }catch(e){} }
      // Kick off after map global is present
      function init(){ 
        if(typeof map==='undefined'){ 
          return setTimeout(init,500); 
        } 
  loadAdm1(); 
        /* loadAdm2(); */ 
        refreshAlarms(); 
        setInterval(refreshAlarms, 180000); // Increased from 60s to 180s for FPS optimization 
        
  // Initialize donation amount loading for support card
  // Load immediately with fallback, then try to fetch real data
  if (typeof window.loadDonationAmount === 'function') { window.loadDonationAmount(); } else { console.warn('Donation loader not ready'); }
        
        // Also try again after a short delay to catch any load timing issues
        setTimeout(() => {
          const currentAmount = localStorage.getItem('donationAmount');
          if (!currentAmount || parseFloat(currentAmount) < 100) {
            console.log('Retrying donation amount load due to low/missing amount');
            if (typeof window.loadDonationAmount === 'function') { window.loadDonationAmount(); }
          }
        }, 2000);
        
        // Periodic refresh every 15 minutes to keep amount updated
        setInterval(() => {
          console.log('Periodic donation amount refresh');
          // Clear cache to force fresh fetch
          localStorage.removeItem('donationAmount');
          localStorage.removeItem('donationAmountTime');
          if (typeof window.loadDonationAmount === 'function') { window.loadDonationAmount(); }
        }, 900000); // 15 minutes
      }
      init();


      
      // API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
      console.log('‚úÖ Ukraine Alert API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å');
    })();
  </script>

  <!-- Google AdSense Script -->
  <!-- Publisher ID: ca-pub-1995509849440582 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1995509849440582" 
          crossorigin="anonymous"></script>
  
  <script>
    // Initialize AdSense ads when available
    window.addEventListener('load', function() {
      // Check if AdSense is loaded
      if (typeof adsbygoogle !== 'undefined') {
        try {
          // Push all ad slots
          const adSlots = document.querySelectorAll('.adsbygoogle');
          adSlots.forEach(function(ad) {
            if (!ad.getAttribute('data-adsbygoogle-status')) {
              (adsbygoogle = window.adsbygoogle || []).push({});
            }
          });
          console.log('‚úÖ AdSense initialized:', adSlots.length, 'blocks');
        } catch (e) {
          console.log('‚è≥ AdSense loading...');
        }
      } else {
        console.log('‚è≥ Waiting for AdSense approval. Replace Publisher ID in script tag.');
      }
    });
  </script>

  <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Schema.org –¥–ª—è Google -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "NEPTUN - –ö–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏",
    "description": "–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –∫–∞—Ä—Ç–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ –£–∫—Ä–∞—ó–Ω–∏ –≤ —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É. –ê–∫—Ç—É–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞–≥—Ä–æ–∑–∏, –æ–±—Å—Ç—Ä—ñ–ª–∏ —Ç–∞ —Ç—Ä–∏–≤–æ–≥–∏ –ø–æ –≤—Å—ñ—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö.",
    "url": "https://neptun.in.ua/",
    "applicationCategory": "SafetyApplication",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript. Requires HTML5.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "UAH"
    },
    "author": {
      "@type": "Organization",
      "name": "NEPTUN"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "5213"
    },
    "featureList": [
      "–ö–∞—Ä—Ç–∞ —Ç—Ä–∏–≤–æ–≥ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ",
      "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–∏–ø–∏ –∑–∞–≥—Ä–æ–∑",
      "–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–¥—ñ–π",
      "Push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è",
      "–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Telegram"
    ]
  }
  </script>

  <!-- Ad Revenue Optimization Script -->
  <script>
    // Ad viewability tracking and auto-refresh for better revenue
    (function() {
      const AD_REFRESH_INTERVAL = 45000; // 45 seconds - optimal for RPM
      const adContainers = document.querySelectorAll('.ad-container-responsive');
      const refreshedAds = new Set();
      
      // Intersection Observer for viewability tracking
      const adObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
            const adId = entry.target.id || entry.target.className;
            
            // Track ad impression in Google Analytics
            if (typeof gtag !== 'undefined') {
              gtag('event', 'ad_impression', {
                'event_category': 'ads',
                'event_label': adId,
                'value': 1
              });
            }
            
            // Schedule auto-refresh after initial view (once per session)
            if (!refreshedAds.has(adId)) {
              refreshedAds.add(adId);
              setTimeout(() => {
                // Recreativ ads auto-refresh themselves, just track it
                if (typeof gtag !== 'undefined') {
                  gtag('event', 'ad_refresh', {
                    'event_category': 'ads',
                    'event_label': adId
                  });
                }
              }, AD_REFRESH_INTERVAL);
            }
          }
        });
      }, {
        threshold: [0.5] // 50% visibility triggers tracking
      });
      
      // Observe all ad containers
      adContainers.forEach(container => {
        adObserver.observe(container);
      });
      
      // Engagement timer removed for FPS optimization
      
      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        clearInterval(engagementTimer);
      });
    })();
  </script>

  <!-- Nickname Registration Modal -->
  <div id="nicknameModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999999; justify-content: center; align-items: center;">
    <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); padding: 2.5rem; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); max-width: 450px; width: 90%; border: 2px solid rgba(59, 130, 246, 0.3);">
      <h2 style="margin: 0 0 0.8rem 0; color: #60a5fa; font-size: 1.8rem; text-align: center; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
        <span class="material-icons" style="font-size: 2rem;">person_add</span>
        –í—ñ—Ç–∞—î–º–æ –Ω–∞ NEPTUN!
      </h2>
      <p style="color: #cbd5e1; margin-bottom: 1.5rem; text-align: center; line-height: 1.6;">
        –ü—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–æ–±—ñ –Ω—ñ–∫–Ω–µ–π–º, —è–∫–∏–π –±—É–¥–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –ø–æ—Ä—É—á —ñ–∑ –ø–æ—à—É–∫–æ–º —Ç–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏—Ü—ñ –æ–Ω–ª–∞–π–Ω –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤
      </p>
      <div style="margin-bottom: 1.5rem;">
        <input 
          type="text" 
          id="nicknameInput" 
          placeholder="–í–≤–µ–¥—ñ—Ç—å —Å–≤—ñ–π –Ω—ñ–∫–Ω–µ–π–º..." 
          maxlength="20"
          style="width: 100%; padding: 0.9rem 1.2rem; font-size: 1rem; border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 10px; background: rgba(15, 23, 42, 0.5); color: #e2e8f0; box-sizing: border-box; transition: all 0.3s;"
          onkeypress="if(event.key === 'Enter') saveNickname()"
        >
        <small style="color: #94a3b8; display: block; margin-top: 0.5rem; text-align: center;">–ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª—ñ–≤</small>
      </div>
      <button 
        onclick="saveNickname()" 
        style="width: 100%; padding: 0.9rem; font-size: 1.1rem; font-weight: 600; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);"
        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.6)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.4)'"
      >
        –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏
      </button>
    </div>
  </div>

  <script>
    // Nickname management
    function saveNickname() {
      const input = document.getElementById('nicknameInput');
      const nickname = input.value.trim();
      
      if (!nickname || nickname.length < 2) {
        input.style.borderColor = '#ef4444';
        input.placeholder = '–ú—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏!';
        setTimeout(() => {
          input.style.borderColor = 'rgba(59, 130, 246, 0.3)';
        }, 2000);
        return;
      }
      
      // Save to localStorage
      localStorage.setItem('neptun_nickname', nickname);
      
      // Hide modal
      document.getElementById('nicknameModal').style.display = 'none';
      
      // Update UI
      updateNicknameDisplay(nickname);
      
      // Send to server
      sendNicknameToServer(nickname);
    }
    
    function updateNicknameDisplay(nickname) {
      // Add nickname as flex item in placeSearch
      const placeSearch = document.getElementById('placeSearch');
      if (placeSearch) {
        let nicknameDisplay = document.getElementById('nicknameDisplay');
        if (!nicknameDisplay) {
          nicknameDisplay = document.createElement('div');
          nicknameDisplay.id = 'nicknameDisplay';
          nicknameDisplay.style.cssText = `
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
            color: #60a5fa;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            border: 1.5px solid rgba(59, 130, 246, 0.3);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
            margin-left: 8px;
          `;
          placeSearch.appendChild(nicknameDisplay);
        }
        nicknameDisplay.innerHTML = `
          <span class="material-icons" style="font-size: 16px;">person</span>
          <span>${nickname}</span>
        `;
      }
    }
    
    function sendNicknameToServer(nickname) {
      // Send nickname with next heartbeat
      if (window.neptunNickname !== nickname) {
        window.neptunNickname = nickname;
      }
    }
    
    // Check if user has nickname on page load
    document.addEventListener('DOMContentLoaded', function() {
      const savedNickname = localStorage.getItem('neptun_nickname');
      if (savedNickname) {
        updateNicknameDisplay(savedNickname);
        window.neptunNickname = savedNickname;
      } else {
        // Show modal after a short delay
        setTimeout(() => {
          document.getElementById('nicknameModal').style.display = 'flex';
        }, 1500);
      }
    });
  </script>

</body>
</html>
