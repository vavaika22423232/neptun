<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥ - Neptun Alarm Map</title>
  <meta name="description" content="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ –≤ –£–∫—Ä–∞—ó–Ω—ñ. –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏, —Ç—Ä–µ–Ω–¥–∏ —Ç–∞ –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞–≥—Ä–æ–∑–∏.">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
      padding: 2rem;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 2px solid #334155;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header p {
      font-size: 1.1rem;
      color: #94a3b8;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    
    .stat-card {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid #334155;
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px -8px rgba(59, 130, 246, 0.3);
      border-color: #3b82f6;
    }
    
    .stat-card h3 {
      font-size: 0.9rem;
      font-weight: 600;
      color: #94a3b8;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-card .value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #60a5fa;
      margin-bottom: 0.5rem;
    }
    
    .stat-card .label {
      font-size: 0.85rem;
      color: #64748b;
    }
    
    .analysis-section {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid #334155;
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
    }
    
    .analysis-section h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: #e2e8f0;
    }
    
    .analysis-section p {
      font-size: 1rem;
      line-height: 1.8;
      color: #cbd5e1;
      margin-bottom: 1rem;
    }
    
    .insights-list {
      list-style: none;
      margin-top: 1.5rem;
    }
    
    .insights-list li {
      padding: 1rem;
      background: rgba(15, 23, 42, 0.5);
      border-left: 3px solid #3b82f6;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .insights-list li strong {
      color: #60a5fa;
      font-weight: 600;
    }
    
    .chart-placeholder {
      background: rgba(15, 23, 42, 0.5);
      border: 2px dashed #334155;
      border-radius: 0.75rem;
      padding: 3rem;
      text-align: center;
      color: #64748b;
      margin-top: 1.5rem;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 2rem;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s;
    }
    
    .back-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px -8px rgba(59, 130, 246, 0.5);
    }
    
    .methodology {
      background: rgba(30, 41, 59, 0.4);
      border: 1px solid #334155;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #94a3b8;
    }
    
    .methodology h4 {
      color: #cbd5e1;
      margin-bottom: 0.75rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥</h1>
      <p>–î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –∑–∞–≥—Ä–æ–∑ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–∏—Ö —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</p>
    </div>
    
    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <h3>–ê–∫—Ç–∏–≤–Ω—ñ –∑–∞–≥—Ä–æ–∑–∏</h3>
        <div class="value" id="activeThreats">-</div>
        <div class="label">–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç</div>
      </div>
      
      <div class="stat-card">
        <h3>–ó–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏</h3>
        <div class="value" id="last24h">-</div>
        <div class="label">–ó–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ —Ç—Ä–∏–≤–æ–≥</div>
      </div>
      
      <div class="stat-card">
        <h3>–ù–∞–π–∞–∫—Ç–∏–≤–Ω—ñ—à–∏–π —Ä–µ–≥—ñ–æ–Ω</h3>
        <div class="value" style="font-size: 1.5rem;" id="topRegion">-</div>
        <div class="label">–ó–∞ –æ—Å—Ç–∞–Ω–Ω—é –¥–æ–±—É</div>
      </div>
      
      <div class="stat-card">
        <h3>–¢–∏–ø –∑–∞–≥—Ä–æ–∑–∏</h3>
        <div class="value" style="font-size: 1.5rem;" id="topThreat">-</div>
        <div class="label">–ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏–π</div>
      </div>
    </div>
    
    <div class="analysis-section">
      <h2>üîç –ê–Ω–∞–ª—ñ–∑ –∑–∞–≥—Ä–æ–∑</h2>
      <p>
        –ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–±–∏—Ä–∞—î —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É—î –¥–∞–Ω—ñ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, 
        –Ω–∞–¥–∞—é—á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ –≤ –£–∫—Ä–∞—ó–Ω—ñ. 
        –í—Å—ñ –¥–∞–Ω—ñ –ø—Ä–æ—Ö–æ–¥—è—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –æ–±—Ä–æ–±–∫—É —Ç–∞ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç—ñ.
      </p>
      
      <ul class="insights-list" id="insightsList">
        <li>–û—á—ñ–∫—É—î–º–æ –Ω–∞ –ø–µ—Ä—à—ñ –¥–∞–Ω—ñ‚Ä¶</li>
      </ul>
      
      <div class="chart-placeholder" id="trendSummary">
        üìà –ì—Ä–∞—Ñ—ñ–∫–∏ —Ç–∞ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º
      </div>
    </div>
    
    <div class="analysis-section">
      <h2>üí° –Ø–∫ –º–∏ –æ–±—Ä–æ–±–ª—è—î–º–æ –¥–∞–Ω—ñ</h2>
      <p>
        Neptun Alarm Map - —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –ú–∏ –¥–æ–¥–∞—î–º–æ –∑–Ω–∞—á–Ω—É —Ü—ñ–Ω–Ω—ñ—Å—Ç—å –¥–æ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö:
      </p>
      
      <ul class="insights-list">
        <li>
          <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è:</strong> –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Ç–µ–∫—Å—Ç–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —Ç–æ—á–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ 
          –Ω–∞ –∫–∞—Ä—Ç—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–ª–∞—Å–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö –∑ –ø–æ–Ω–∞–¥ 10,000 –Ω–∞—Å–µ–ª–µ–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏.
        </li>
        <li>
          <strong>–ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–∞–≥—Ä–æ–∑:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–∏–ø –∑–∞–≥—Ä–æ–∑–∏ (–ë–ø–õ–ê, —Ä–∞–∫–µ—Ç–∏, –∞–≤—ñ–∞—Ü—ñ—è) 
          —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —ñ–∫–æ–Ω–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ.
        </li>
        <li>
          <strong>–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —à—É–º—É:</strong> –í–∏–¥–∞–ª—è—î–º–æ –¥—É–±–ª—ñ–∫–∞—Ç–∏, –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç–∞ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, 
          –∑–∞–ª–∏—à–∞—é—á–∏ —Ç—ñ–ª—å–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤—ñ –¥–∞–Ω—ñ –ø—Ä–æ –∑–∞–≥—Ä–æ–∑–∏.
        </li>
        <li>
          <strong>–ê–≥—Ä–µ–≥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö:</strong> –û–±'—î–¥–Ω—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ –∫—ñ–ª—å–∫–æ—Ö –¥–∂–µ—Ä–µ–ª –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è 
          —î–¥–∏–Ω–æ—ó –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ—ó –∫–∞—Ä—Ç–∏–Ω–∏ —Å–∏—Ç—É–∞—Ü—ñ—ó.
        </li>
        <li>
          <strong>–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑:</strong> –ì–µ–Ω–µ—Ä—É—î–º–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, —Ç—Ä–µ–Ω–¥–∏ —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∏, 
          —è–∫—ñ –Ω–µ–º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑ –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª.
        </li>
      </ul>
    </div>
    
    <div class="methodology">
      <h4>üìã –ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è –∑–±–æ—Ä—É –¥–∞–Ω–∏—Ö</h4>
      <p>
        –î–∞–Ω—ñ –∑–±–∏—Ä–∞—é—Ç—å—Å—è –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏—Ö Telegram-–∫–∞–Ω–∞–ª—ñ–≤ –ø–æ–≤—ñ—Ç—Ä—è–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥. –ö–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ—Ö–æ–¥–∏—Ç—å 
        —Å–∫–ª–∞–¥–Ω—É –æ–±—Ä–æ–±–∫—É: –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç—É, –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≥–µ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö –Ω–∞–∑–≤, –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, 
        –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ç–∏–ø—É –∑–∞–≥—Ä–æ–∑–∏ —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é. –°–∏—Å—Ç–µ–º–∞ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ 
        –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –í–µ—Å—å –∫–æ–¥ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö —î –≤–ª–∞—Å–Ω–æ—é —Ä–æ–∑—Ä–æ–±–∫–æ—é —Ç–∞ –ø–æ—Å—Ç—ñ–π–Ω–æ –≤–¥–æ—Å–∫–æ–Ω–∞–ª—é—î—Ç—å—Å—è.
      </p>
    </div>
    
    <a href="/" class="back-link">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –Ω–∞ –∫–∞—Ä—Ç—É</a>
  </div>
  
  <script>
    (function() {
      const STAT_ENDPOINT = '/data';
      const params = new URLSearchParams({ confRange: 0, maxTracks: 800, timeRange: 90, insights: 1 });
      const dom = {
        active: document.getElementById('activeThreats'),
        last24: document.getElementById('last24h'),
        topRegion: document.getElementById('topRegion'),
        topThreat: document.getElementById('topThreat'),
        insightsList: document.getElementById('insightsList'),
        trendSummary: document.getElementById('trendSummary')
      };
      const THREAT_NAMES = {
        'shahed': '–®–∞—Ö–µ–¥',
        'bpla': '–ë–ø–õ–ê',
        'missile': '–†–∞–∫–µ—Ç–∞',
        'rocket': '–†–∞–∫–µ—Ç–∞',
        'ballistic': '–ë–∞–ª—ñ—Å—Ç–∏–∫–∞',
        'aviation': '–ê–≤—ñ–∞—Ü—ñ—è',
        'fpv': 'FPV',
        'kab': '–ö–ê–ë –±–æ–º–±–∏',
        'artillery': '–ê—Ä—Ç–∏–ª–µ—Ä—ñ—è',
        'default': '–†—ñ–∑–Ω—ñ'
      };
      const numberFormatter = new Intl.NumberFormat('uk-UA');
      function parseTs(raw) {
        if (!raw) return null;
        if (typeof raw === 'number') return raw;
        const normalized = raw.replace(' ', 'T');
        const direct = Date.parse(normalized);
        if (!isNaN(direct)) return direct;
        const utc = Date.parse(normalized + 'Z');
        if (!isNaN(utc)) return utc;
        const fallback = Date.parse(raw);
        return isNaN(fallback) ? null : fallback;
      }
      function computeStats(tracks) {
        const now = Date.now();
        const hourMs = 60 * 60 * 1000;
        const dayMs = 24 * hourMs;
        const regionCounts = new Map();
        const threatCounts = new Map();
        let last24 = 0;
        let lastHour = 0;
        let prevHour = 0;
        let datedCount = 0;
        let ageSum = 0;
        let nightCount = 0;
        let latest = null;
        tracks.forEach(track => {
          const ts = parseTs(track.date || track.timestamp || track.time);
          const region = (track.oblast || track.region || track.place || '–ù–µ–≤—ñ–¥–æ–º–æ').split(',')[0].trim();
          regionCounts.set(region, (regionCounts.get(region) || 0) + 1);
          const typeKey = (track.threat_type || 'default').toLowerCase();
          threatCounts.set(typeKey, (threatCounts.get(typeKey) || 0) + 1);
          if (ts) {
            const age = now - ts;
            datedCount++;
            ageSum += Math.max(age, 0);
            if (age <= dayMs) last24++;
            if (age <= hourMs) lastHour++;
            else if (age <= 2 * hourMs) prevHour++;
            const hour = new Date(ts).getHours();
            if (hour >= 22 || hour < 6) nightCount++;
            if (!latest || ts > latest.ts) latest = { ts, track };
          }
        });
        const sortEntries = map => Array.from(map.entries()).sort((a, b) => b[1] - a[1]);
        const topRegion = sortEntries(regionCounts)[0];
        const topThreat = sortEntries(threatCounts)[0];
        const avgAge = datedCount ? ageSum / datedCount / 60000 : null;
        const nightShare = tracks.length ? Math.round((nightCount / tracks.length) * 100) : 0;
        return {
          total: tracks.length,
          last24,
          lastHour,
          prevHour,
          topRegion,
          topThreat,
          avgAge,
          latest,
          nightShare
        };
      }
      function render(stats) {
        if (!stats) return;
        dom.active.textContent = numberFormatter.format(stats.total);
        dom.last24.textContent = numberFormatter.format(stats.last24);
        const regionLabel = stats.topRegion ? stats.topRegion[0] : '–ù–µ–≤—ñ–¥–æ–º–æ';
        dom.topRegion.textContent = regionLabel;
        const threatKey = stats.topThreat ? stats.topThreat[0] : 'default';
        dom.topThreat.textContent = THREAT_NAMES[threatKey] || threatKey;
        const trend = stats.lastHour - stats.prevHour;
        const trendWord = trend > 0 ? '–∑—Ä–æ—Å–ª–∞' : trend < 0 ? '–∑–Ω–∏–∑–∏–ª–∞—Å—å' : '–∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—é';
        const narrative = stats.latest ?
          `–ó–∞ –æ—Å—Ç–∞–Ω–Ω—é –≥–æ–¥–∏–Ω—É –º–∏ –∑–∞—Ñ—ñ–∫—Å—É–≤–∞–ª–∏ ${numberFormatter.format(stats.lastHour)} –∞–∫—Ç–∏–≤–Ω–∏—Ö –ø–æ–¥—ñ–π. ` +
          `–ù–∞–π—Å–≤—ñ–∂—ñ—à–∏–π —Å–∏–≥–Ω–∞–ª –Ω–∞–¥—ñ–π—à–æ–≤ ${new Date(stats.latest.ts).toLocaleTimeString('uk-UA')} —É –Ω–∞–ø—Ä—è–º–∫—É ${regionLabel.toLowerCase()}. ` +
          `–Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å ${trendWord}, —Å–µ—Ä–µ–¥–Ω—ñ–π –≤—ñ–∫ –º–∞—Ä–∫–µ—Ä—ñ–≤ ${stats.avgAge ? stats.avgAge.toFixed(1) : '‚Äî'} —Ö–≤.`
          : '–û—á—ñ–∫—É—î–º–æ –Ω–∞ –ø–µ—Ä—à—ñ –∞–∫—Ç—É–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ‚Ä¶';
        if (dom.trendSummary) {
          dom.trendSummary.textContent = narrative;
        }
        if (dom.insightsList) {
          const items = [];
          if (stats.topRegion) {
            items.push(`<strong>–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è:</strong> ${regionLabel} –¥–∞—î –Ω–∞–π–±—ñ–ª—å—à–µ —Å–∏–≥–Ω–∞–ª—ñ–≤ –ø—Ä–æ—Å—Ç–æ –∑–∞—Ä–∞–∑.`);
          }
          if (stats.topThreat) {
            const share = stats.total ? Math.round((stats.topThreat[1] / stats.total) * 100) : 0;
            items.push(`<strong>–¢–∏–ø –∑–∞–≥—Ä–æ–∑–∏:</strong> ${THREAT_NAMES[threatKey] || threatKey} —Å—Ç–∞–Ω–æ–≤–∏—Ç—å ${share}% —É—Å—ñ—Ö –º–∞—Ä–∫–µ—Ä—ñ–≤.`);
          }
          items.push(`<strong>–ù—ñ—á–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:</strong> ${stats.nightShare}% –ø–æ–¥—ñ–π –ø—Ä–∏–ø–∞–¥–∞—î –Ω–∞ —ñ–Ω—Ç–µ—Ä–≤–∞–ª 22:00-06:00.`);
          const html = items.map(text => `<li>${text}</li>`).join('');
          dom.insightsList.innerHTML = html || '<li>–û—á—ñ–∫—É—î–º–æ –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö‚Ä¶</li>';
        }
      }
      async function loadStats() {
        try {
          const response = await fetch(`${STAT_ENDPOINT}?${params.toString()}`, { cache: 'no-store' });
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          const payload = await response.json();
          const tracks = (payload && Array.isArray(payload.tracks)) ? payload.tracks : [];
          const stats = computeStats(tracks);
          render(stats);
        } catch (err) {
          console.error('Failed to load analytics stats:', err);
        }
      }
      loadStats();
      setInterval(loadStats, 30000);
    })();
  </script>
</body>
</html>
