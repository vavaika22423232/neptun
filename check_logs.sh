#!/bin/bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üìù –ü–†–û–°–ú–û–¢–† –õ–û–ì–û–í –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø"
echo "============================"

# –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ –ø–æ–∫–∞–∑–∞ –ª–æ–≥–æ–≤
show_logs() {
    echo "üîç –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤..."
    
    # –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤
    log_files=("app_debug.log" "debug.log" "app.log" "server.log" "error.log" "access.log")
    
    found_logs=false
    
    for log_file in "${log_files[@]}"; do
        if [ -f "$log_file" ]; then
            echo ""
            echo "üìÑ –ù–ê–ô–î–ï–ù: $log_file"
            echo "----------------------------------------"
            echo "üìä –†–∞–∑–º–µ—Ä: $(ls -lh $log_file | awk '{print $5}')"
            echo "üïê –ò–∑–º–µ–Ω–µ–Ω: $(ls -l $log_file | awk '{print $6, $7, $8}')"
            echo ""
            echo "üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫:"
            tail -20 "$log_file"
            echo "----------------------------------------"
            found_logs=true
        fi
    done
    
    if [ "$found_logs" = false ]; then
        echo "‚ùå –§–∞–π–ª—ã –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        echo ""
        echo "üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
        echo "1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ"
        echo "2. –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ –¥—Ä—É–≥–æ–µ –º–µ—Å—Ç–æ"
        echo "3. –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
check_running() {
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
    
    if ps aux | grep -v grep | grep "python.*app"; then
        echo "‚úÖ –ù–∞–π–¥–µ–Ω—ã Python –ø—Ä–æ—Ü–µ—Å—Å—ã —Å app"
    else
        echo "‚ùå Python –ø—Ä–æ—Ü–µ—Å—Å—ã —Å app –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    fi
    echo ""
}

# –§—É–Ω–∫—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
monitor_logs() {
    echo "üëÅÔ∏è  –ú–û–ù–ò–¢–û–†–ò–ù–ì –õ–û–ì–û–í –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò"
    echo "======================================="
    echo "üí° –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞"
    echo ""
    
    # –ò—â–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –ª–æ–≥ —Ñ–∞–π–ª
    for log_file in "app_debug.log" "debug.log" "app.log"; do
        if [ -f "$log_file" ]; then
            echo "üì± –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ: $log_file"
            tail -f "$log_file"
            return
        fi
    done
    
    echo "‚ùå –ê–∫—Ç–∏–≤–Ω—ã–µ –ª–æ–≥ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    echo "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º: python3 app_debug.py"
}

# –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
case "${1:-show}" in
    "show")
        check_running
        show_logs
        ;;
    "monitor"|"watch")
        monitor_logs
        ;;
    "help")
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
        echo "  $0 show     - –ø–æ–∫–∞–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–≥–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
        echo "  $0 monitor  - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
        echo "  $0 watch    - —Ç–æ –∂–µ —á—Ç–æ monitor"
        ;;
    *)
        echo "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: $1"
        echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: $0 help"
        ;;
esac
