#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –û–¥–µ—Å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –±–æ–ª—å—à–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É –≤ sys.path —á—Ç–æ–±—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å app.py
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

try:
    from app import find_city_from_general, ensure_city_coords

    def test_message_processing():
        print("=== –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –û–¥–µ—Å—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ ===\n")
        
        test_messages = [
            "üõ∏ –°–µ—Ä–≥—ñ—ó–≤–∫–∞ (–û–¥–µ—Å—å–∫–∞ –æ–±–ª.) –ó–∞–≥—Ä–æ–∑–∞ –ë–ø–õ–ê!",
            "üõ∏ –¢—É–∑–ª–∏ (–û–¥–µ—Å—å–∫–∞ –æ–±–ª.) –ó–∞–≥—Ä–æ–∑–∞ –ë–ø–õ–ê!",
            "üí• –°–µ—Ä–≥—ñ—ó–≤–∫–∞ (–û–¥–µ—Å—å–∫–∞ –æ–±–ª.) –ó–∞–≥—Ä–æ–∑–∞ –æ–±—Å—Ç—Ä—ñ–ª—É!",
        ]
        
        for msg in test_messages:
            print(f"–°–æ–æ–±—â–µ–Ω–∏–µ: {msg}")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –≥–æ—Ä–æ–¥
            city = find_city_from_general(msg)
            if city:
                print(f"  –ù–∞–π–¥–µ–Ω –≥–æ—Ä–æ–¥: '{city}'")
                
                # –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                coords_result = ensure_city_coords(city)
                if coords_result:
                    lat, lon, is_approx = coords_result
                    print(f"  –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ({lat}, {lon})")
                    print(f"  –¢–æ—á–Ω–æ—Å—Ç—å: {'–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ (oblast fallback)' if is_approx else '—Ç–æ—á–Ω—ã–µ'}")
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ –õ—É—Ü—å–∫ –∏ –Ω–µ –ù–∏–∫–æ–ª–∞–µ–≤
                    if abs(lat - 50.7472) < 0.001 and abs(lon - 25.3254) < 0.001:
                        print("  ‚ùå –û–®–ò–ë–ö–ê: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ –õ—É—Ü—å–∫!")
                    elif abs(lat - 46.9750) < 0.001 and abs(lon - 31.9946) < 0.001:
                        print("  ‚ùå –û–®–ò–ë–ö–ê: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∫–∞–∫ –ù–∏–∫–æ–ª–∞–µ–≤!")
                    else:
                        print("  ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–µ –ø—É—Ç–∞–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –≥–æ—Ä–æ–¥–∞–º–∏")
                else:
                    print(f"  ‚ùå –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è –≥–æ—Ä–æ–¥–∞ '{city}'")
            else:
                print(f"  ‚ùå –ì–æ—Ä–æ–¥ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è")
            
            print()

    if __name__ == "__main__":
        test_message_processing()
        
except ImportError as e:
    print(f"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ app.py –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ")
