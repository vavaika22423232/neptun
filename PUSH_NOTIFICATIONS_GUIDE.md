# Push-—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ —Ç—Ä–∏–≤–æ–≥–∏

## –©–æ –¥–æ–¥–∞–Ω–æ

### 1. –°—Ç–æ—Ä—ñ–Ω–∫–∞ –≤–∏–±–æ—Ä—É —Ä–µ–≥—ñ–æ–Ω—ñ–≤ (`lib/pages/regions_page.dart`)
- –°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –æ–±–ª–∞—Å—Ç–µ–π –£–∫—Ä–∞—ó–Ω–∏ –¥–ª—è –≤–∏–±–æ—Ä—É
- –í–º–∏–∫–∞–Ω–Ω—è/–≤–∏–º–∏–∫–∞–Ω–Ω—è push-—Å–ø–æ–≤—ñ—â–µ–Ω—å
- –ö–Ω–æ–ø–∫–∏ "–í—Å—ñ" —Ç–∞ "–°–∫–∏–Ω—É—Ç–∏" –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –≤–∏–±–æ—Ä—É
- –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

### 2. Backend –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Ç—Ä–∏–≤–æ–≥ (`app.py`)

**–ù–æ–≤—ñ endpoints:**
- `POST /api/register-device` - —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –ø—Ä–∏—Å—Ç—Ä–æ—é –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω—å
  ```json
  {
    "device_id": "uuid",
    "token": "FCM token",
    "regions": ["–ö–∏—ó–≤", "–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å"],
    "enabled": true
  }
  ```

- `POST /api/test-notification` - –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
  ```json
  {
    "token": "FCM token"
  }
  ```

**–§–æ–Ω–æ–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:**
- –ö–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∑–º—ñ–Ω–∏ –≤ —Ç—Ä–∏–≤–æ–≥–∞—Ö —á–µ—Ä–µ–∑ API ukrainealarm.com
- –ü–æ—Ä—ñ–≤–Ω—é—î –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º
- –í—ñ–¥–ø—Ä–∞–≤–ª—è—î push –ø—Ä–∏ –ø–æ—á–∞—Ç–∫—É –∞–±–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏

### 3. –û–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
- –ù–æ–≤–∞ –∫–Ω–æ–ø–∫–∞ "–†–µ–≥—ñ–æ–Ω–∏ –¥–ª—è —Ç—Ä–∏–≤–æ–≥" –∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤–∏–±–æ—Ä—É
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —ñ—Å–Ω—É—é—á–æ—é —Å–∏—Å—Ç–µ–º–æ—é –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å

### 4. –†–æ–∑—à–∏—Ä–µ–Ω–∏–π DeviceStore (`core/message_store.py`)
- –î–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥ `save_device()` –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø—Ä–∏—Å—Ç—Ä–æ—ó
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–∏–º–∫–Ω–µ–Ω–Ω—è —É–≤–µ–¥–æ–º–ª–µ–Ω—å —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `enabled`
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø—Ä–∏—Å—Ç—Ä–æ—é

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

1. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:**
   - –í—ñ–¥–∫—Ä–∏–≤–∞—î –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –†–µ–≥—ñ–æ–Ω–∏ –¥–ª—è —Ç—Ä–∏–≤–æ–≥
   - –û–±–∏—Ä–∞—î –æ–±–ª–∞—Å—Ç—ñ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
   - –ù–∞—Ç–∏—Å–∫–∞—î "–ó–±–µ—Ä–µ–≥—Ç–∏"

2. **–î–æ–¥–∞—Ç–æ–∫:**
   - –ì–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π device_id (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ø–æ—Å—Ç—ñ–π–Ω–æ)
   - –û—Ç—Ä–∏–º—É—î FCM token –≤—ñ–¥ Firebase
   - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î –¥–∞–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

3. **–°–µ—Ä–≤–µ—Ä:**
   - –ó–±–µ—Ä—ñ–≥–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø—Ä–∏—Å—Ç—Ä—ñ–π —É `devices.json`
   - –ö–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–≤—ñ—Ä—è—î API —Ç—Ä–∏–≤–æ–≥
   - –ü—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞—Ç—É—Å—É —Ç—Ä–∏–≤–æ–≥–∏:
     - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –≤—Å—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó, —â–æ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ –Ω–∞ —Ü–µ–π —Ä–µ–≥—ñ–æ–Ω
     - –í—ñ–¥–ø—Ä–∞–≤–ª—è—î push-—É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Firebase

4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è:**
   - üö® –ö—Ä–∏—Ç–∏—á–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ (—Ä–∞–∫–µ—Ç–∏) - –∫–∞–Ω–∞–ª `critical_alerts`
   - ‚ö†Ô∏è –ó–≤–∏—á–∞–π–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏ (–¥—Ä–æ–Ω–∏) - –∫–∞–Ω–∞–ª `normal_alerts`
   - ‚úÖ –í—ñ–¥–±—ñ–π —Ç—Ä–∏–≤–æ–≥–∏

## –¢–∏–ø–∏ —Å–ø–æ–≤—ñ—â–µ–Ω—å

### –ü–æ—á–∞—Ç–æ–∫ —Ç—Ä–∏–≤–æ–≥–∏
```
üö® –ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞!
–ö–∏—ó–≤: –†–∞–∫–µ—Ç–Ω–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞, –ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞
```

### –ó–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Ç—Ä–∏–≤–æ–≥–∏
```
‚úÖ –í—ñ–¥–±—ñ–π —Ç—Ä–∏–≤–æ–≥–∏
–ö–∏—ó–≤: —Ç—Ä–∏–≤–æ–≥–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Firebase

### Backend
–ü–æ—Ç—Ä—ñ–±–Ω–∞ –∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ `FIREBASE_CREDENTIALS` –∑ base64-encoded JSON:
```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ base64 –∑ firebase-credentials.json
base64 -i firebase-credentials.json | tr -d '\n'

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–∞ Render
FIREBASE_CREDENTIALS=<base64-encoded-json>
```

### Firebase Console
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ–µ–∫—Ç —É Firebase Console
2. –î–æ–¥–∞—Ç–∏ Android app –∑ package name `com.neptun.alarm`
3. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ `google-services.json` ‚Üí `android/app/`
4. –î–æ–¥–∞—Ç–∏ iOS app (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
5. –£ Project Settings ‚Üí Service accounts ‚Üí Generate new private key
6. –ó–±–µ—Ä–µ–≥—Ç–∏ —è–∫ `firebase-credentials.json`

## –§–∞–π–ª–∏

### –°—Ç–≤–æ—Ä–µ–Ω–æ/–ó–º—ñ–Ω–µ–Ω–æ:
- ‚úÖ `lib/pages/regions_page.dart` - –Ω–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞
- ‚úÖ `lib/pages/settings_page.dart` - –¥–æ–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞
- ‚úÖ `app.py` - –¥–æ–¥–∞–Ω—ñ endpoints —Ç–∞ —Ñ–æ–Ω–æ–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ `core/message_store.py` - —Ä–æ–∑—à–∏—Ä–µ–Ω–æ DeviceStore
- ‚úÖ `devices.json` - —Ñ–∞–π–ª –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

### –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —ñ—Å–Ω—É—é—á—ñ:
- ‚úÖ `lib/services/notification_service.dart` - –≤–∂–µ —î
- ‚úÖ Firebase –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ `android/` —Ç–∞ `ios/`

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–õ–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   # –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
   cd neptun_alarm_app
   flutter pub get
   
   # –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫
   flutter run
   ```

2. **–¢–µ—Å—Ç–æ–≤–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è:**
   - –í—ñ–¥–∫—Ä–∏—Ç–∏ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è ‚Üí –†–µ–≥—ñ–æ–Ω–∏ –¥–ª—è —Ç—Ä–∏–≤–æ–≥
   - –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "–¢–µ—Å—Ç–æ–≤–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è"
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

3. **–†–µ–∞–ª—å–Ω—ñ —Ç—Ä–∏–≤–æ–≥–∏:**
   - –û–±—Ä–∞—Ç–∏ —Å–≤—ñ–π —Ä–µ–≥—ñ–æ–Ω
   - –î–æ—á–µ–∫–∞—Ç–∏—Å—è —Ä–µ–∞–ª—å–Ω–æ—ó —Ç—Ä–∏–≤–æ–≥–∏
   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è

## –û–±–º–µ–∂–µ–Ω–Ω—è

- Firebase –º–∞—î –ª—ñ–º—ñ—Ç–∏ –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ–º—É –ø–ª–∞–Ω—ñ: 10K —Å–ø–æ–≤—ñ—â–µ–Ω—å/–¥–µ–Ω—å
- –§–æ–Ω–æ–≤–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–Ω–∏–π
- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å –≤ iOS Simulator (—Ç—ñ–ª—å–∫–∏ —Ä–µ–∞–ª—å–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π)

## –ù–∞—Å—Ç—É–ø–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] –î–æ–¥–∞—Ç–∏ –∑–≤—É–∫–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ —Ç—Ä–∏–≤–æ–≥
- [ ] –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é —Ç—Ä–∏–≤–æ–≥ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] –î–æ–¥–∞—Ç–∏ –≤—ñ–¥–∂–µ—Ç –Ω–∞ –¥–æ–º–∞—à–Ω—ñ–π –µ–∫—Ä–∞–Ω
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
- [ ] –¢–∏—Ö–∏–π —Ä–µ–∂–∏–º (–Ω–µ —Ç—É—Ä–±—É–≤–∞—Ç–∏ –≤–Ω–æ—á—ñ)
