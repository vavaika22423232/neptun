"""
Neptun Alarm - Ukrainian Regions Data
Oblast codes, centers, and coordinates
"""

# Oblast P-codes (for alerts.in.ua API)
OBLAST_PCODE = {
    'UA01': 'Автономна Республіка Крим',
    'UA05': 'Вінницька область',
    'UA07': 'Волинська область',
    'UA12': 'Дніпропетровська область',
    'UA14': 'Донецька область',
    'UA18': 'Житомирська область',
    'UA21': 'Закарпатська область',
    'UA23': 'Запорізька область',
    'UA26': 'Івано-Франківська область',
    'UA32': 'Київська область',
    'UA35': 'Кіровоградська область',
    'UA44': 'Луганська область',
    'UA46': 'Львівська область',
    'UA48': 'Миколаївська область',
    'UA51': 'Одеська область',
    'UA53': 'Полтавська область',
    'UA56': 'Рівненська область',
    'UA59': 'Сумська область',
    'UA61': 'Тернопільська область',
    'UA63': 'Харківська область',
    'UA65': 'Херсонська область',
    'UA68': 'Хмельницька область',
    'UA71': 'Черкаська область',
    'UA73': 'Чернівецька область',
    'UA74': 'Чернігівська область',
    'UA80': 'м. Київ',
    'UA85': 'м. Севастополь',
}

# Oblast center coordinates
OBLAST_CENTERS = {
    'київ': (50.4501, 30.5234),
    'харків': (49.9935, 36.2304),
    'одеса': (46.4825, 30.7233),
    'дніпро': (48.4647, 35.0462),
    'донецьк': (48.0159, 37.8028),
    'запоріжжя': (47.8388, 35.1396),
    'львів': (49.8397, 24.0297),
    'кривий ріг': (47.9105, 33.3918),
    'миколаїв': (46.9750, 31.9946),
    'маріуполь': (47.0951, 37.5499),
    'луганськ': (48.5740, 39.3078),
    'вінниця': (49.2331, 28.4682),
    'херсон': (46.6354, 32.6169),
    'полтава': (49.5883, 34.5514),
    'чернігів': (51.4982, 31.2893),
    'черкаси': (49.4444, 32.0598),
    'суми': (50.9077, 34.7981),
    'житомир': (50.2649, 28.6587),
    'хмельницький': (49.4230, 26.9871),
    'рівне': (50.6199, 26.2516),
    'чернівці': (48.2921, 25.9358),
    'тернопіль': (49.5535, 25.5948),
    'івано-франківськ': (48.9226, 24.7111),
    'луцьк': (50.7593, 25.3424),
    'ужгород': (48.6208, 22.2879),
    'кропивницький': (48.5079, 32.2623),
    'сімферополь': (44.9521, 34.1024),
    'севастополь': (44.6166, 33.5254),
}

# City to oblast mapping
CITY_TO_OBLAST = {
    'київ': 'київ',
    'харків': 'харківська',
    'одеса': 'одеська',
    'дніпро': 'дніпропетровська',
    'запоріжжя': 'запорізька',
    'львів': 'львівська',
    'кривий ріг': 'дніпропетровська',
    'миколаїв': 'миколаївська',
    'вінниця': 'вінницька',
    'херсон': 'херсонська',
    'полтава': 'полтавська',
    'чернігів': 'чернігівська',
    'черкаси': 'черкаська',
    'суми': 'сумська',
    'житомир': 'житомирська',
    'хмельницький': 'хмельницька',
    'рівне': 'рівненська',
    'чернівці': 'чернівецька',
    'тернопіль': 'тернопільська',
    'івано-франківськ': 'івано-франківська',
    'луцьк': 'волинська',
    'ужгород': 'закарпатська',
    'кропивницький': 'кіровоградська',
}

# Normalize city names (various spellings -> canonical)
UA_CITY_NORMALIZE = {
    'дніпропетровськ': 'дніпро',
    'днепр': 'дніпро',
    'днепропетровск': 'дніпро',
    'київ': 'київ',
    'киев': 'київ',
    'харьков': 'харків',
    'одесса': 'одеса',
    'запорожье': 'запоріжжя',
    'львов': 'львів',
    'николаев': 'миколаїв',
    'винница': 'вінниця',
    'чернигов': 'чернігів',
    'полтава': 'полтава',
    'кременчук': 'кременчук',
    'кременчуг': 'кременчук',
    'кривой рог': 'кривий ріг',
    'мариуполь': 'маріуполь',
    'бердянск': 'бердянськ',
    'мелитополь': 'мелітополь',
}

# Region aliases for notification matching
REGION_ALIASES = {
    'київ': ['київ', 'київська', 'kyiv', 'kiev'],
    'харківська': ['харків', 'харківська', 'kharkiv'],
    'одеська': ['одеса', 'одеська', 'odesa', 'odessa'],
    'дніпропетровська': ['дніпро', 'дніпропетровська', 'dnipro'],
    'запорізька': ['запоріжжя', 'запорізька', 'zaporizhzhia'],
    'миколаївська': ['миколаїв', 'миколаївська', 'mykolaiv'],
    'херсонська': ['херсон', 'херсонська', 'kherson'],
    'полтавська': ['полтава', 'полтавська', 'poltava'],
    'сумська': ['суми', 'сумська', 'sumy'],
    'чернігівська': ['чернігів', 'чернігівська', 'chernihiv'],
    'донецька': ['донецьк', 'донецька', 'donetsk'],
    'луганська': ['луганськ', 'луганська', 'luhansk'],
    'житомирська': ['житомир', 'житомирська', 'zhytomyr'],
    'вінницька': ['вінниця', 'вінницька', 'vinnytsia'],
    'черкаська': ['черкаси', 'черкаська', 'cherkasy'],
    'кіровоградська': ['кропивницький', 'кіровоградська', 'kropyvnytskyi'],
    'львівська': ['львів', 'львівська', 'lviv'],
    'волинська': ['луцьк', 'волинська', 'volyn', 'lutsk'],
    'рівненська': ['рівне', 'рівненська', 'rivne'],
    'тернопільська': ['тернопіль', 'тернопільська', 'ternopil'],
    'хмельницька': ['хмельницький', 'хмельницька', 'khmelnytskyi'],
    'івано-франківська': ['івано-франківськ', 'івано-франківська', 'ivano-frankivsk'],
    'закарпатська': ['ужгород', 'закарпатська', 'zakarpattia', 'uzhhorod'],
    'чернівецька': ['чернівці', 'чернівецька', 'chernivtsi'],
}


def normalize_region_name(name: str) -> str:
    """Normalize region name to canonical form"""
    if not name:
        return ""
    
    name = name.lower().strip()
    
    # Check direct aliases
    for canonical, aliases in REGION_ALIASES.items():
        if name in aliases:
            return canonical
    
    # Check if it's already canonical
    if name in REGION_ALIASES:
        return name
    
    # Try to match by prefix
    for canonical, aliases in REGION_ALIASES.items():
        for alias in aliases:
            if name.startswith(alias[:4]) or alias.startswith(name[:4]):
                return canonical
    
    return name


def get_oblast_center(oblast: str) -> tuple:
    """Get coordinates of oblast center"""
    oblast = normalize_region_name(oblast)
    
    # Check city to oblast mapping first
    if oblast in CITY_TO_OBLAST:
        city = oblast
    else:
        # Try to find matching center
        city = oblast.replace('ська', '').replace('ький', '').replace('ка', '')
    
    return OBLAST_CENTERS.get(city, (48.5, 32.0))  # Default to Ukraine center


def match_region(text: str, user_regions: list) -> bool:
    """Check if text mentions any of user's subscribed regions"""
    if not user_regions:
        return False
    
    text_lower = text.lower()
    
    for region in user_regions:
        region_norm = normalize_region_name(region)
        
        # Get all aliases for this region
        aliases = REGION_ALIASES.get(region_norm, [region_norm])
        
        for alias in aliases:
            if alias in text_lower:
                return True
    
    return False
