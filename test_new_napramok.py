#!/usr/bin/env python3
"""Test the new napramok message to verify all 31 markers appear."""

import sys
sys.path.insert(0, '.')

# The new message from user
text = """–°—É–º—â–∏–Ω–∞:
4—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ù–µ–¥—Ä–∏–≥–∞–π–ª—ñ–≤ 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –õ–∏–ø–æ–≤—É –î–æ–ª–∏–Ω—É 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö–æ–Ω–æ—Ç–æ–ø 

–ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞:
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ü—Ä–∏–ª—É–∫–∏  
3—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö–æ—Ä—é–∫—ñ–≤–∫—É 
15—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ù—ñ–∂–∏–Ω
5—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –î–µ—Å–Ω—É
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö—ñ–ø—Ç—ñ
4—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –Ü—á–Ω—é
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ì–æ–Ω—á–∞—Ä—ñ–≤—Å—å–∫–µ 

–ü–æ–ª—Ç–∞–≤—â–∏–Ω–∞:
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ì–∞–¥—è—á 
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö—Ä–µ–º–µ–Ω—á—É–∫ 
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ú–∏—Ä–≥–æ—Ä–æ–¥ 

–ß–µ—Ä–∫–∞—â–∏–Ω–∞:
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –¶–≤—ñ—Ç–∫–æ–≤–µ

–ö–∏—ó–≤—â–∏–Ω–∞:
5—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –°—Ç—Ä–∞—Ö–æ–ª—ñ—Å—Å—è
3—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ë—ñ–ª—É –¶–µ—Ä–∫–≤—É 
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö–∏—ó–≤
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ë—Ä–æ–≤–∞—Ä–∏ 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ë–∏—à—ñ–≤ 

–ñ–∏—Ç–æ–º–∏—Ä—â–∏–Ω–∞:
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö–æ—Ä–æ—Å—Ç–µ–Ω—å 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ß–æ–ø–æ–≤–∏—á—ñ
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ó–≤—è–≥–µ–ª—å 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –†–∞–¥–æ–º–∏—à–ª—å 

–•–∞—Ä–∫—ñ–≤—â–∏–Ω–∞:
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –°–∞—Ö–Ω–æ–≤—â–∏–Ω—É 

–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞:
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö–∞–º º—è–Ω—Å—å–∫–µ 
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –°–æ–ª–æ–Ω–µ 

–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—â–∏–Ω–∞:
2—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π 
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ü—ñ—â–∞–Ω–∏–π –ë—Ä—ñ–¥
4—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ë–æ–±—Ä–∏–Ω–µ—Ü—å
–ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –ü–µ—Ç—Ä–æ–≤–µ

–•–µ—Ä—Å–æ–Ω—â–∏–Ω–∞:
15—Ö –ë–ø–õ–ê –∫—É—Ä—Å–æ–º –Ω–∞ –¢–µ–Ω–¥—Ä—ñ–≤—Å—å–∫—É –∫–æ—Å—É

‚úô –ù–∞–ø—Ä—è–º–æ–∫ —Ä–∞–∫–µ—Ç  (https://t.me/napramok)‚úô
‚úô–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∫–∞–Ω–∞–ª (https://send.monobank.ua/5Pwr3r52mg)‚úô"""

print("=" * 60)
print("TESTING NEW NAPRAMOK MESSAGE")
print("=" * 60)
print(f"Expected cities: 31")
print("Testing coordinates...")

try:
    from app import process_message
    
    tracks = process_message(text, "test_new", "2025-09-02 12:00:00", "napramok")
    
    if tracks and isinstance(tracks, list):
        markers = [t for t in tracks if not t.get('list_only', False) and not t.get('suppress', False)]
        print(f"\nüéØ RESULT: {len(markers)} map markers created!")
        
        if len(markers) >= 31:
            print("‚úÖ SUCCESS: All expected markers present!")
        else:
            print(f"‚ö†Ô∏è  WARNING: Expected 31+, got {len(markers)}")
            
        print(f"\nTotal tracks: {len(tracks)}")
        print(f"Map markers: {len(markers)}")
        print(f"List entries: {len([t for t in tracks if t.get('list_only', False)])}")
        
    else:
        print("‚ùå ERROR: No tracks returned or wrong type")
        
except Exception as e:
    print(f"‚ùå ERROR: {e}")
    import traceback
    traceback.print_exc()

print("=" * 60)
