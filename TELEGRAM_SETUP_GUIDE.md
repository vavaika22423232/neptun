# ü§ñ Telegram Bot Integration Guide

## –©–æ —Ü–µ –¥–∞—î?

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–º–∏ DTEK Telegram –±–æ—Ç–∞–º–∏ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ **—Ä–µ–∞–ª—å–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å** –¥–ª—è –≤—Å—ñ—Ö —Ä–µ–≥—ñ–æ–Ω—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏:
- üèôÔ∏è –ö–∏—ó–≤ - `@DTEKKyivBot`
- üåÜ –î–Ω—ñ–ø—Ä–æ - `@DTEKDniproBot`
- üåä –û–¥–µ—Å–∞ - `@DTEKOdesaBot`

## üìù –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### –ö—Ä–æ–∫ 1: –û—Ç—Ä–∏–º–∞–Ω–Ω—è Telegram API credentials

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ https://my.telegram.org/apps
2. –£–≤—ñ–π–¥—ñ—Ç—å –∑—ñ —Å–≤–æ—ó–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É Telegram
3. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"API development tools"**
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É:
   - **App title**: `DTEK Schedule Bot`
   - **Short name**: `dtek_bot`
   - **URL**: `https://your-site.onrender.com` (–∞–±–æ –∑–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º)
   - **Platform**: `Other`
5. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **"Create application"**
6. –°–∫–æ–ø—ñ—é–π—Ç–µ:
   - **api_id** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `12345678`)
   - **api_hash** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥: `abcdef1234567890abcdef1234567890`)

### –ö—Ä–æ–∫ 2: –õ–æ–∫–∞–ª—å–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è

```bash
# –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
export TELEGRAM_API_ID='–≤–∞—à_api_id'
export TELEGRAM_API_HASH='–≤–∞—à_api_hash'

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
python3 setup_telegram.py
```

**–©–æ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è:**
1. –í–∞—Å –ø–æ–ø—Ä–æ—Å—è—Ç—å –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É Telegram
2. Telegram –Ω–∞–¥—ñ—à–ª–µ –∫–æ–¥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
3. –í–≤–µ–¥—ñ—Ç—å –∫–æ–¥
4. –°—Ç–≤–æ—Ä–∏—Ç—å—Å—è —Ñ–∞–π–ª `dtek_session.session` (—Ü–µ –≤–∞—à–∞ —Å–µ—Å—ñ—è)

### –ö—Ä–æ–∫ 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –¢–µ—Å—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è
python3 telegram_dtek_client.py
```

–Ø–∫—â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î, –ø–æ–±–∞—á–∏—Ç–µ:
```
‚úÖ –ó'—î–¥–Ω–∞–Ω–Ω—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
üìç –¢–µ—Å—Ç—É—î–º–æ: –ö–∏—ó–≤, –•—Ä–µ—â–∞—Ç–∏–∫, 1
‚úÖ –ß–µ—Ä–≥–∞: 1.1
üìÖ –ì—Ä–∞—Ñ—ñ–∫: 12 –∑–∞–ø–∏—Å—ñ–≤
```

### –ö—Ä–æ–∫ 4: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –ø—Ä–æ–µ–∫—Ç

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤–∂–µ –≥–æ—Ç–æ–≤–∞! –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Telegram Bot —è–∫—â–æ:
1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ `TELEGRAM_API_ID` —Ç–∞ `TELEGRAM_API_HASH`
2. –Ü—Å–Ω—É—î —Ñ–∞–π–ª —Å–µ—Å—ñ—ó `dtek_session.session`
3. YASNO API –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä–µ–≥—ñ–æ–Ω

**–ö–∞—Å–∫–∞–¥–Ω–∞ —Å–∏—Å—Ç–µ–º–∞:**
```
1. YASNO API (–ö–∏—ó–≤, –î–Ω—ñ–ø—Ä–æ) ‚Üí —à–≤–∏–¥–∫–æ ‚úÖ
2. Telegram Bot (–≤—Å—ñ —ñ–Ω—à—ñ –º—ñ—Å—Ç–∞) ‚Üí —è–∫—â–æ —î credentials ü§ñ
3. Fallback schedule ‚Üí —è–∫—â–æ –≤—Å–µ —ñ–Ω—à–µ –Ω–µ –ø—Ä–∞—Ü—é—î üìä
```

### –ö—Ä–æ–∫ 5: Deployment –Ω–∞ Render

#### A. –î–æ–¥–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ Dashboard ‚Üí Your Service ‚Üí Environment
2. –î–æ–¥–∞–π—Ç–µ:
   ```
   TELEGRAM_API_ID = –≤–∞—à_api_id
   TELEGRAM_API_HASH = –≤–∞—à_api_hash
   ```
3. –ó–±–µ—Ä–µ–∂—ñ—Ç—å

#### B. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª —Å–µ—Å—ñ—ó:

**–í–∞—Ä—ñ–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SSH (—è–∫—â–æ —î)**
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω—ñ–π –º–∞—à–∏–Ω—ñ
scp dtek_session.session render:/app/

# –ê–±–æ —á–µ—Ä–µ–∑ git (—è–∫—â–æ —Å–µ—Å—ñ—è –Ω–µ –≤ .gitignore)
git add dtek_session.session -f
git commit -m "Add Telegram session"
git push
```

**–í–∞—Ä—ñ–∞–Ω—Ç 2: –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Å—ñ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ**
```bash
# –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ Render Shell
python3 setup_telegram.py
# –ü—Ä–æ–π–¥—ñ—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
```

**–í–∞—Ä—ñ–∞–Ω—Ç 3: –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (—Å–∫–ª–∞–¥–Ω—ñ—à–µ)**
```bash
# –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —Å–µ—Å—ñ—é –≤ base64
cat dtek_session.session | base64 > session_base64.txt

# –î–æ–¥–∞—Ç–∏ –≤ Render Environment:
TELEGRAM_SESSION_BASE64 = <–≤–º—ñ—Å—Ç session_base64.txt>

# –î–æ–¥–∞—Ç–∏ –≤ app.py –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è:
import base64
if os.getenv('TELEGRAM_SESSION_BASE64'):
    with open('dtek_session.session', 'wb') as f:
        f.write(base64.b64decode(os.getenv('TELEGRAM_SESSION_BASE64')))
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –ö–µ—à—É–≤–∞–Ω–Ω—è

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:
- **YASNO API**: 1 –≥–æ–¥–∏–Ω–∞
- **Telegram Bot**: 2 –≥–æ–¥–∏–Ω–∏ (–±–æ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ)

–ó–º—ñ–Ω–∏—Ç–∏ –≤ `blackout_api.py`:
```python
_telegram_cache = {
    'ttl': 7200  # –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞ —ñ–Ω—à–µ –∑–Ω–∞—á–µ–Ω–Ω—è (—Å–µ–∫—É–Ω–¥–∏)
}
```

### Rate Limits

Telegram Bot API –º–∞—î –æ–±–º–µ–∂–µ–Ω–Ω—è:
- ~30 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Ö–≤–∏–ª–∏–Ω—É
- ~10,000 –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –¥–µ–Ω—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –¥–æ–≤—à–∏–π TTL –∫–µ—à—É (2-4 –≥–æ–¥–∏–Ω–∏)
- –ù–µ —Ä–æ–±—ñ—Ç—å –∑–∞–ø–∏—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –æ–∫—Ä–µ–º–æ
- –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ñ –∞–¥—Ä–µ—Å–∏ —á–µ—Ä–µ–∑ cron

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```python
# –í app.py –¥–æ–¥–∞–π—Ç–µ
logger.info(f"üìä Cache stats: {len(_telegram_cache['data'])} entries")
logger.info(f"ü§ñ Telegram enabled: {_telegram_cache['enabled']}")
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

```python
# blackout_api.py
telegram_stats = {
    'requests': 0,
    'cache_hits': 0,
    'errors': 0
}

def get_telegram_stats():
    return telegram_stats
```

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –Ω–æ—Ç–∞—Ç–∫–∏

### –ë–µ–∑–ø–µ–∫–∞

1. **–ù—ñ–∫–æ–ª–∏ –Ω–µ –∫–æ–º—ñ—Ç—å—Ç–µ –≤ git:**
   - `dtek_session.session` ‚úÖ (–≤–∂–µ –≤ .gitignore)
   - `TELEGRAM_API_HASH` ‚úÖ (—Ç—ñ–ª—å–∫–∏ –≤ Environment Variables)

2. **–§–∞–π–ª —Å–µ—Å—ñ—ó:**
   - –¶–µ –≤–∞—à –¥–æ—Å—Ç—É–ø –¥–æ Telegram
   - –ù–µ –¥—ñ–ª—ñ—Ç—å—Å—è –Ω–∏–º
   - –Ø–∫—â–æ –≤—Ç—Ä–∞—Ç–∏–ª–∏ - —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —á–µ—Ä–µ–∑ `setup_telegram.py`

### –û–±–º–µ–∂–µ–Ω–Ω—è

1. **Telegram Bot –º–æ–∂–µ:**
   - –ù–µ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –≤—á–∞—Å–Ω–æ (timeout)
   - –ó–º—ñ–Ω–∏—Ç–∏ —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
   - –ë—É—Ç–∏ –æ—Ñ—Ñ–ª–∞–π–Ω

2. **–¢–æ–º—É –∑–∞–≤–∂–¥–∏ —î fallback:**
   - –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≤–ø–∞–¥–µ —è–∫—â–æ –±–æ—Ç –Ω–µ –ø—Ä–∞—Ü—é—î
   - –ü–æ–∫–∞–∂–µ —Ç–∏–ø–æ–≤–∏–π –≥—Ä–∞—Ñ—ñ–∫

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–µ—Å—ñ—ó

–°–µ—Å—ñ—è –∂–∏–≤–µ ~1 —Ä—ñ–∫. –Ø–∫—â–æ –ø–µ—Ä–µ—Å—Ç–∞–ª–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏:

```bash
# –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ä—É
rm dtek_session.session

# –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É
python3 setup_telegram.py
```

## üöÄ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä –≤–∞—à –ø—Ä–æ–µ–∫—Ç:
1. ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î YASNO API (–ö–∏—ó–≤, –î–Ω—ñ–ø—Ä–æ)
2. ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Telegram Bot (—ñ–Ω—à—ñ –º—ñ—Å—Ç–∞)
3. ‚úÖ –ú–∞—î fallback –≥—Ä–∞—Ñ—ñ–∫–∏
4. ‚úÖ –ö–µ—à—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
5. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–±–∏—Ä–∞—î –Ω–∞–π–∫—Ä–∞—â–µ –¥–∂–µ—Ä–µ–ª–æ

## üÜò Troubleshooting

### "telethon not installed"
```bash
pip install telethon
```

### "TELEGRAM_API_ID not found"
```bash
export TELEGRAM_API_ID='your_id'
export TELEGRAM_API_HASH='your_hash'
```

### "Session file not found"
```bash
python3 setup_telegram.py
```

### "Bot doesn't respond"
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –±–æ—Ç —ñ—Å–Ω—É—î –≤ Telegram
- –°–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç–∏ –±–æ—Ç—É –≤—Ä—É—á–Ω—É
- –ú–æ–∂–ª–∏–≤–æ –±–æ—Ç —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π

### "Rate limit exceeded"
- –ó–±—ñ–ª—å—à—ñ—Ç—å TTL –∫–µ—à—É
- –ó–º–µ–Ω—à—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤
- –ó–∞—á–µ–∫–∞–π—Ç–µ 10-15 —Ö–≤–∏–ª–∏–Ω

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Telethon Documentation](https://docs.telethon.dev/)
- [Telegram API](https://core.telegram.org/api)
- [DTEK Bots](https://t.me/DTEKKyivBot)
