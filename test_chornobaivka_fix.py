#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –ß–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∞ (–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª.) –±–æ–ª—å—à–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –•–∞—Ä—å–∫–æ–≤–µ
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É –≤ sys.path —á—Ç–æ–±—ã –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å app.py
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

try:
    from app import ensure_city_coords, process_message
    
    def test_chornobaivka():
        print("=== –¢–µ—Å—Ç –ß–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∞ (–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª.) ===\n")
        
        # –¢–µ—Å—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        print("1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ß–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∏:")
        coords = ensure_city_coords('—á–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∞')
        if coords:
            lat, lon, is_approx = coords
            print(f"   –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ({lat}, {lon})")
            print(f"   –¢–æ—á–Ω–æ—Å—Ç—å: {'–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ' if is_approx else '—Ç–æ—á–Ω—ã–µ'}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –•–∞—Ä—å–∫–æ–≤
            if abs(lat - 49.9935) < 0.001 and abs(lon - 36.2304) < 0.001:
                print(f"   ‚ùå –û–®–ò–ë–ö–ê: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ –•–∞—Ä—å–∫–æ–≤!")
            else:
                print(f"   ‚úÖ –û–ö: –ù–µ –ø—É—Ç–∞–µ—Ç—Å—è —Å –•–∞—Ä—å–∫–æ–≤–æ–º")
                
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –•–µ—Ä—Å–æ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å
            if abs(lat - 46.6964) < 0.001 and abs(lon - 32.5469) < 0.001:
                print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ß–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∏")
            else:
                print(f"   ‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –æ–∂–∏–¥–∞–µ–º—ã—Ö (46.6964, 32.5469)")
        else:
            print(f"   ‚ùå –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
        print()
        
        # –¢–µ—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
        print("2. –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:")
        message = "üõ∏ –ß–æ—Ä–Ω–æ–±–∞—ó–≤–∫–∞ (–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª.) –ó–∞–≥—Ä–æ–∑–∞ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ë–ü–õ–ê. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ —É–∫—Ä–∏—Ç—Ç—è!"
        print(f"   –°–æ–æ–±—â–µ–Ω–∏–µ: {message}")
        
        try:
            result = process_message(message, "test_1", "2025-09-13", "test_channel")
            
            if result and len(result) > 0:
                message_data = result[0]
                place = message_data.get('place', '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ')
                lat = message_data.get('lat', None)
                lng = message_data.get('lng', None)
                marker_icon = message_data.get('marker_icon', '–Ω–µ –Ω–∞–π–¥–µ–Ω–æ')
                
                print(f"   –ú–µ—Å—Ç–æ: {place}")
                print(f"   –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ({lat}, {lng})" if lat and lng else "   –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
                print(f"   –ò–∫–æ–Ω–∫–∞: {marker_icon}")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if lat and lng:
                    if abs(lat - 49.9935) < 0.1 and abs(lng - 36.2304) < 0.1:
                        print(f"   ‚ùå –û–®–ò–ë–ö–ê: –í—Å–µ –µ—â–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ä–∞–π–æ–Ω–µ –•–∞—Ä—å–∫–æ–≤–∞!")
                    elif abs(lat - 46.6964) < 0.1 and abs(lng - 32.5469) < 0.1:
                        print(f"   ‚úÖ –û–¢–õ–ò–ß–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –•–µ—Ä—Å–æ–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏!")
                    else:
                        print(f"   ‚ö†Ô∏è –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: —à–∏—Ä–æ—Ç–∞ {lat}, –¥–æ–ª–≥–æ—Ç–∞ {lng}")
            else:
                print(f"   ‚ùå –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ")
                
        except Exception as e:
            print(f"   ‚ùå –û–®–ò–ë–ö–ê: {e}")
            
        print()
        
        # –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç - –•–∞—Ä—å–∫–æ–≤
        print("3. –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –•–∞—Ä—å–∫–æ–≤–∞:")
        kharkiv_coords = ensure_city_coords('—Ö–∞—Ä–∫—ñ–≤')
        if kharkiv_coords:
            lat, lon, is_approx = kharkiv_coords
            print(f"   –•–∞—Ä—å–∫–æ–≤: ({lat}, {lon})")
        
        # –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç - –•–µ—Ä—Å–æ–Ω
        print("4. –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –•–µ—Ä—Å–æ–Ω–∞:")
        kherson_coords = ensure_city_coords('—Ö–µ—Ä—Å–æ–Ω')
        if kherson_coords:
            lat, lon, is_approx = kherson_coords
            print(f"   –•–µ—Ä—Å–æ–Ω: ({lat}, {lon})")

    if __name__ == "__main__":
        test_chornobaivka()

except ImportError as e:
    print(f"–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: {e}")
    print("–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ app.py –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ")
