# üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–ì–æ—Ç–æ–≤–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**
- –í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–æ–≤ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- FCM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Firebase Cloud Messaging)
- –õ–æ–∫–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

‚úÖ **–ì–æ—Ç–æ–≤–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:**
- API endpoints –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö —Ç—Ä–µ–≤–æ–≥
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Firebase

‚ùå **–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:**
- Firebase credentials –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Render)

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å Firebase Service Account Key

1. –û—Ç–∫—Ä—ã—Ç—å [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç `neptun-alarm-app` (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π)
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Project Settings** (‚öôÔ∏è –∏–∫–æ–Ω–∫–∞) ‚Üí **Service accounts**
4. –ù–∞–∂–∞—Ç—å **Generate new private key**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª `firebase-credentials.json`

### –®–∞–≥ 2: –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å credentials –≤ Base64

**–ù–∞ macOS/Linux:**
```bash
base64 -i firebase-credentials.json | tr -d '\n' > firebase_base64.txt
```

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `firebase_base64.txt`

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Render

1. –û—Ç–∫—Ä—ã—Ç—å [Render Dashboard](https://dashboard.render.com/)
2. –í—ã–±—Ä–∞—Ç—å –≤–∞—à —Å–µ—Ä–≤–∏—Å (neptun backend)
3. –ü–µ—Ä–µ–π—Ç–∏ –≤ **Environment** ‚Üí **Environment Variables**
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Key:** `FIREBASE_CREDENTIALS`
   - **Value:** (–≤—Å—Ç–∞–≤–∏—Ç—å base64 —Å—Ç—Ä–æ–∫—É –∏–∑ —à–∞–≥–∞ 2)
5. –ù–∞–∂–∞—Ç—å **Save Changes**

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è** ‚Üí **–†–µ–≥—ñ–æ–Ω–∏ –¥–ª—è —Ç—Ä–∏–≤–æ–≥**
3. –í—ã–±—Ä–∞—Ç—å —Å–≤–æ–π —Ä–µ–≥–∏–æ–Ω
4. –ù–∞–∂–∞—Ç—å **–ó–±–µ—Ä–µ–≥—Ç–∏**
5. –ù–∞–∂–∞—Ç—å **–¢–µ—Å—Ç —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è**
6. –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ Render:

```
INFO: Firebase Admin SDK initialized successfully
Device xxx registered successfully with ID: yyy
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É:
```
WARNING: Firebase credentials not found
```

–ó–Ω–∞—á–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `FIREBASE_CREDENTIALS` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞.

## üì± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–≥–∏–æ–Ω—ã** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç FCM token –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `POST /api/register-device`
3. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ `devices.json`
4. **Telegram –±–æ—Ç** –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç—Ä–µ–≤–æ–≥–∞—Ö
5. –ü—Ä–∏ –Ω–æ–≤–æ–π —Ç—Ä–µ–≤–æ–≥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `send_fcm_notification()`
6. –°–µ—Ä–≤–µ—Ä:
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–≥–∏–æ–Ω –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–æ—Ç —Ä–µ–≥–∏–æ–Ω
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç push —á–µ—Ä–µ–∑ Firebase Cloud Messaging
7. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω

## üéØ –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üö® –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–∫—Ä–∞—Å–Ω—ã–µ)
- –†–∞–∫–µ—Ç—ã (–ö–†, –ö–ê–ë, –±–∞–ª—ñ—Å—Ç–∏—á–Ω—ñ, —à–≤–∏–¥–∫—ñ—Å–Ω–∞ —Ü—ñ–ª—å)
- –ö–∞–Ω–∞–ª: `critical_alerts`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **MAX**
- –ó–≤—É–∫: –≥—Ä–æ–º–∫–∏–π

### ‚ö†Ô∏è –û–±—ã—á–Ω—ã–µ (–æ—Ä–∞–Ω–∂–µ–≤—ã–µ)
- –î—Ä–æ–Ω—ã (–ë–ü–õ–ê, –±–µ–∑–ø—ñ–ª–æ—Ç–Ω—ñ)
- –ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞
- –ö–∞–Ω–∞–ª: `normal_alerts`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **HIGH**

### ‚úÖ –í—ñ–¥–±—ñ–π (–∑–µ–ª–µ–Ω—ã–µ)
- –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ç—Ä–µ–≤–æ–≥–∏
- –ö–∞–Ω–∞–ª: `normal_alerts`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: **HIGH**

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤:
```bash
curl https://neptun.in.ua/api/registered-devices
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "count": 1,
  "devices": {
    "device-id": {
      "token": "...fcm-token...",
      "regions": ["–ö–∏—ó–≤"],
      "last_updated": "2026-01-07T..."
    }
  }
}
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç—Ä–µ–≤–æ–≥–∏:
```
=== FCM NOTIFICATION TRIGGERED ===
Place: –ö–∏—ó–≤
Threat type: –ë–ü–õ–ê
Region: –ö–∏—ó–≤, Devices found: 1
Notification sent to device xxx: projects/.../messages/...
Sent 1/1 notifications for region: –ö–∏—ó–≤
```

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Android Notification Channels

–ö–∞–Ω–∞–ª—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –≤ –∫–æ–¥–µ:
- `critical_alerts` - –¥–ª—è —Ä–∞–∫–µ—Ç (–≤–∞–∂–Ω–æ—Å—Ç—å: MAX)
- `normal_alerts` - –¥–ª—è –¥—Ä–æ–Ω–æ–≤ –∏ –≤—ñ–¥–±–æ—é (–≤–∞–∂–Ω–æ—Å—Ç—å: HIGH)

### iOS –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–î–ª—è iOS –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç:
1. –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ç Apple
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ capabilities –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `apns-priority: 10` –¥–ª—è —Å—Ä–æ—á–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏.

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] Firebase Service Account Key –ø–æ–ª—É—á–µ–Ω
- [ ] Credentials –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã –≤ Base64
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `FIREBASE_CREDENTIALS` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞ Render
- [ ] –°–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ "Firebase Admin SDK initialized successfully"
- [ ] –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ
- [ ] –†–µ–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ —Ç—Ä–µ–≤–æ–≥–∞—Ö

## üéâ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç:
- –í—ã–±–∏—Ä–∞—Ç—å —Ä–µ–≥–∏–æ–Ω—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü–æ–ª—É—á–∞—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–≤–æ–≥–∞—Ö
- –û—Ç–ª–∏—á–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —É–≥—Ä–æ–∑—ã (—Ä–∞–∫–µ—Ç—ã) –æ—Ç –æ–±—ã—á–Ω—ã—Ö (–¥—Ä–æ–Ω—ã)
- –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ñ–¥–±–æ—ó

–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ Telegram –∫–∞–Ω–∞–ª–µ DTEK, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!
