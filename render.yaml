# ===========================================
# Render.com Configuration - Modular Architecture
# ===========================================
# 
# Цей файл для нової модульної архітектури.
# Щоб перейти на нову архітектуру:
# 1. Перейменуйте render.yaml -> render.old.yaml
# 2. Перейменуйте render.new.yaml -> render.yaml
# 3. git push
#
# Або для тестування створіть новий сервіс на Render

services:
  - type: web
    name: neptun-alerts
    runtime: python
    plan: free
    region: frankfurt  # Близько до України
    
    # Build
    buildCommand: |
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements.txt
    
    # Start - використовуємо app_new замість app
    startCommand: gunicorn app_new:app --workers 1 --worker-class gevent --worker-connections 1000 --timeout 120 --keep-alive 5 --bind 0.0.0.0:$PORT
    
    # Health check
    healthCheckPath: /health
    
    # Persistent disk для сесій та кешу
    disk:
      name: data
      mountPath: /data
      sizeGB: 1
    
    # Environment variables
    envVars:
      # Telegram
      - key: TELEGRAM_API_ID
        sync: false
      - key: TELEGRAM_API_HASH
        sync: false
      - key: TELEGRAM_CHANNELS
        value: mapstransler
      
      # Security
      - key: ADMIN_SECRET
        generateValue: true
      - key: SECRET_KEY
        generateValue: true
      
      # Geocoding (optional)
      - key: OPENCAGE_API_KEY
        sync: false
      
      # Alarms API
      - key: ALARMS_API_KEY
        sync: false
      
      # Firebase (FCM push notifications)
      - key: FIREBASE_CREDENTIALS
        sync: false
      
      # Storage paths
      - key: PERSISTENT_DATA_DIR
        value: /data
      - key: MESSAGES_FILE
        value: /data/messages.json
      - key: CACHE_FILE
        value: /data/geocode_cache.json
      
      # Performance
      - key: FLASK_ENV
        value: production
      - key: MAX_TRACKS
        value: "10000"
      - key: TRACK_TTL_HOURS
        value: "24"
      - key: MEMORY_OPTIMIZED
        value: "true"
      
      # Python optimization
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: PYTHONDONTWRITEBYTECODE
        value: "1"
      - key: PYTHONOPTIMIZE
        value: "2"

    # Auto-deploy on push
    autoDeploy: true
