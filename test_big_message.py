#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Тест большого сообщения с БпЛА курсом
import sys
import os
sys.path.append('.')

# Импортируем функцию из app.py
from app import process_message, OBLAST_CENTERS

test_message = """Миколаївщина:
БпЛА курсом на Первомайськ 
БпЛА курсом на Братське 
БпЛА курсом на Возсіятське 

Вінниччина:
БпЛА курсом на Чечельник
БпЛА курсом на Козятин 
БпЛА курсом на Хмільник 

Одещина:
4х БпЛА курсом на Балту  

Дніпропетровщина:
4х БпЛА курсом на Божедарівку

Кіровоградщина:
БпЛА курсом на Голованівськ 
БпЛА курсом на Помічну 
10х БпЛА курсом на Кропивницький 

Полтавщина:
БпЛА курсом на Лубни
БпЛА курсом на Семенівку 

Черкащина:
БпЛА курсом на Драбів 
БпЛА курсом на Звенигородку 
БпЛА курсом на Буки

Сумщина:
БпЛА курсом на Степанівку
БпЛА курсом на Дубовʼязівку

Чернігівщина:
БпЛА курсом на Парафіївку
4х БпЛА курсом на Гончарівське 

Київщина:
10х БпЛА курсом на Красятичі
БпЛА курсом на Фастів 
БпЛА курсом на Київ 

Житомирщина:
2х БпЛА курсом на Любар 
БпЛА курсом на Нову Борову 
БпЛА курсом на Хорошів
БпЛА курсом на Житомир 
БпЛА курсом на Чоповичі
2х БпЛА курсом на Ємільчине
БпЛА курсом на Городницю

Хмельниччина:
БпЛА курсом на Стару Синяву 
БпЛА курсом на Шепетівку 

Рівненщина:
БпЛА курсом на Сарни
БпЛА курсом на Степань 
БпЛА курсом на Рівне
БпЛА курсом на Рокитне
4х БпЛА курсом на Дубровицю

Волинь:
БпЛА курсом на Камінь-Каширський
2х БпЛА курсом на Любешів
БпЛА курсом на Маневичі
БпЛА курсом на Колки
БпЛА курсом на Рожище 
БпЛА курсом на Рокині
4х БпЛА курсом на Луцьк
БпЛА курсом на Володимир

✙ Напрямок ракет  (https://t.me/napramok)✙
✙Підтримати канал (https://send.monobank.ua/5Pwr3r52mg)✙"""

if __name__ == "__main__":
    print("Тестирую большое сообщение...")
    print(f"Регионы в OBLAST_CENTERS: {list(OBLAST_CENTERS.keys())}")
    
    # Проверим какие заголовки есть
    lines = test_message.strip().split('\n')
    for line in lines:
        line_clean = line.strip().lower()
        if line_clean.endswith(':'):
            region_name = line_clean[:-1]
            print(f"Найден заголовок: '{region_name}' -> в базе: {region_name in OBLAST_CENTERS}")
    
    print("\n" + "="*50)
    print("Запускаю парсер...")
    
    result = process_message(test_message, "test_123", "2025-09-03 12:00:00", "test_channel")
    
    print(f"Результат: {len(result)} треков")
    for track in result:
        print(f"- {track.get('place', 'Неизвестно')}: {track.get('source_match', 'unknown')} - {track.get('marker_icon', 'no_icon')}")
        if 'suppress' in track:
            print(f"  ЗАБЛОКИРОВАНО: {track.get('suppress_reason', 'unknown')}")
