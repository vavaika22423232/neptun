#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import sys
import os
import re

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞ –≤ sys.path
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ app.py
from app import process_message

def test_current_message():
    """–¢–µ—Å—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    message = """–í—ñ–Ω–Ω–∏—á—á–∏–Ω–∞: 
–ë–ø–õ–ê –Ω–∞ –õ–∏–ø–æ–≤–µ—Ü—å 

–ß–µ—Ä–Ω—ñ–≥—ñ–≤—â–∏–Ω–∞: 
–ë–ø–õ–ê –Ω–∞ –Ω–∞ –†—ñ–ø–∫–∏ 

–°—É–º—â–∏–Ω–∞:
–ë–ø–õ–ê –Ω–∞ –¢–µ—Ä–Ω–∏ 

–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—â–∏–Ω–∞:  
2 –ë–ø–õ–ê –Ω–∞ –ü–∞–≤–ª–æ–≥—Ä–∞–¥
„Ö§ 
‚û°–ü—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è"""
    
    print("–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ:")
    print(repr(message))
    print("\n" + "="*50)
    
    # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    threats = process_message(message, '12345', '2025-09-30 12:00:00', 'test_channel')
    
    print(f"–ù–∞–π–¥–µ–Ω–æ —É–≥—Ä–æ–∑: {len(threats)}")
    print("\n–î–µ—Ç–∞–ª–∏ —É–≥—Ä–æ–∑:")
    
    for i, threat in enumerate(threats, 1):
        print(f"\n--- –£–≥—Ä–æ–∑–∞ {i} ---")
        for key, value in threat.items():
            print(f"{key}: {value}")
    
    # –ü—Ä–æ–≤–µ—Ä–∏–º, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
    if threats:
        threat = threats[0]
        if threat.get('list_only') == True:
            print("\nüö® –ü–†–û–ë–õ–ï–ú–ê: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ list_only=True")
            print("–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–æ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Å–ø–∏—Å–∫–µ —Å–æ–±—ã—Ç–∏–π, –∞ –Ω–µ –∫–∞–∫ –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ")
            print(f"source_match: {threat.get('source_match')}")
        else:
            print("\n‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ")
    
    return threats

if __name__ == "__main__":
    test_current_message()
